[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "TROLL V4 Evaluation",
    "section": "",
    "text": "Introduction\nThe aim of these analyses is to evaluate the TROLL 4.0 simulations of daily fluxes and the final structure and composition of the forest in relation to field observations and remote sensing at two Amazonian sites."
  },
  {
    "objectID": "index.html#study-sites",
    "href": "index.html#study-sites",
    "title": "TROLL V4 Evaluation",
    "section": "Study sites",
    "text": "Study sites\nWe have four sites with long-term eddy flux tower in Amazonia but we were only able to collect data from 2 in Brazil and 1 in French Guiana with free access. As BR-Sa3 also known as Km83 is in a logged forest on a shorter period and with lower rainfall registered in the flux tower we will focus on GF-Guy, hereafter Paracou, and BR-Sa1, hereafter Tapajos.\n\n\nCode\ntibble(\n  site = c(\"Paracou\", \"Tapajos\"),\n  latitude = c(5.27877, -2.85667),\n  longitude = c(-52.92486, -54.9588900),\n) %&gt;% \n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) %&gt;% \n  leaflet() %&gt;% \n  addTiles() %&gt;% \n  addMarkers(label = ~site, labelOptions = labelOptions(noHide = T))"
  },
  {
    "objectID": "index.html#poeple",
    "href": "index.html#poeple",
    "title": "TROLL V4 Evaluation",
    "section": "Poeple",
    "text": "Poeple\n\nSylvain Schmitt\nFabian J. Fischer\nJames G. C. Ball\nNicolas Barbier\nMarion Boisseaux\nDamien Bonal\nBenoit Burban\nXiuzhi Chen\nGéraldine Derroire\nJeremy W. Lichstein\nDaniela Nemetschek\nNatalia Restrepo-Coupe\nScott Saleska\nGiacomo Sellan\nPhilippe Verley\nGregoire Vincent\nCamille Ziegler\nJérôme Chave\nIsabelle Maréchaux"
  },
  {
    "objectID": "10_data.html",
    "href": "10_data.html",
    "title": "Data",
    "section": "",
    "text": "Data used for TROLL evaluation are composed of data used as inputs for TROLL simulations and data used as outputs to assess the simulations. TROLL runs with species parameters, including functional traits and allometric parameters, climate data, and soil data. We evaluated TROLL simulations against forest fluxes and final forest structure and composition. Data include thus forest inventories (species inputs, forest structure and composition evaluation), functional traits (species inputs and forest composition evaluation), soil parameters (soil inputs), climate data (climate input), and fluxes data (forest fluxes evaluation)."
  },
  {
    "objectID": "11_inventories.html#paracou",
    "href": "11_inventories.html#paracou",
    "title": "Inventories",
    "section": "Paracou",
    "text": "Paracou\n\nParacou is a large scale forest disturbance experiment set up by Cirad in 1982 that becomes in time a unique research site for the international scientific community in tropical forest ecology. https://paracou.cirad.fr/website/\n\nPI: Géraldine Derroire\nAccess: DOIs are available on the CIRAD dataverse: https://dataverse.cirad.fr/dataverse/paracou .\n\n\nCode\nread_tsv(\"outputs/inventories.tsv\", show_col_types = FALSE) %&gt;% \n  filter(site == \"Paracou\", type == \"default\") %&gt;% \n  ggplot(aes(x, y, size = dbh, col = species)) +\n  geom_point() +\n  facet_wrap(~ plot) +\n  scale_color_discrete(guide = \"none\") +\n  theme_bw() +\n  theme(axis.title = element_blank()) +\n  scale_size(guide = \"none\", range = c(0.2, 2)) +\n  coord_equal()\n\n\n\n\n\nTree distributions in the 2015 inventory of Paracou plots. Point size represents the diameter, and the colour the species."
  },
  {
    "objectID": "11_inventories.html#paracou---understory",
    "href": "11_inventories.html#paracou---understory",
    "title": "Inventories",
    "section": "Paracou - Understory",
    "text": "Paracou - Understory\n\nForest plots in French Guiana (Paracou and Nouragues) and inventory and map all trees over one cm in height at the chest, in order to advance knowledge of the ecology and services of the Amazon ecosystem.\n\nPIs: Giacomo Sellan, Gérladine Derroire, Jérôme Chave\nAccess: Upon request?\n\n\nCode\nread_tsv(\"outputs/inventories.tsv\", show_col_types = FALSE) %&gt;% \n  filter(site == \"Paracou\", type == \"understory\") %&gt;% \n  filter(!is.na(x), !is.na(y)) %&gt;% \n  ggplot(aes(x, y, size = dbh, col = species)) +\n  geom_point() +\n  scale_color_discrete(guide = \"none\") +\n  theme_bw() +\n  theme(axis.title = element_blank()) +\n  scale_size(guide = \"none\", range = c(0.2, 2)) +\n  coord_equal()\n\n\n\n\n\nTree distributions in the Understory inventory at Paracou. Point size represents the diameter, and the colour the species."
  },
  {
    "objectID": "11_inventories.html#tapajos",
    "href": "11_inventories.html#tapajos",
    "title": "Inventories",
    "section": "Tapajos",
    "text": "Tapajos\n\nThis dataset provides tree inventory, tree height, diameter at breast height (DBH), and estimated crown measurements from 30 plots located in the Tapajos National Forest, Para, Brazil collected in September 2010. The plots were located in primary forest, primary forest subject to reduced-impact selective logging (PFL) between 1999 and 2003, and secondary forest (SF) with different age and disturbance histories. Plots were centered on GLAS (the Geoscience Laser Altimeter System) LiDAR instrument footprints selected along two sensor acquisition tracks spanning a wide range in vertical structure and aboveground biomass. https://daac.ornl.gov/VEGETATION/guides/Forest_Inventory_Tapajos.html\n\nAccess: These data are available through the Oak Ridge National Laboratory (ORNL) Distributed Active Archive Center (DAAC).\n\n\nCode\nread_tsv(\"outputs/inventories.tsv\", show_col_types = FALSE) %&gt;% \n  filter(site == \"Tapajos\", type == \"default\") %&gt;% \n  ggplot(aes(x, y, size = dbh, col = species)) +\n  geom_point() +\n  facet_wrap(~ plot) +\n  scale_color_discrete(guide = \"none\") +\n  theme_bw() +\n  theme(axis.title = element_blank()) +\n  scale_size(guide = \"none\", range = c(1, 4)) +\n  coord_equal()\n\n\n\n\n\nTree distributions in the inventory of Tapajos plots. Point size represents the diameter, and the colour the species."
  },
  {
    "objectID": "11_inventories.html#airborne-lidar-scanning-als-global-ecosystem-dynamics-investigation-gedi",
    "href": "11_inventories.html#airborne-lidar-scanning-als-global-ecosystem-dynamics-investigation-gedi",
    "title": "Inventories",
    "section": "Airborne Lidar Scanning (ALS) & Global Ecosystem Dynamics Investigation (GEDI)",
    "text": "Airborne Lidar Scanning (ALS) & Global Ecosystem Dynamics Investigation (GEDI)\nFabian Fischer personal communication to detail. GEDI to describe\n\n\nCode\nparacou &lt;- rast(\"data/inventories/chm/chm_lspikefree_paracou2015.tif\") %&gt;% \n  # crop(ext(285000,286000,581500,582500)) %&gt;% \n  as.data.frame(xy = TRUE) %&gt;% \n  mutate(site = \"Paracou\") %&gt;% \n  rename(height = spat_UnJH55x5kyQCEFH_27216)\ntapajos &lt;- rast(\"data/inventories/chm/chm_lspikefree_tapajos2012.tif\") %&gt;% \n  # crop(ext(727000,728000,9683000,9684000)) %&gt;% \n  as.data.frame(xy = TRUE) %&gt;% \n  mutate(site = \"Tapajos\") %&gt;% \n  rename(height = spat_A96aTkDLpl6EakG_7172)\ng &lt;- bind_rows(paracou, tapajos) %&gt;% \n  ggplot(aes(x, y, fill = height)) +\n  geom_raster() +\n  theme_bw() +\n  facet_wrap(~site, scales = \"free\") +\n  scale_fill_viridis_c() +\n  theme(axis.title = element_blank(), axis.text = element_blank())\nggsave(\"outputs/chm_fig.png\", g)\nbind_rows(paracou, tapajos) %&gt;% \n  group_by(site, height = floor(height)) %&gt;% \n  summarise(n = n()) %&gt;% \n  group_by(site) %&gt;% \n  mutate(pct = n/sum(n)*100, type = \"ALS\") %&gt;% \n  bind_rows(read_tsv(\"data/inventories/gedi.tsv\")) %&gt;% \n  write_tsv(\"outputs/hieght_chm.tsv\")\n\n\n\n\nCode\nknitr::include_graphics(\"outputs/chm_fig.png\")\n\n\n\n\n\nCanpy Height Model (CHM) from Aerial Lidar Sensors (ALS) at Paracou an Tapajos."
  },
  {
    "objectID": "11_inventories.html#structure",
    "href": "11_inventories.html#structure",
    "title": "Inventories",
    "section": "Structure",
    "text": "Structure\nForest structure was simply assessed by DBH (m) classes using basal area (BA, m2/ha) and abundance for each plots (uncertainty bars in Paracou data).\n\n\nCode\nread_tsv(\"outputs/structure.tsv\", show_col_types = FALSE) %&gt;% \n  filter(dbh_class &gt;= 10) %&gt;% \n  group_by(site, type, dbh_class, variable) %&gt;% \n  summarise(l = quantile(observed, 0.025, na.rm = TRUE), \n            m = quantile(observed, 0.5, na.rm = TRUE), \n            h = quantile(observed, 0.975, na.rm = TRUE)) %&gt;% \n  filter(variable %in% c(\"ba\", \"log_abundance\")) %&gt;% \n  ggplot(aes(dbh_class, m, col = site)) +\n  geom_linerange(aes(ymin = l, ymax = h)) +\n  geom_point() +\n  geom_line() +\n  theme_bw() +\n  facet_wrap(~ variable, scales = \"free\") +\n  xlab(\"DBH (cm)\") + ylab(\"\") +\n  scale_color_discrete(\"\") +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\nSize structure at the Paracou and Tapajos sites, expressed in terms of abundance and basal area and including understorey trees at Paracou. Confidence intervals on inventory analysis at 95 % are shown with error bars and are based on among plots variations.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/structure.tsv\", show_col_types = FALSE) %&gt;% \n  filter(dbh_class &lt; 10) %&gt;% \n  group_by(site, type, dbh_class, variable) %&gt;% \n  summarise(l = quantile(observed, 0.025, na.rm = TRUE), \n            m = quantile(observed, 0.5, na.rm = TRUE), \n            h = quantile(observed, 0.975, na.rm = TRUE)) %&gt;% \n  filter(variable %in% c(\"ba\", \"log_abundance\")) %&gt;% \n  ggplot(aes(dbh_class, m, col = site)) +\n  geom_linerange(aes(ymin = l, ymax = h)) +\n  geom_point() +\n  geom_line() +\n  theme_bw() +\n  facet_wrap(~ variable, scales = \"free\") +\n  xlab(\"DBH (cm)\") + ylab(\"\") +\n  scale_color_discrete(\"\") +\n  theme(legend.position = \"bottom\")\n\n\n\n\n\nSize structure at the Paracou and Tapajos sites, expressed in terms of abundance and basal area and including understorey trees at Paracou. Confidence intervals on inventory analysis at 95 % are shown with error bars and are based on among plots variations.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/hieght_chm.tsv\") %&gt;% \n  filter(height &gt; 2) %&gt;% \n  ggplot(aes(height, pct, col = paste(site, type))) +\n  geom_line() +\n  theme_bw() +\n  coord_flip() +\n  ylab(\"[ % ]\") + xlab(\"Height [ m ]\") +\n  theme(legend.position = \"bottom\") +\n  scale_color_discrete(\"\")\n\n\n\n\n\nHeight structure at the Paracou and Tapajos sites."
  },
  {
    "objectID": "11_inventories.html#composition",
    "href": "11_inventories.html#composition",
    "title": "Inventories",
    "section": "Composition",
    "text": "Composition\nForest composition was simply assessed using rank abundances curves for each plots (uncertainty dotted lines in Paracou data).\n\n\nCode\nread_tsv(\"outputs/composition.tsv\", show_col_types = FALSE) %&gt;% \n  group_by(site, plot, variable) %&gt;% \n  arrange(desc(observed)) %&gt;% \n  mutate(rank = 1:n()) %&gt;% \n  group_by(site, rank, variable) %&gt;% \n  summarise(l = quantile(observed, 0.025, na.rm = TRUE), \n            m = quantile(observed, 0.5, na.rm = TRUE), \n            h = quantile(observed, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(rank, m, col = site)) +\n  geom_line(aes(y = l), linewidth = 0.5, linetype = \"dashed\") +\n  geom_line(aes(y = h), linewidth = 0.5, linetype = \"dashed\") +\n  geom_line() +\n  theme_bw() +\n  xlab(\"Rank\") + ylab(\"Abundance\") +\n  scale_color_discrete(\"\") +\n  theme(legend.position = \"bottom\") +\n  scale_y_log10()\n\n\n\n\n\nSpecies composition at the Paracou and Tapajos sites expressed in terms of species rank-abundance curve. Confidence intervals on inventory analysis at 95 % are shown with error bars and are based on among plots variations."
  },
  {
    "objectID": "12_species.html#allometric-parameters",
    "href": "12_species.html#allometric-parameters",
    "title": "Species",
    "section": "Allometric parameters",
    "text": "Allometric parameters\nWe took advantage of the TALLO database (Jucker et al. 2022) to infer species allometric parameters of the 496 species present in Amazonia (latitude between 10 and -18 and longitude between -78 and -39).\n\n\nCode\nggplot(map_data(\"world\"), aes(x = long, y = lat)) +\n  geom_polygon(aes(group = group), fill=\"lightgray\", colour = \"white\") +\n  geom_point(data = read_csv(\"data/species/tallo.csv\") %&gt;% \n               mutate(amazonia = ifelse(longitude &lt;= -39 & \n                                          longitude &gt;= -79 &\n                                          latitude &gt;= -18 &\n                                          latitude &lt;= 10, \"amazonia\", \"other\")),\n  aes(x = longitude, y = latitude, col = amazonia)) +\n  theme_bw() +\n  geom_hline(yintercept = c(10, -18)) +\n  geom_vline(xintercept = c(-39, -79)) +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  scale_color_manual(\"\", values = c(\"darkgreen\", \"black\")) +\n  coord_equal()\n\n\n\n\n\nAvailable data in Amazonia.\n\n\n\n\n\n\nCode\nread_csv(\"data/species/tallo.csv\") %&gt;% \n  filter(longitude &lt;= -39, longitude &gt;= -79, latitude &gt;= -18, latitude &lt;= 10) %&gt;% \n  ggplot(aes(stem_diameter_cm, height_m)) +\n  geom_point(aes(col = species), alpha = 0.25) +\n  theme_bw() +\n  geom_smooth() +\n  scale_color_discrete(guide = \"none\") +\n  xlab(\"diameter (cm)\") + ylab(\"height (m)\")\n\n\n\n\n\nHeight (m) and diameter (cm) relationship for observed amazonian trees.\n\n\n\n\nWe inferred the following allometry using brms:\n\\[\n\\begin{array}{c}\nlog(height) \\sim N [ log(h_{max,s} \\times \\frac{dbh}{a_{h,s}+dbh^2}), \\sigma^2] \\\\\nh_{max,s} \\sim N (h_{max}, \\sigma_h^2) \\\\\na_{h,s} \\sim N (a_{h}, \\sigma_a^2)\n\\end{array}\n\\]\n\n\nCode\nlibrary(brms)\nmdata &lt;- read_csv(\"data/species/tallo.csv\") %&gt;% \n  filter(longitude &lt;= -39, longitude &gt;= -79, latitude &gt;= -18, latitude &lt;= 10) %&gt;% \n  select(species, height_m, stem_diameter_cm) %&gt;% \n  rename(h = height_m, d = stem_diameter_cm) %&gt;% \n  mutate(d = d/100) %&gt;% \n  mutate(species = ifelse(is.na(species), \"unknown\", species))\nfit &lt;- brm(bf(log(h) ~ log(hmax * (d/ (ah + d))), \n              hmax ~ 1 + 1|species,\n              ah ~ 1 + 1|species,\n              nl = TRUE), \n           prior = c(\n             prior(normal(40, 10), lb = 10, nlpar = \"hmax\"),\n             prior(normal(0.5, 0.5), lb = 0, nlpar = \"ah\")\n             ),\n           data = mdata, chains = 2, cores = 2, threads = 10)\nsave(fit, file = \"outputs/brms_tallo.Rdata\")\nfit %&gt;% \n  tidybayes::spread_draws(b_hmax_Intercept, r_species__hmax[species,],\n               b_ah_Intercept, r_species__ah[species,]) %&gt;% \n  mutate(ah = b_ah_Intercept + r_species__ah) %&gt;% \n  mutate(hmax = b_hmax_Intercept + r_species__hmax) %&gt;% \n  group_by(species) %&gt;% \n  summarise(ah = median(ah), hmax = median(hmax)) %&gt;% \n  filter(species != \"unknown\") %&gt;% \n  mutate(species = gsub(\".\", \" \", species, fixed = TRUE)) %&gt;% \n  left_join(read_csv(\"data/species/tallo.csv\") %&gt;% \n  filter(longitude &lt;= -39, longitude &gt;= -79, latitude &gt;= -18, latitude &lt;= 10) %&gt;% \n    select(family, genus, species) %&gt;% unique()) %&gt;% \n  write_tsv(\"outputs/tallo_pars.tsv\")\n\n\nWe had good convergence and good post-predictive checks.\n\n\nCode\nload('outputs/brms_tallo.Rdata')\nbayesplot::mcmc_rhat(bayesplot::rhat(fit$fit))\n\n\n\n\n\nGoodness of convergence assessed by Rhat. All Rhat are below 1.05 indicating a very good convergence of all chains.\n\n\n\n\n\n\nCode\nload('outputs/brms_tallo.Rdata')\nbayesplot::pp_check(fit)\n\n\n\n\n\nPosterior post-predictive check of simulated response variable against observed values indicating a good representation of the whole distribution in posteriors.\n\n\n\n\nWe thus inferred 496 additional \\(a_h\\), \\(h_{max}\\) couple of parameters.\n\n\nCode\nload('outputs/brms_tallo.Rdata')\nsjPlot::tab_model(fit)\n\n\n\n\n\n \nlog(h)\n\n\nPredictors\nEstimates\nCI (95%)\n\n\nhmax_Intercept\n40.52\n38.69 – 42.38\n\n\nah_Intercept\n0.29\n0.27 – 0.31\n\n\nObservations\n24609\n\n\nR2 Bayes\n0.742\n\n\n\n\n\n\n\n\n\nCode\nfit %&gt;% \n  tidybayes::spread_draws(b_hmax_Intercept, r_species__hmax[species,],\n               b_ah_Intercept, r_species__ah[species,]) %&gt;% \n  mutate(ah = b_ah_Intercept + r_species__ah) %&gt;% \n  mutate(hmax = b_hmax_Intercept + r_species__hmax) %&gt;% \n  group_by(species) %&gt;% \n  summarise(ah = median(ah), hmax = median(hmax)) %&gt;%\n  filter(species != \"unknown\") %&gt;% \n  ggplot(aes(ah, hmax)) +\n  geom_point() +\n  theme_bw() +\n  xlab(expression(a[h])) + ylab(expression(h[max]))\n\n\n\n\n\nInferred species allometric parameters hmax and ah and their relations."
  },
  {
    "objectID": "12_species.html#functional-traits",
    "href": "12_species.html#functional-traits",
    "title": "Species",
    "section": "Functional traits",
    "text": "Functional traits\nWe further combined the obtained coefficient from TALLO with the following datasets:\n\nJucker et al. (2022)\nMaréchaux et al. (2015)\nGuillemot et al. (2022)\nVleminckx et al. (2021)\nTROLL version 4 species data\nTapajos functional traits data retrieved by Jérôme Chave (pers. com.) from the TRY database (Kattge, Bönisch, and al. 2020)\n\nTROLL version 4 species data were gathered from:\n\nTROLL version 3 species (partly from Baraloto et al. (2010), described in Maréchaux and Chave (2017), and available in @schmitt2023 and )\nMaréchaux et al. (2015)\nMaréchaux et al. (2019)\nNemetschek et al. (2024)\nSchmitt and Boisseaux (2023)\nBoisseaux et al. submitted\nZiegler et al. (2019)\n\nAll databases together included 20 traits across 2,921 species but with numerous missing data. Traits distribution were similar across datasets. However, for the same species, allometric parameters inferred from TALLO were lower than those inside TROLL V4 and leaf area from Guillemot was higher than those from TROLL and Vleminckx. As all Paracou TROLL species are in Vleminckx dataset and 109 species from Tapajos we will use only the species from Vleminckx to limit missing data in predictive mean matching (PMM) data imputation.\n\n\nCode\n# Maréchaux et al., (2015)\nmarechaux &lt;- readxl::read_xls(\"data/species/marechaux.xls\", \"data\") %&gt;% \n  mutate(Pi_tlp = as.numeric(Pi_tlp)) %&gt;% \n  separate(Binomial, c(\"genus\", \"species\"), remove = FALSE) %&gt;% \n  mutate(species = gsub(\"_\", \" \", Binomial)) %&gt;% \n  rename(family = Family, TLP = Pi_tlp) %&gt;% \n  dplyr::select(family, genus, species, TLP) %&gt;% \n  mutate(dataset = \"Maréchaux 2015\") %&gt;% \n  gather(trait, value, -dataset, -family, -genus, -species)\n# Jucker et al., (2022) inferred\ntallo &lt;- read_tsv(\"outputs/tallo_pars.tsv\") %&gt;% \n  mutate(dataset = \"Tallo inferred\") %&gt;% \n  gather(trait, value, -dataset, -family, -genus, -species)\n# Vleminckx et al., (2021)\nvleminckx &lt;- readxl::read_xlsx(\"data/species/vleminckx.xlsx\",\n                  \"App.S6-ok\", skip = 3) %&gt;% \n  mutate(species = sub(\"_\", \" \", Species)) %&gt;% \n  mutate(species = gsub(\"[[:punct:]]\", \"\", species)) %&gt;% \n  rename(family = Family, genus = Genus, CC = Chlorophyll_content,\n         LT = Thickness, LA = Leaf_Area, d13C = `13C`,\n         BT = Trunk_bark_thickness) %&gt;% \n    mutate(N = N/100, P = P/10^6, LMA = 1/SLA*1000) %&gt;% \n  mutate(LMA = ifelse(LMA &gt; 200, NA, LMA)) %&gt;% \n  dplyr::select(family, genus, species, CC, LT, \n                Toughness, LA, LMA, C, N, d13C, Ca, P, K, \n                BT, WSG, SRL, SRTA) %&gt;% \n   mutate(dataset = \"Vleminckx 2021\") %&gt;% \n  gather(trait, value, -dataset, -family, -genus, -species)\n# Guillemot et al., (2022)\nguillemot &lt;- readxl::read_xlsx(\"data/species/guillemot.xlsx\", \"Dataset\") %&gt;% \n  mutate(max_height = as.numeric(gsub(',', '.', max_height))) %&gt;% \n  rename(LA = leaf_size, N = Leaf_N, P = Leaf_P, \n         WSG = Wood_density, hmax = max_height) %&gt;% \n  mutate(TLP = ifelse(TLP &lt; -3, NA, TLP)) %&gt;% \n  mutate(P50 = ifelse(P50 &lt; -10, NA, P50)) %&gt;% \n  mutate(LA = ifelse(LA &gt; 1000, NA, LA)) %&gt;% \n  mutate(LMA = ifelse(LMA &gt; 200, NA, LMA)) %&gt;% \n  select(family, genus, species, TLP, P50, LMA, LA, WSG) %&gt;% \n  mutate(dataset = \"Guillemot 2022\") %&gt;% \n  gather(trait, value, -dataset, -family, -genus, -species)\n# TROLL V4\ntroll &lt;- rcontroll::TROLLv4_species %&gt;% \n  rename_all(~ gsub(\"s_\", \"\", .)) %&gt;% \n  rename(species = name, N =Nmass, P = Pmass,\n         WSG = wsg, TLP = tlp, LA = leafarea) %&gt;% \n   mutate(species = gsub(\"_\", \" \", species)) %&gt;% \n  select(-seedmass, -regionalfreq) %&gt;% \n  left_join(select(vleminckx, family, genus, species) %&gt;% unique()) %&gt;% \n  mutate(dataset = \"TROLL V4\") %&gt;% \n  gather(trait, value, -dataset, -family, -genus, -species)\n# Tapajos\ntapajos &lt;- vroom::vroom(\"data/species/tapajos_try.csv\") %&gt;% \n  separate(species, c(\"genus\", \"Species\"), remove = FALSE) %&gt;% \n  mutate(family = BIOMASS::getTaxonomy(genus, findOrder = FALSE)$family)  %&gt;% \n  filter(!is.na(Species)) %&gt;% \n  filter(!is.na(family)) %&gt;% \n  mutate(LMA = 1/SLA*1000, N = `N_try(mg/g)`/1000, WSG = wood_density,\n         P = `P_try(mg/g)`/1000, dbhmax = dbh_max/100) %&gt;% \n  select(family, genus, species, LMA, N, P, WSG, dbhmax) %&gt;% \n  mutate(dataset = \"Tapajos TRY\") %&gt;% \n  gather(trait, value, -dataset, -family, -genus, -species)\n# All\nraw &lt;- bind_rows(marechaux, \n                 tallo,\n                 vleminckx, \n                 guillemot, \n                 troll,\n                 tapajos) %&gt;% \n  na.omit()  \nfiltered &lt;- raw %&gt;% \n  filter(species %in% vleminckx$species) %&gt;% \n  group_by(family, genus, species, dataset, trait) %&gt;% \n  summarise(value = median(value)) %&gt;% \n  group_by(family, genus, species, trait) %&gt;% \n  summarise(value = median(value)) %&gt;% \n  pivot_wider(names_from = trait, values_from = value) %&gt;% \n  ungroup()\n\n\n\n\nCode\nfiltered %&gt;% \n  select(-family, -genus) %&gt;% \n  gather(trait, value, -species) %&gt;% \n  na.omit() %&gt;% \n  group_by(trait) %&gt;% \n  summarise(N = n()) %&gt;% \n  knitr::kable(caption = \"Available functional traits data per sepcies.\")\n\n\n\nAvailable functional traits data per sepcies.\n\n\ntrait\nN\n\n\n\n\nBT\n2043\n\n\nC\n2043\n\n\nCC\n2043\n\n\nCa\n2043\n\n\nK\n2043\n\n\nLA\n2057\n\n\nLMA\n2028\n\n\nLT\n2043\n\n\nN\n2044\n\n\nP\n2044\n\n\nP50\n43\n\n\nSRL\n2043\n\n\nSRTA\n2043\n\n\nTLP\n125\n\n\nToughness\n2043\n\n\nWSG\n2053\n\n\nah\n252\n\n\nd13C\n2043\n\n\ndbhmax\n192\n\n\nhmax\n252\n\n\n\n\n\n\n\nCode\noptions(knitr.kable.NA = '')\nraw %&gt;% \n  group_by(species, dataset) %&gt;% \n  summarise(value = 1) %&gt;% \n  pivot_wider(names_from = dataset, values_from = value) %&gt;% \n  mutate(`Vleminckx 2021` = ifelse(is.na(`Vleminckx 2021`), \"Vleminckx: no\", \"Vleminckx: yes\")) %&gt;% \n  ungroup() %&gt;% \n  select(-species) %&gt;% \n  gather(dataset, value, -`Vleminckx 2021`) %&gt;% \n  na.omit() %&gt;% \n  group_by(`Vleminckx 2021`, dataset) %&gt;% \n  summarise(N = n()) %&gt;% \n  pivot_wider(names_from = `Vleminckx 2021`, values_from = N) %&gt;% \n  knitr::kable(caption = \"Available functional traits data per species depending on the dataset and its overlap with Vleminchkx's data.\")\n\n\n\nAvailable functional traits data per species depending on the dataset and its overlap with Vleminchkx’s data.\n\n\ndataset\nVleminckx: no\nVleminckx: yes\n\n\n\n\nGuillemot 2022\n538\n57\n\n\nMaréchaux 2015\n9\n62\n\n\nTallo inferred\n302\n193\n\n\nTapajos TRY\n85\n109\n\n\nTROLL V4\n\n107\n\n\n\n\n\n\n\nCode\nraw %&gt;% \n  mutate(trait = gsub(\"_\", \" \", trait)) %&gt;% \n  ggplot(aes(dataset, value, col = dataset)) +\n  geom_boxplot() +\n  facet_wrap(~ trait, scales = \"free\") +\n  theme_bw() +\n  theme(axis.title = element_blank(), axis.text.x = element_blank(),\n        legend.position = \"bottom\") \n\n\n\n\n\nRaw distributions of functional traits data per dataset origin.\n\n\n\n\n\n\nCode\nraw %&gt;% \n  select(species, dataset, trait, value) %&gt;% \n  group_by(species, dataset, trait) %&gt;% \n  summarise(value = median(value)) %&gt;% \n  group_by(species, trait) %&gt;%\n  filter(n() &gt; 1) %&gt;%\n  mutate(median = median(value, na.rm = TRUE)) %&gt;% \n  ggplot(aes(median, value, col = dataset)) +\n  geom_point() +\n  facet_wrap(~ trait, scales = \"free\") +\n  theme_bw() +\n  geom_smooth(method = \"lm\", se = FALSE)\n\n\n\n\n\nSpecies traits means distributions per datasets in function of their median across datasets.\n\n\n\n\n\n\nCode\nfiltered %&gt;% \n  select(-family, -genus, -species) %&gt;% \n  cor(use = \"pairwise.complete.obs\") %&gt;% \n  corrplot::corrplot(type = \"upper\", diag = FALSE)\n\n\n\n\n\nSpecies traits pairwise correlations."
  },
  {
    "objectID": "12_species.html#imputation",
    "href": "12_species.html#imputation",
    "title": "Species",
    "section": "Imputation",
    "text": "Imputation\nMissing data were too important to use random forest for imputation with missForest even with phylogenetic eigen values. Thus, we used simple predictive mean matching (PMM) data imputation with mice without phylogenetic eigen values. However, phylogenetic eigen values could also been used with phylomice (not done here). As we focused on species in common with Vlemincks data we only had to impute ah, dbhmax, hmax and TLP with values from Maréchaux, Tapajos and inferred with TALLO. Obtained imputed distributions matched well the observed distribution of the raw data and imputed functional space match the one of the raw data (PCA). The PCA also revealed similar functional spaces between species from Paracou and Tapajos, whereas Tapajos functional space is a bit wider.\n\n\nCode\nimputation &lt;- filtered %&gt;% \n  mice::mice(maxit = 100)\ncomplete(imputation) %&gt;% \n  gather(trait, value, -family, -genus, -species) %&gt;% \n  mutate(type = \"imputed\") %&gt;% \n  bind_rows(gather(filtered, trait, value, -family, -genus, -species) %&gt;% \n              mutate(type = \"raw\")) %&gt;% \n  na.omit() %&gt;% \n  write_tsv(\"outputs/imputation.tsv\")\n\n\n\n\nCode\nt &lt;- vroom::vroom(\"outputs/imputation.tsv\") %&gt;% \n  filter(trait %in% c(\"ah\", \"dbhmax\", \"hmax\", \"TLP\")) %&gt;% \n  mutate(trait_long = recode(trait, \"ah\" = \"a[h]\", \"dbhmax\" = \"dbh[max]\", \"hmax\" = \"h[lim]\", \"TLP\" = \"psi[~tlp]\"))\nlabels &lt;- t %&gt;% \n  group_by(trait, type) %&gt;% \n  summarise(N = n()) %&gt;% \n  pivot_wider(names_from = type, values_from = N) %&gt;% \n  mutate(label = paste0(\"Raw: \", raw, \"\\nImputed:\", imputed)) %&gt;% \n  ungroup() %&gt;% \n  mutate(value = c(-2, 0.1, 1, 30),\n         density = c(0.25, 5, 1, 0.05)) %&gt;% \n  mutate(trait_long = recode(trait, \"ah\" = \"a[h]\", \"dbhmax\" = \"dbh[max]\", \"hmax\" = \"h[lim]\", \"TLP\" = \"psi[~tlp]\"))\ng &lt;- ggplot(t, aes(value)) +\n  geom_density(aes(col = type)) +\n  geom_text(data = labels, aes(label = label, y = density)) +\n  theme_bw() +\n  facet_wrap(~ trait_long, scales = \"free\", labeller = label_parsed) +\n  scale_color_discrete(\"\") +\n  theme(legend.position = \"bottom\", axis.title = element_blank())\nggsave(\"figures/fs01.png\", g, dpi = 300, width = 5, height = 5, bg = \"white\")\ng\n\n\n\n\n\nTraits density distribution before and after species trait values imputation by predictive means matching.\n\n\n\n\n\n\nCode\ndata &lt;- vroom::vroom(\"outputs/imputation.tsv\") %&gt;% \n  filter(trait %in% troll$trait) %&gt;% \n  pivot_wider(names_from = trait, values_from = value) %&gt;% \n  na.omit()\nautoplot(princomp(select(data, -family, -genus, -species, -type), cor = TRUE), \n         data = data, alpha = 0.25, col = \"type\",\n         loadings.label.size = 6,\n         loadings.label.colour = 'red', loadings.label.vjust = 1.1,\n         loadings.label.repel   = TRUE,\n         loadings = T, loadings.label = T, loadings.colour = 'red') +\n  coord_equal() +\n  geom_hline(aes(yintercept = 0), col = 'black', linetype = \"dotted\") +\n  geom_vline(aes(xintercept = 0), col = 'black', linetype = \"dotted\") +\n  theme_bw()\n\n\n\n\n\nTraits distribution in the first plan of a PCA before and after species trait values imputation by predictive means matching.\n\n\n\n\n\n\nCode\ndata2 &lt;- data %&gt;% \n  filter(type == \"imputed\") %&gt;% \n  mutate(tapajos = (species %in% tapajos$species)) %&gt;% \n  mutate(paracou = (species %in% troll$species)) %&gt;% \n  filter(tapajos | paracou) %&gt;% \n  mutate(forest = ifelse(tapajos, \"tapajos\", \"paracou\")) %&gt;% \n  mutate(forest = ifelse(paracou & tapajos, \"both\", forest)) %&gt;% \n  select(-tapajos, -paracou, -type)\nautoplot(princomp(select(data2, -family, -genus, -species, -forest), cor = TRUE), \n         data = data2, alpha = 0.5, col = \"forest\",\n         loadings.label.size = 6,\n         loadings.label.colour = 'red', loadings.label.vjust = 1.1,\n         loadings.label.repel   = TRUE,\n         loadings = T, loadings.label = T, loadings.colour = 'red') +\n  coord_equal() +\n  geom_hline(aes(yintercept = 0), col = 'black', linetype = \"dotted\") +\n  geom_vline(aes(xintercept = 0), col = 'black', linetype = \"dotted\") +\n  theme_bw() +\n  stat_ellipse(aes(col = forest))\n\n\n\n\n\nTraits distribution in the first plan of a PCA among sites after imputation by predictive means matching.\n\n\n\n\n\n\nCode\ndata2 %&gt;% \n  filter(forest != \"paracou\") %&gt;% \n  select(-forest, -family, -genus) %&gt;% \n  mutate(seedmass = 1, regionalfreq = 1/n()) %&gt;% \n  mutate(species = gsub(\" \", \"_\", species)) %&gt;% \n  rename(s_name = species, s_LMA = LMA, s_Nmass = N, s_Pmass = P, s_wsg = WSG,\n         s_dbhmax = dbhmax, s_hmax = hmax, s_ah = ah, \n         s_seedmass = seedmass, s_regionalfreq = regionalfreq, \n         s_tlp = TLP, s_leafarea = LA) %&gt;% \n  write_tsv(\"outputs/Tapajos_species_troll.tsv\")\ndata2 %&gt;% \n  filter(forest != \"tapajos\") %&gt;% \n  select(-forest, -family, -genus) %&gt;% \n  mutate(seedmass = 1, regionalfreq = 1/n()) %&gt;% \n  mutate(species = gsub(\" \", \"_\", species)) %&gt;% \n  rename(s_name = species, s_LMA = LMA, s_Nmass = N, s_Pmass = P, s_wsg = WSG,\n         s_dbhmax = dbhmax, s_hmax = hmax, s_ah = ah, \n         s_seedmass = seedmass, s_regionalfreq = regionalfreq, \n         s_tlp = TLP, s_leafarea = LA) %&gt;% \n  write_tsv(\"outputs/Paracou_species_troll.tsv\")"
  },
  {
    "objectID": "12_species.html#functional-composition",
    "href": "12_species.html#functional-composition",
    "title": "Species",
    "section": "Functional composition",
    "text": "Functional composition\nForest functional composition was simply assessed using functional trait distribution in each plots (repeted lines in Paracou data) at the species level in Paracou and genus level in Tapajos.\n\n\nCode\ntraits &lt;- bind_rows(read_tsv(\"outputs/Tapajos_species_troll.tsv\"),\n          read_tsv(\"outputs/Paracou_species_troll.tsv\")) %&gt;% \n  unique() %&gt;% \n  rename_all(~ gsub(\"s_\", \"\", .)) %&gt;% \n  select(-seedmass, -regionalfreq) %&gt;% \n  rename(species = name) %&gt;% \n  mutate(species = gsub(\"_\", \" \", species)) %&gt;% \n  gather(trait, trait_value, -species)\nparacou &lt;- read_tsv(\"outputs/inventories.tsv\") %&gt;% \n  filter(site == \"Paracou\", type == \"default\") %&gt;% \n  mutate(plot = ifelse(site == \"Tapajos\", 1, plot)) %&gt;% \n  filter(type == \"default\") %&gt;% \n  select(site, plot, species) %&gt;% \n  left_join(traits) %&gt;% \n  na.omit()\ntapajos &lt;- read_tsv(\"outputs/inventories.tsv\") %&gt;% \n  filter(site == \"Tapajos\", type == \"default\") %&gt;% \n  mutate(site = \"Tapajos\", plot = 1) %&gt;% \n  separate(species, \"species\") %&gt;% \n  select(plot, site, species) %&gt;% \n      left_join(traits %&gt;% \n  separate(species, \"species\") %&gt;% \n  group_by(species, trait) %&gt;% \n  summarise_all(mean)) %&gt;% \n  na.omit()\nbind_rows(paracou, tapajos) %&gt;% \n  write_tsv(\"outputs/functional_composition.tsv\")\n\n\n\n\nCode\nread_tsv(\"outputs/functional_composition.tsv\") %&gt;% \n  filter(site == \"Paracou\") %&gt;% \n  ggplot(aes(trait_value, group = plot)) +\n  geom_density(alpha = 0.5) +\n  facet_wrap(~ trait, scales = \"free\") +\n  theme_bw() +\n  ggtitle(\"Paracou\", \"546,498 inds represented on 577,761 (94.59%)\") +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  scale_color_discrete(\"\")\n\n\n\n\n\nFunctional composition at the Paracou site expressed in terms of density distribution per trait. The analyses have been done at the species level in Paracou.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/functional_composition.tsv\") %&gt;% \n  filter(site == \"Tapajos\") %&gt;% \n  ggplot(aes(trait_value, group = plot)) +\n  geom_density() +\n  facet_wrap(~ trait, scales = \"free\") +\n  theme_bw() +\n  ggtitle(\"Tapajos Genus level\", \"19,188 inds represented on 19,499 (98.65%)\") +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  scale_color_discrete(\"\")\n\n\n\n\n\nFunctional composition at the Tapajos site expressed in terms of density distribution per trait. The analyses have been done at the genus level in Tapajos.\n\n\n\n\n\n\n\n\nBaraloto, Christopher, C. E. Timothy Paine, Sandra Patiño, Damien Bonal, Bruno Hérault, and Jerome Chave. 2010. “Functional Trait Variation and Sampling Strategies in Species-Rich Plant Communities.” Functional Ecology 24 (1): 208–16. https://doi.org/10.1111/j.1365-2435.2009.01600.x.\n\n\nGuillemot, Joannès, Nicolas K. Martin-StPaul, Leticia Bulascoschi, Lourens Poorter, Xavier Morin, Bruno X. Pinho, Guerric le Maire, et al. 2022. “Small and Slow Is Safe: On the Drought Tolerance of Tropical Tree Species.” Global Change Biology 28 (8): 2622–38. https://doi.org/10.1111/gcb.16082.\n\n\nJucker, Tommaso, Fabian Jörg Fischer, Jérôme Chave, David A. Coomes, John Caspersen, Arshad Ali, Grace Jopaul Loubota Panzou, et al. 2022. “Tallo: A Global Tree Allometry and Crown Architecture Database.” Global Change Biology 28 (17): 5254–68. https://doi.org/10.1111/gcb.16302.\n\n\nKattge, Jens, Gerhard Bönisch, and et al. 2020. “TRY Plant Trait Database – Enhanced Coverage and Open Access.” Global Change Biology 26: 119–88. https://doi.org/10.1111/gcb.14904.\n\n\nMaréchaux, Isabelle, Megan K. Bartlett, Lawren Sack, Christopher Baraloto, Julien Engel, Emilie Joetzjer, and Jérôme Chave. 2015. “Drought Tolerance as Predicted by Leaf Water Potential at Turgor Loss Point Varies Strongly Across Species Within an Amazonian Forest.” Edited by Kaoru Kitajima. Functional Ecology 29 (10): 1268–77. https://doi.org/10.1111/1365-2435.12452.\n\n\nMaréchaux, Isabelle, and Jérôme Chave. 2017. “An Individual-Based Forest Model to Jointly Simulate Carbon and Tree Diversity in Amazonia: Description and Applications.” Ecological Monographs 87 (4): 632–64. https://doi.org/10.1002/ecm.1271.\n\n\nMaréchaux, Isabelle, Laurent Saint-André, Megan K. Bartlett, Lawren Sack, and Jérôme Chave. 2019. “Leaf Drought Tolerance Cannot Be Inferred from Classic Leaf Traits in a Tropical Rainforest.” Edited by Pierre Mariotte. Journal of Ecology 108 (3): 1030–45. https://doi.org/10.1111/1365-2745.13321.\n\n\nNemetschek, Daniela, Géraldine Derroire, Eric Marcon, Mélaine Aubry-Kientz, Johanna Auer, Vincyane Badouard, Christopher Baraloto, et al. 2024. “Climate Anomalies and Neighbourhood Crowding Interact in Shaping Tree Growth in Old-Growth and Selectively Logged Tropical Forests.” Journal of Ecology, January. https://doi.org/10.1111/1365-2745.14256.\n\n\nSchmitt, Sylvain, and Marion Boisseaux. 2023. “Higher Local Intra- Than Interspecific Variability in Water- and Carbon-Related Leaf Traits Among Neotropical Tree Species.” Annals of Botany 131 (5): 801–11. https://doi.org/10.1093/aob/mcad042.\n\n\nVleminckx, Jason, Claire Fortunel, Oscar Valverde-Barrantes, C. E. Timothy Paine, Julien Engel, Pascal Petronelli, Aurélie K. Dourdain, Juan Guevara, Solène Béroujon, and Christopher Baraloto. 2021. “Resolving Whole-Plant Economics from Leaf, Stem and Root Traits of 1467 Amazonian Tree Species.” Oikos 130 (7): 1193–1208. https://doi.org/10.1111/oik.08284.\n\n\nZiegler, Camille, Sabrina Coste, Clément Stahl, Sylvain Delzon, Sébastien Levionnois, Jocelyn Cazal, Hervé Cochard, et al. 2019. “Large Hydraulic Safety Margins Protect Neotropical Canopy Rainforest Tree Species Against Hydraulic Failure During Drought.” Annals of Forest Science 76 (4). https://doi.org/10.1007/s13595-019-0905-0."
  },
  {
    "objectID": "13_soil.html",
    "href": "13_soil.html",
    "title": "Soil",
    "section": "",
    "text": "Soil data have been collected by Jérémy Lischtein (pers. com.) for Paracou and Tapajos. They include:\n\nSilt, clay, and sand fraction in percent for Paracou (Van Langenhove et al. (2021): Table 1, slope SLD soils, 0-30 cm and Gourlet-Fleury et al. (2004): Table 3, deep ferralitic soils, 0-40 cm) and Tapajos (Silver et al. (2000): Table 5, gradient position 350).\nSoil Organic Carbon (SOC) in percent for Paracou (Van Langenhove et al. (2021): mean of slope SLD soil values (0-30 cm depth) in Tables 2-3, dry and wet seasons averaged) and Tapajos (Quesada et al. (2010): Table S2, 0-30 cm depth).\nDry Bulk Density (DBD) in for Paracou (Van Langenhove et al. (2021): mean over 0-30 cm depth for superficial lateral drainage (SLD) slope soils) and Tapajos (Silver et al. (2000): mean for clay soils (0-10 cm depth) from Table 1, gradient positions 350 and 400).\npH for Paracou (Van Langenhove et al. (2021): mean of slope SLD soil values 0-30 cm depth in Table 1) and Tapajos (Quesada et al. (2010): Table S2, 0-30 cm).\nCation Exchange Capcity (CEC) in miliequivalent per 100 grammes for Paracou (Sabatier et al. (1997): Table 2, SLD soils, 0-30 cm) and Tapajos (Quesada et al. (2010): Table S2, 0-30 cm depth).\nSoil depth in metre based on no drainage barrier to at least 12 m depth (Nepstad et al. 2002) for Tapajos.\n\n\n\nCode\nread_tsv(\"data/soil/TROLLv4_soil_MIP_vG_TNF.txt\") %&gt;% \n  write_tsv(\"outputs/Tapajos_soil_troll.tsv\")\nread_tsv(\"data/soil/TROLLv4_soil_MIP_vG.txt\") %&gt;% \n  write_tsv(\"outputs/Paracou_soil_troll.tsv\")\nlist(\n  tapajos = read_tsv(\"data/soil/TROLLv4_soil_MIP_vG_TNF.txt\"),\n  paracou = read_tsv(\"data/soil/TROLLv4_soil_MIP_vG.txt\")) %&gt;% \n  bind_rows(.id = \"site\") %&gt;% \n  group_by(site, proportion_Silt, proportion_Clay, proportion_Sand,\n           SOC, DBD, pH, CEC) %&gt;% \n  summarise(depth = max(layer_thickness)) %&gt;%\n  knitr::kable(col.names = c(\"\", \"silt\", \"clay\", \"sand\", \"SOC\", \"DBD\", \"pH\", \"CEC\", \"depth\"),\n               caption = \"Soil parameters per site.\")\n\n\n\nSoil parameters per site.\n\n\n\nsilt\nclay\nsand\nSOC\nDBD\npH\nCEC\ndepth\n\n\n\n\nparacou\n13.25\n21.50\n65.25\n2.37\n1.040\n4.34\n2.98\n0.97\n\n\ntapajos\n2.64\n60.09\n37.27\n2.54\n1.125\n3.84\n2.97\n12.10\n\n\n\n\n\n\n\n\n\nNepstad, D. C., P. Moutinho, M. B. Dias-Filho, E. Davidson, G. Cardinot, D. Markewitz, R. Figueiredo, et al. 2002. “The Effects of Partial Throughfall Exclusion on Canopy Processes, Aboveground Production, and Biogeochemistry of an Amazon Forest.” Journal of Geophysical Research: Atmospheres 107 (D20). https://doi.org/10.1029/2001jd000360.\n\n\nQuesada, C. A., J. Lloyd, M. Schwarz, S. Patiño, T. R. Baker, C. Czimczik, N. M. Fyllas, et al. 2010. “Variations in Chemical and Physical Properties of Amazon Forest Soils in Relation to Their Genesis.” Biogeosciences 7 (5): 1515–41. https://doi.org/10.5194/bg-7-1515-2010.\n\n\nSabatier, Daniel, Michel Grimaldi, Marie-Françoise Prévost, Julie Guillaume, Michel Godron, Mireille Dosso, and Daniel Sabatier. 1997. “The Influence of Soil Cover Organization on the Floristic and Structural Heterogeneity of a Guianan Rain Forest.” Plant Ecology Formerly “Vegetatio” 131 (1): 81–108. https://doi.org/10.1023/a:1009775025850.\n\n\nSilver, Whendee L., Jason Neff, Megan McGroddy, Ed Veldkamp, Michael Keller, and Raimundo Cosme. 2000. “Effects of Soil Texture on Belowground Carbon and Nutrient Storage in a Lowland Amazonian Forest Ecosystem.” Ecosystems 3 (2): 193–209. https://doi.org/10.1007/s100210000019.\n\n\nVan Langenhove, Leandro, Thomas Depaepe, Lore T. Verryckt, Helena Vallicrosa, Lucia Fuchslueger, Laynara F. Lugli, Laëtitia Bréchet, et al. 2021. “Impact of Nutrient Additions on Free-Living Nitrogen Fixation in Litter and Soil of Two French-Guianese Lowland Tropical Forests.” Journal of Geophysical Research: Biogeosciences 126 (7). https://doi.org/10.1029/2020jg006023."
  },
  {
    "objectID": "14_climate.html#era5-land",
    "href": "14_climate.html#era5-land",
    "title": "Climate",
    "section": "ERA5-Land",
    "text": "ERA5-Land\nERA5-Land is a global reanalysis dataset (Muñoz-Sabater et al. 2021). ERA5-Land at Paracou was retrieved from the Climate Data Store (CDS) using the R package rcontroll (Schmitt et al. 2023). ERA5-Land at Tapajos was retrieved from Open-Meteo using mamba environment and python script available in the data folder. ERA5-Land was mainly used to validate FLUXNET 2015 and gap-filling."
  },
  {
    "objectID": "14_climate.html#fluxnet-2015",
    "href": "14_climate.html#fluxnet-2015",
    "title": "Climate",
    "section": "FLUXNET 2015",
    "text": "FLUXNET 2015\nFLUXNET 2015 (Pastorello, Gilberto et al. 2020) at Paracou and Tapajos was retrieved freely from FLUXNET (the manifest is available in data). They are mainly used for TROLL model forcing but also include fluxes for TROLL simulations validation. However, FLUXNET 2015 precipitation data at Tapajos are not reliable, we thus replaced it with precipitation from ERA5-Land.\n\nThe FLUXNET2015 Dataset includes data collected at sites from multiple regional flux networks. The preparation of this FLUXNET Dataset has been possible thanks only to the efforts of many scientists and technicians around the world and the coordination among teams from regional networks.\n\nPI: Damien Bonal (Paracou), Mike Goulden (Tapajos), Scott Saleska (Tapajos)\n\n\nCode\nfluxnet &lt;- list(\n  \"Paracou\" = \"data/climate/FLX_GF-Guy_FLUXNET2015_SUBSET_HH_2004-2014_2-4.csv\",\n  \"Tapajos\" = \"data/climate/FLX_BR-Sa1_FLUXNET2015_SUBSET_HR_2002-2011_1-4.csv\"\n) %&gt;% \n  lapply(vroom::vroom, na = \"-9999\") %&gt;% \n  bind_rows(.id = \"site\") %&gt;% \n  select(site, TIMESTAMP_START, TIMESTAMP_END, P_F, SW_IN_F, \n         TA_F, VPD_F, WS_F, GPP_NT_VUT_REF, LE_F_MDS) %&gt;% \n  mutate(time = as_datetime(as.character(as.POSIXlt(as.character(TIMESTAMP_START), \n                                                    format = \"%Y%m%d%H%M\")))) %&gt;% \n  rename(rainfall = P_F, snet = SW_IN_F, temperature = TA_F, vpd = VPD_F, ws = WS_F) %&gt;% \n  mutate(vpd = vpd/10) %&gt;% \n  select(site, time, rainfall, snet, temperature, vpd, ws)\nfluxnet_tapajos &lt;- filter(fluxnet, site == \"Tapajos\")\nera &lt;- vroom::vroom(\"data/climate/era5_tapajos.csv\") %&gt;% \n  filter(year(date) &gt; 2001) %&gt;% \n  mutate(time = as_datetime(date), rainfall = precipitation) %&gt;% \n  select(time, rainfall)\nfluxnet_tapajos &lt;- fluxnet_tapajos %&gt;% \n  select(-rainfall) %&gt;% \n  left_join(era)\ntime_freq &lt;- 0.5 # TROLL v4\nstart &lt;- as_datetime(as_date(min(fluxnet_tapajos$time))) # to start from 00:30\nstop &lt;- max(fluxnet_tapajos$time) + 30*60 # to stop at 23:00\ntime &lt;- seq(start, stop, by = 60 * 60 * time_freq)\ndata &lt;- left_join(tibble(time = time),\n    fluxnet_tapajos,\n    by = \"time\"\n  ) %&gt;%\n  group_by(date = as_date(time)) %&gt;%\n  mutate(across(c(temperature, vpd, ws),\n                ~ zoo::na.spline(., time, na.rm = FALSE))) %&gt;% \n  mutate(across(c(snet),\n                ~ zoo::na.approx(., time, na.rm = FALSE))) %&gt;% \n  ungroup() %&gt;% \n  select(-date) %&gt;% \n  mutate(across(c(snet), ~ ifelse(is.na(.), 0, .))) %&gt;% \n  mutate(across(c(snet), ~ ifelse(. &lt; 0, 0, .))) %&gt;% \n  mutate(site = \"Tapajos\")\nbind_rows(filter(fluxnet, site == \"Paracou\"), data) %&gt;% \n  write_tsv(\"outputs/fluxnet_climate.tsv\")"
  },
  {
    "objectID": "14_climate.html#comparisons",
    "href": "14_climate.html#comparisons",
    "title": "Climate",
    "section": "Comparisons",
    "text": "Comparisons\nERA5-Land and FLUXNET2015 showed high correlation which comforted us in using ERA5-Land to gap-fill FLUXNET2015 precipitaiton data at Tapajos.\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  gather(variable, fluxnet, -time, -site) %&gt;% \n  left_join(read_tsv(\"data/climate/era5_Paracou.tsv\") %&gt;% \n              gather(variable, era, -time) %&gt;% \n              mutate(site = \"Paracou\")) %&gt;% \n  na.omit() %&gt;% \n  group_by(site, variable, date = floor_date(time, \"month\")) %&gt;% \n  select(-time) %&gt;% \n  mutate_all(~ ifelse(variable == \"rainfall\", sum(.), .)) %&gt;% \n  summarise_all(mean) %&gt;% \n  ggplot(aes(fluxnet, era)) +\n  geom_point(alpha = 0.5, col = \"lightgrey\") +\n  facet_wrap(~ variable, scales = \"free\") +\n  geom_abline(linetype = \"dashed\") +\n  ggpubr::stat_cor() +\n  theme_bw() +\n  ggtitle(\"Monthly variations\")\n\n\n\n\n\nComparisons of monthly means over ten years for Paracou between FLUXNET2015 and ERA5-Land weather data."
  },
  {
    "objectID": "14_climate.html#input-data",
    "href": "14_climate.html#input-data",
    "title": "Climate",
    "section": "Input data",
    "text": "Input data\nTROLL input data for climate includes:\n\ndaily rainfall (mm)\nhalf-hourly day net radiation (snet, W/m2)\nhalf-hourly day temperature (°C)\nhalf-hourly day vapor pressure deficit (vpd, Pa)\nhalf-hourly day wind speed (m/s)\n\nWe thus need to defined day limits in time at a half-hourly precision. For that we used daily variations of snet. We thus used 7-19h for Paracou and 6-18h for Tapajos.\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  group_by(site, time = hms::as_hms(time)) %&gt;% \n    summarise(l = quantile(snet, 0.025, na.rm = TRUE), \n            m = mean(snet, na.rm = TRUE), \n            h = quantile(snet, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(time = as.numeric(time)/(60*60)) %&gt;% \n  ggplot(aes(time, m, col = site, fill = site)) +\n  geom_vline(data = data.frame(time = c(7, 19, 6, 18), \n                               site = c(\"Paracou\", \"Paracou\",\n                                        \"Tapajos\", \"Tapajos\")), \n             aes(xintercept = time, col = site), \n             linetype = \"dashed\", linewidth = 1.5) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line() +\n  geom_point() +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  ggtitle(\"Half-hourly variations\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  geom_vline(xintercept = c(7, 19), linetype = \"dotted\")\n\n\n\n\n\nHalf-hourly variaations of day net radiation across ten years at Paracou and Tapajos to define day limits to be used in TROLL simulations."
  },
  {
    "objectID": "14_climate.html#dry-seasons",
    "href": "14_climate.html#dry-seasons",
    "title": "Climate",
    "section": "Dry seasons",
    "text": "Dry seasons\nFor representation and discussion purposes we defined dry season as 15-days period below 50 mm in means across years (corresponding to month below 100 mm from BONAL et al. (2008) but see Fu et al. (2013) for a more precise approach). We thus defined a 4-month dry season in Paracou from 8/1 to 12/1 and an almost 5-month dry season in Tapajos from 6/15 to 11/1.\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;%\n  group_by(site, date = floor_date(time, \"15 days\")) %&gt;% \n  summarise(rainfall = sum(rainfall, na.rm = TRUE)) %&gt;% \n  mutate(week = week(date), year = year(date)) %&gt;% \n  mutate() %&gt;% \n  ggplot(aes(week,  rainfall)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             rainfall = -Inf,\n                             end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_line(aes(group = year), col = \"grey\") +\n  theme_bw() +\n  facet_wrap(~ site) +\n  geom_smooth(col = \"black\", se = FALSE) +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  theme(axis.title = element_blank()) +\n  geom_hline(yintercept = 50, linetype = \"dashed\")\n\n\n\n\n\nFortnightly means of precipitation in Paracou and Tapajos across ten years used to define dry site’s climatological dry season."
  },
  {
    "objectID": "14_climate.html#variations-in-time",
    "href": "14_climate.html#variations-in-time",
    "title": "Climate",
    "section": "Variations in time",
    "text": "Variations in time\nFor data exploration purposes, we represented climate variations at multiple time steps (year, month, half-month, week, day, and half-hour), but ultimately TROLL is forced with half-hourly variations except for precipitation which is daily.\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  gather(variable, value, -site, -time) %&gt;% \n  group_by(site, variable, date = date(time)) %&gt;% \n  select(-time) %&gt;% \n   mutate(value = ifelse(variable %in% c(\"rainfall\", \"snet\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n  summarise_all(mean) %&gt;% \n  group_by(site, variable, year = year(date)) %&gt;% \n  select(-date) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"rainfall\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n    summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(year, m, col = site, fill = site)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line() +\n  geom_point() +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = c(0.8, 0.2)) +\n  ggtitle(\"Yearly variations of daily means\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ variable, scales = \"free_y\")\n\n\n\n\n\nYearly means of climate variables at Paracou and Tapajos across ten years.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  gather(variable, value, -site, -time) %&gt;% \n  group_by(site, variable, date = floor_date(time, \"month\")) %&gt;% \n  select(-time) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"rainfall\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n  summarise_all(mean) %&gt;%\n  group_by(month = month(date)) %&gt;% \n  mutate(week = mean(week(date))) %&gt;%  \n  group_by(site, variable, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m, col = site, fill = site)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line() +\n  geom_point() +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = c(0.8, 0.2)) +\n  ggtitle(\"Monthly means variations\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ variable, scales = \"free_y\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))\n\n\n\n\n\nMean annual cycle of monthly means of climate variables at Paracou and Tapajos across ten years\n\n\n\n\n\n\nCode\nfloor_biweek &lt;- function(full) \n  as_date(paste0(year(full), \"-\", month(full), \"-\", ifelse(day(full) &gt; 15, 15, 1)))\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  gather(variable, value, -site, -time) %&gt;% \n  group_by(site, variable, date = floor_date(time, \"15 days\")) %&gt;% \n  select(-time) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"rainfall\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n  summarise_all(mean) %&gt;%\n  mutate(week = week(floor_biweek(date))) %&gt;%  \n  group_by(site, variable, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m, col = site, fill = site)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_smooth(se = FALSE) +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = c(0.8, 0.2)) +\n  ggtitle(\"15-days means variations\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ variable, scales = \"free_y\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))\n\n\n\n\n\nMean annual cycle of fortnightly means of climate variables at Paracou and Tapajos across ten years.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  gather(variable, value, -site, -time) %&gt;% \n  group_by(site, variable, date = floor_date(time, \"week\")) %&gt;% \n  select(-time) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"rainfall\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n  summarise_all(mean) %&gt;%\n  group_by(site, variable, week = week(date)) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"rainfall\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m, col = site, fill = site)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line() +\n  geom_point() +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = c(0.8, 0.2)) +\n  ggtitle(\"Weekly means variations\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ variable, scales = \"free_y\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))\n\n\n\n\n\nMean annual cycle of weekly means of climate variables at Paracou and Tapajos across ten years.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  gather(variable, value, -site, -time) %&gt;% \n  group_by(site, variable, date = floor_date(time, \"day\")) %&gt;% \n  select(-time) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"rainfall\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n  summarise_all(mean) %&gt;%\n  group_by(site, variable, day = yday(date)) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(day, m, col = site, fill = site)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line() +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = c(0.8, 0.2)) +\n  ggtitle(\"Weekly means variations\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ variable, scales = \"free_y\") +\n    scale_x_continuous(breaks = yday(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))\n\n\n\n\n\nMean annual cycle of daily means of climate variables at Paracou and Tapajos across ten years.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  gather(variable, value, -site, -time) %&gt;% \n  filter(variable %in% c(\"snet\", \"temperature\", \"vpd\", \"ws\")) %&gt;% \n  group_by(site, variable, time = hms::as_hms(time)) %&gt;% \n    summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(time = as.numeric(time)/(60*60)) %&gt;% \n  ggplot(aes(time, m, col = site, fill = site)) +\n  geom_vline(data = data.frame(time = c(7, 19, 6, 18), \n                               site = c(\"Paracou\", \"Paracou\",\n                                        \"Tapajos\", \"Tapajos\")), \n             aes(xintercept = time, col = site), linetype = \"dashed\") +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line() +\n  geom_point() +\n  theme_bw() +\n  facet_wrap(~ variable, scales = \"free\") +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  ggtitle(\"Half-hourly variations\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\")\n\n\n\n\n\nMean daily cycle of half-hourly means of climate variables at Paracou and Tapajos across ten years.\n\n\n\n\n\n\n\n\nBONAL, DAMIEN, ALEXANDRE BOSC, STÉPHANE PONTON, JEAN-YVES GORET, BENOÎT BURBAN, PATRICK GROSS, JEAN-MARC BONNEFOND, et al. 2008. “Impact of Severe Dry Season on Net Ecosystem Exchange in the Neotropical Rainforest of French Guiana.” Global Change Biology 14 (8): 1917–33. https://doi.org/10.1111/j.1365-2486.2008.01610.x.\n\n\nFu, Rong, Lei Yin, Wenhong Li, Paola A. Arias, Robert E. Dickinson, Lei Huang, Sudip Chakraborty, et al. 2013. “Increased Dry-Season Length over Southern Amazonia in Recent Decades and Its Implication for Future Climate Projection.” Proceedings of the National Academy of Sciences 110 (45): 18110–15. https://doi.org/10.1073/pnas.1302584110.\n\n\nMuñoz-Sabater, Joaquín, Emanuel Dutra, Anna Agustí-Panareda, Clément Albergel, Gabriele Arduini, Gianpaolo Balsamo, Souhail Boussetta, et al. 2021. “ERA5-Land: A State-of-the-Art Global Reanalysis Dataset for Land Applications.” Earth System Science Data 13 (9): 4349–83. https://doi.org/10.5194/essd-13-4349-2021.\n\n\nPastorello, Gilberto, Trotta, Carlo, Canfora, Eleonora, Chu, Housen, Christianson, Danielle, Cheah, You-Wei, Poindexter, Cristina, et al. 2020. “The FLUXNET2015 Dataset and the ONEFlux Processing Pipeline for Eddy Covariance Data.” Nature Publishing Group. https://doi.org/10.5167/UZH-190509.\n\n\nSchmitt, Sylvain, Guillaume Salzet, Fabian Jörg Fischer, Isabelle Maréchaux, and Jerome Chave. 2023. “Rcontroll: An R Interface for the Individual-Based Forest Dynamics Simulator TROLL.” Methods in Ecology and Evolution 14 (11): 2749–57. https://doi.org/10.1111/2041-210x.14215."
  },
  {
    "objectID": "15_fluxes.html#carbon-and-water-fluxes---fluxnet",
    "href": "15_fluxes.html#carbon-and-water-fluxes---fluxnet",
    "title": "Fluxes",
    "section": "Carbon and water fluxes - FLUXNET",
    "text": "Carbon and water fluxes - FLUXNET\nFLUXNET 2015 (Pastorello, Gilberto et al. 2020) at Paracou and Tapajos was retrieved freely from FLUXNET (the manifest is available in data). They are mainly used for TROLL model forcing but also include fluxes for TROLL simulations validation including growth primary productivity (GPP) and evapotranspiration (ET). We also computed Photosynthetically Active Radiation (PAR) as it is a driver of GPP, and daily maximum Vapour Pressure Deficit (VPD) as it is a driver of ET. We removed GPP and ET data between 2006 and 2009 in Tapajos due to a known incident with the sensors.\n\nThe FLUXNET2015 Dataset includes data collected at sites from multiple regional flux networks. The preparation of this FLUXNET Dataset has been possible thanks only to the efforts of many scientists and technicians around the world and the coordination among teams from regional networks.\n\nPI: Damien Bonal (Paracou), Mike Goulden (Tapajos), Scott Saleska (Tapajos)\n\n\nCode\nlambda &lt;- function(t_air) 2.501 - (2.361*10^-3)*t_air\nfluxnet &lt;- list(\n  \"Paracou\" = \"data/climate/FLX_GF-Guy_FLUXNET2015_SUBSET_HH_2004-2014_2-4.csv\",\n  \"Tapajos\" = \"data/climate/FLX_BR-Sa1_FLUXNET2015_SUBSET_HR_2002-2011_1-4.csv\"\n) %&gt;% \n  lapply(vroom::vroom, na = \"-9999\") %&gt;% \n  bind_rows(.id = \"site\") %&gt;% \n  select(site, TIMESTAMP_START, TIMESTAMP_END, P_F, SW_IN_F, \n         TA_F, VPD_F, WS_F, GPP_NT_VUT_REF, LE_F_MDS) %&gt;% \n  mutate(time = as_datetime(as.character(as.POSIXlt(as.character(TIMESTAMP_START), \n                                                    format = \"%Y%m%d%H%M\")))) %&gt;% \n  rename(rainfall = P_F, snet = SW_IN_F, temperature = TA_F, vpd = VPD_F, ws = WS_F,\n         gpp = GPP_NT_VUT_REF, le = LE_F_MDS) %&gt;% \n  mutate(et = 10^-6*le*60*30 / lambda(temperature)) %&gt;% # W.m-2.half-hour to MJ.s-1 to kg.m-2.half-hour\n  mutate(et = ifelse(hour(time) %in% 7:18, et, NA)) %&gt;% \n  mutate(vpd = vpd/10,\n         gpp = gpp/100, par = snet*2.27*60*30/10^3) %&gt;% \n  select(site, time, vpd, par, gpp, et, rainfall, ws,temperature)\nfluxnet_tapajos &lt;- filter(fluxnet, site == \"Tapajos\")\nera &lt;- vroom::vroom(\"data/climate/era5_tapajos.csv\") %&gt;% \n  filter(year(date) &gt; 2001) %&gt;% \n  mutate(time = as_datetime(date), rainfall = precipitation) %&gt;% \n  select(time, rainfall)\nfluxnet_tapajos &lt;- fluxnet_tapajos %&gt;% \n  select(-rainfall) %&gt;% \n  left_join(era)\ntime_freq &lt;- 0.5 # TROLL v4\nstart &lt;- as_datetime(as_date(min(fluxnet_tapajos$time))) # to start from 00:30\nstop &lt;- max(fluxnet_tapajos$time) + 30*60 # to stop at 23:00\ntime &lt;- seq(start, stop, by = 60 * 60 * time_freq)\ndata &lt;- left_join(tibble(time = time),\n    fluxnet_tapajos,\n    by = \"time\"\n  ) %&gt;%\n  group_by(date = as_date(time)) %&gt;%\n  mutate(across(c(temperature, vpd, ws, gpp),\n                ~ zoo::na.spline(., time, na.rm = FALSE))) %&gt;% \n  mutate(across(c(par, et),\n                ~ zoo::na.approx(., time, na.rm = FALSE))) %&gt;% \n  ungroup() %&gt;% \n  select(-date) %&gt;% \n  mutate(across(c(par), ~ ifelse(is.na(.), 0, .))) %&gt;% \n  mutate(across(c(par), ~ ifelse(. &lt; 0, 0, .))) %&gt;% \n  mutate(site = \"Tapajos\")\nbind_rows(filter(fluxnet, site == \"Paracou\"), data) %&gt;% \n    mutate(vpd_max = vpd) %&gt;% \n  select(-vpd) %&gt;% \n  gather(variable, value, -site, -time) %&gt;% \n  group_by(site, variable, date = date(time)) %&gt;%\n  select(-time) %&gt;% \n  mutate(value = ifelse(value %in% c(\"et\", \"par\", \"rainfall\"),\n                           sum(value, na.rm = T), value)) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"vpd_max\"),\n                           max(value, na.rm = T), value)) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;% \n  mutate(value = ifelse(variable %in% c(\"et\", \"gpp\") & \n                          site == \"Tapajos\" & year(date) %in% 2006:2009,\n                           NA, value)) %&gt;% \n  write_tsv(\"outputs/fluxnet_fluxes.tsv\")\n\n\n\n\nCode\nread_tsv(\"outputs/fluxnet_fluxes.tsv\") %&gt;% \n  ggplot(aes(date, value, col = site)) +\n  geom_line(alpha = 0.5) +\n  geom_line(data = read_tsv(\"outputs/fluxnet_fluxes.tsv\") %&gt;% \n  group_by(variable, site, date = floor_date(date, \"month\")) %&gt;% \n  summarise_all(mean)) +\n  theme_bw() +\n  facet_wrap(~ variable, scales = \"free_y\") +\n  theme(axis.title = element_blank())\n\n\n\n\n\nYearly means of fluxes at Paracou and Tapajos across ten years.\n\n\n\n\n\n\nCode\nfloor_biweek &lt;- function(full) \n  as_date(paste0(year(full), \"-\", month(full), \"-\", ifelse(day(full) &gt; 15, 15, 1)))\nread_tsv(\"outputs/fluxnet_fluxes.tsv\") %&gt;% \n  group_by(site, variable, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(floor_biweek(date))) %&gt;%  \n  group_by(site, variable, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m, col = site, fill = site)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_smooth(se = FALSE) +\n  theme_bw() +\n  theme(axis.title = element_blank()) +\n  ggtitle(\"15-days means variations\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ variable, scales = \"free_y\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))\n\n\n\n\n\nMean annual cycle of fortnightly means of fluxes at Paracou and Tapajos across ten years."
  },
  {
    "objectID": "15_fluxes.html#carbon-flux---tropomi-sif",
    "href": "15_fluxes.html#carbon-flux---tropomi-sif",
    "title": "Fluxes",
    "section": "Carbon flux - TROPOMI SIF",
    "text": "Carbon flux - TROPOMI SIF\nTapajos and Paracou Solar Induced Fluorescence (SIF) from TROPOMI satellites was retrieved from https://figshare.com/ndownloader/articles/19336346/versions/2 and processed with the R script available in data. The SIF values were converted in Growth Primary Productivity (GPP) using \\(GPP = 15.343 \\times SIF\\) following Chen et al. (2022).\n\n\nCode\nread_tsv(\"data/fluxes/rtsif.tsv\") %&gt;% \n  mutate(value = rtsif*15.343*365/10^3) %&gt;% \n  ggplot(aes(date, value)) +\n  geom_line(alpha = 0.5, aes(col = site)) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  xlab(\"\") + ylab(\"Growth Primary Productivity (kgC/m2/yr)\")\n\n\n\n\n\n8-days variations of GPP derived from TROPOMI SIF at Paracou and Tapajos across twenty years.\n\n\n\n\n\n\nCode\nread_tsv(\"data/fluxes/rtsif.tsv\") %&gt;% \n  mutate(value = rtsif*15.343*365/10^3) %&gt;% \n  mutate(week = week(date)) %&gt;% \n  group_by(site, week) %&gt;% \n  summarise(l = quantile(value*5, 0.025, na.rm = TRUE), \n            m = quantile(value*5, 0.5, na.rm = TRUE), \n            h = quantile(value*5, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m, col = site, fill = site)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_smooth(se = FALSE) +\n  geom_point() +geom_line() +\n  theme_bw() +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  xlab(\"\") + ylab(\"Growth Primary Productivity (kgC/m2/yr)\")\n\n\n\n\n\nMean annual cycle of 8-days GPP derived from TROPOMI SIF at Paracou and Tapajos across ten years."
  },
  {
    "objectID": "15_fluxes.html#soil-water-content---guyaflux",
    "href": "15_fluxes.html#soil-water-content---guyaflux",
    "title": "Fluxes",
    "section": "Soil water content - Guyaflux",
    "text": "Soil water content - Guyaflux\nGuyaflux are Paracou Eddy Flux tower raw data (BONAL et al. 2008) from 2004 to 2022. Vapour Pressure Deficit (VPD, kPa) is computed from relative humidity (%). Data are available on demand and can be partly retrieved from PLUMBER2 (Ukkola, Abramowitz, and De Kauwe 2022) or FLUXNET (Pastorello, Gilberto et al. 2020). Guyaflux was mainly used for TROLL simulations validation including soil water content (SWC) at different depths.\nPI: Damien Bonal\n\n\nCode\nread_csv2(\"data/climate/GX-METEO^MEDDY-2004-2022.csv\",\n      locale = locale(decimal_mark = \",\")) %&gt;% \n  group_by(Year) %&gt;% \n  mutate(date = as_date(paste0(min(Year), \"/\", min(Month),\n                               \"/\", min(`Julian Day`))) + (`Julian Day` - 1)) %&gt;% \n    separate(`Hour/min`, c(\"hour\", \"minute\")) %&gt;% \n  ungroup() %&gt;% \n  mutate(minute = ifelse(is.na(minute), 0, 60*as.numeric(minute)/10)) %&gt;% \n  mutate(time = as_datetime(paste(as.character(date), paste0(hour, \":\", minute, \":00\")))) %&gt;% \n  mutate(time = time - 30*60) %&gt;% \n  filter(year(time)  %in% 2004:2014) %&gt;% \n  mutate(swc10 = `SWC (-10 cm)`,\n         swc20 = `SWC (-20 cm)`,\n         swc80 = `SWC (-80 cm)`,\n         swc160 = `SWC (-160 cm)`,\n         swc260 = `SWC (-260 cm)`) %&gt;%\n  mutate(site = \"Paracou\") %&gt;% \n  select(site, time, swc10, swc20, swc80, swc160, swc260) %&gt;% \n  group_by(site, date = date(time)) %&gt;% \n  summarise_all(mean, na.rm = TRUE) %&gt;% \n  select(-time) %&gt;% \n  gather(variable, value, -site, -date) %&gt;% \n  na.omit() %&gt;% \n  write_tsv(\"outputs/guyaflux_swc.tsv\")\n\n\n\n\nCode\nread_tsv(\"outputs/guyaflux_swc.tsv\") %&gt;% \n  mutate(depth = as.numeric(gsub(\"swc\", \"\", variable))) %&gt;% \n  group_by(depth, day = yday(date)) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(day, m, col = depth, fill = depth, group = depth)) +\n   annotate(\"rect\", xmin = 214, xmax = 306, fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line() +\n  theme_bw() +\n  scale_color_viridis_c(direction = -1) +\n  scale_fill_viridis_c(direction = -1) +\n  theme(axis.title = element_blank()) +\n  ggtitle(\"Daily means variations of SWC in Paracou\") +\n  scale_x_continuous(breaks = c(1, 32, 61, 92, 122, 153, 183, 214, 245, 275, 306, 336),\n                   labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))\n\n\n\n\n\nMean annual cycle of daily means of soil water content at Paracou across ten years and for 5 differents depths."
  },
  {
    "objectID": "15_fluxes.html#litterfall",
    "href": "15_fluxes.html#litterfall",
    "title": "Fluxes",
    "section": "Litterfall",
    "text": "Litterfall\nParacou litterfall were provided by Damien Bonal (D. Bonal pers. com.). Tapajos litterfall are available online through the Oak Ridge National Laboratory (ORNL) Distributed Active Archive Center (DAAC): https://daac.ornl.gov/LBA/guides/CD10_Litter_Tapajos.html . Litterfall data were mainly used for the calibration of the new leaf phenology module in TROLL version 4. Leaf litterfall data were converted in fluxes over a defined time lag (depending on site and sampling date). For calibration two indices were derived for each years:\n\nDay of the litterfall pike as the day of the maximum annual value\nThe litterfall rate is the ratio between the pike value (average of the annual maximum value and the previous and following values) divided by the base flow (average values between January and April)\n\n\n\nCode\nprop_paracou &lt;- vroom::vroom(\"data/fluxes/prop_litterfall.csv\", n_max = 4) %&gt;% \n  filter(date == \"feuille\") %&gt;% \n  select(-date) %&gt;% \n  gather(date, prop_leaf)  %&gt;% \n  mutate(date = as_date(date, format = \"%d/%m/%Y\")) %&gt;% \n  na.omit() %&gt;% \n  group_by(month = month(date)) %&gt;% \n  summarise(prop_leaf = quantile(prop_leaf, 0.5, na.rm = TRUE)/100)\nlitter_paracou &lt;- vroom::vroom(\"data/fluxes/litterfall_2003_2022.csv\") %&gt;% \n  rename(\"collector\" = \"Numero collecteur\", \"subplot\" = \"Carre guyaflux\") %&gt;% \n  gather(date, litter, -collector, -subplot) %&gt;% \n  mutate(date = as_date(date, format = \"%d/%m/%Y\")) %&gt;% \n  na.omit() %&gt;% \n  group_by(date) %&gt;% \n  summarise(litter = mean(litter)) %&gt;% \n  mutate(dt = as.numeric(date - lag(date))) %&gt;% \n  mutate(month = month(date)) %&gt;% \n  left_join(prop_paracou) %&gt;% \n  na.omit() %&gt;% \n  mutate(litterfall = litter*prop_leaf/dt/0.45*3.65) %&gt;% # only leaf from x/x/x to MgC/ha/year\n  mutate(site = 'Paracou') %&gt;% \n  select(date, dt, litterfall, site)\nlitter_tapajos &lt;- vroom::vroom(\"data/fluxes/CD10_Litter_Tapajos_862/data/lba_km67_litter_archive.txt\") %&gt;% \n  mutate(date = lubridate::as_date(as.character(YYYYMMDD), format = \"%Y%m%d\")) %&gt;% \n  mutate(site = 'Tapajos', litterfall = leaf, dt = dT) %&gt;% \n  select(date, dt, litterfall, site)\nbind_rows(litter_paracou, litter_tapajos) %&gt;% \n  write_tsv(file = \"outputs/litter.tsv\")\n\n\n\n\nCode\nobs_metrics &lt;- read_tsv(\"outputs/litter.tsv\") %&gt;% \n  group_by(site, year = year(date)) %&gt;% \n  summarise(pike = mean(c(litterfall[which.max(litterfall)],\n                          litterfall[which.max(litterfall)-1],\n                          litterfall[which.max(litterfall)+1]), na.rm = TRUE),\n            pike_date = date[which.max(litterfall)],\n            basal = mean(as.numeric(month(date) %in% 1:4)*litterfall, na.rm = TRUE)) %&gt;%  \n  mutate(pike_day = yday(pike_date), ratio = pike / basal) %&gt;% \n  filter(basal &gt; 0, pike_day &gt; 100)\n\n\n\n\nCode\nread_tsv(\"outputs/litter.tsv\") %&gt;% \n  ggplot(aes(date, litterfall, col = dt)) +\n  geom_line(col = \"lightgrey\", alpha = 0.5) +\n  geom_point() +\n  theme_bw() +\n  facet_wrap(~ site, scales = \"free\", nrow = 2) +\n  scale_color_viridis_c(\"Time lapse\") +\n  xlab(\"\") + ylab(\"Observed litterfall (MgC/ha/yr)\") +\n  geom_vline(aes(xintercept = pike_date), \n             data = obs_metrics, col = \"red\", linetype = \"dashed\") +\n  geom_point(aes(x = pike_date, y = pike), \n             data = obs_metrics, col = \"red\", size = 2)\n\n\n\n\n\nFortnightly measurement of litterfall at Tapajos and Paracou. Time lapse between two sampling is over 15-days for few measurement indicated by point colour. Annual pike of litterfall are indicated by the red lines and thier value by the red points.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/litter.tsv\") %&gt;% \n  ggplot(aes(yday(date), litterfall, col = year(date))) +\n  geom_smooth(method = \"lm\", formula = y ~ poly(x, 20, raw = TRUE)) +\n  geom_line(aes(group = as.factor(year(date))), col = \"lightgrey\", alpha = 0.5) +\n  geom_point() +\n  theme_bw() +\n  facet_wrap(~ site, scales = \"free\", nrow = 2) +\n  scale_color_viridis_c(\"Year\") +\n  xlab(\"\") + ylab(\"Observed litterfall (MgC/ha/yr)\") +\n  scale_x_continuous(breaks = yday(as_date(paste0(\"2001-\", 1:12, \"-1\"))),\n                   labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  geom_point(aes(x = pike_day, y = pike), \n             data = obs_metrics, col = \"red\", size = 2)\n\n\n\n\n\nAnnual cycle of fortnightly measurement of litterfall at Tapajos and Paracou. Annual pike of litterfall are indicated by the red point.\n\n\n\n\n\n\nCode\nobs_metrics %&gt;% \n  ggplot(aes(pike_day, ratio, col = site, size = year)) +\n  geom_point() +\n  theme_bw() +\n  ylab(\"Observed litterfall ratio\") +\n  xlab(\"Observed litterfall pike day\")\n\n\n\n\n\nRelations betweens Litterfall pike date and ratioi across years at Paracou and Tapajos."
  },
  {
    "objectID": "15_fluxes.html#canopy-structure",
    "href": "15_fluxes.html#canopy-structure",
    "title": "Fluxes",
    "section": "Canopy structure",
    "text": "Canopy structure\nCanopy structure and dynamics was assessed using Leaf Area Index (LAI), Leaf Area Density (LAD) and Plant Area Density (PAD) from local observation using terrestrial or drone LIDAR remotely-sensed by MODIS. LIDAR data includes drone data from Paracou provided by Nicolas Barbier Bonal (G. Vincent & N. Barbier pers. com.) and terrestrial data from Tapajos etrieved from Smith et al. (2019): https://nph.onlinelibrary.wiley.com/doi/10.1111/nph.15726. Remotely-sensed data from MODIS were retrieved from PLUMBER2 on Research Data Australia: https://researchdata.edu.au/plumber2-forcing-evaluation-surface-models/1656048. Leaf area index was also extracted from PhenoCam of Wu et al. (2017) by X. Chen (pers. com.). Leaf area index per leaf cohort (LAI_age) was retrieved from Yang et al. (2023), from PhenoCam of Wu et al. (2017) by X. Chen (pers. com.), and reanalaysed by X. Chen et al. (in prep).\n\n\nCode\nlibrary(sf)\nlibrary(terra)\nlibrary(ncdf4)\nroi &lt;- invisible(st_read(\"data/fluxes/paddense_central.gpkg\"))\npath &lt;- \"data/fluxes/dense_vox1m_angle45_newTif/\"\nfiles &lt;- list.files(path, full.names = TRUE)\nnames(files) &lt;- list.files(path)\npad &lt;- lapply(files, rast) %&gt;%\n  lapply(function(r) {\n    names(r) &lt;- c(\"dtm\", \"chm\", \"density\", \"angle\", \"bsi3m\", \"fpl3m\", \"pad3m\")\n    return(r)}) %&gt;%\n  lapply(terra::extract, roi) %&gt;%\n  bind_rows(.id = \"time\") %&gt;%\n  mutate(time = gsub(\".tif\", \"\", time)) %&gt;%\n  mutate(time = gsub(\"YS-\", \"\", time)) %&gt;%\n  mutate(time = as_datetime(time))\npad &lt;- pad %&gt;%\n  group_by(date = date(time)) %&gt;%\n  summarise(value = quantile(pad3m, 0.5, na.rm = T)*10) %&gt;% \n  mutate(site = \"Paracou\", variable = \"PAD\")\ndates &lt;- readxl::read_xlsx(\"~/Documents/data/Tapajos/nph15726-sup-0002-notess4.xlsx\", \n                  \"abs_height\", col_names = FALSE, skip = 0, n_max = 1) %&gt;% \n  select(-`...1`) %&gt;% \n  gather(key, date) %&gt;% \n  mutate(key = as.character(1:n()))\nlad &lt;- readxl::read_xlsx(\"~/Documents/data/Tapajos/nph15726-sup-0002-notess4.xlsx\", \n                  \"abs_height\", col_names = c(\"height\", dates$key), skip = 1) %&gt;% \n  gather(key, lad, -height) %&gt;% \n  left_join(dates) %&gt;% \n  mutate(date = as_date(date))\nlad &lt;- lad %&gt;%\n  group_by(date) %&gt;% \n  summarise(value = sum(lad)) %&gt;% \n  mutate(site = \"Tapajos\", variable = \"LAD\")\nr1 &lt;- nc_open(\"~/Documents/data/PLUMBER2/GF-Guy_2004-2014_FLUXNET2015_Met.nc\")\nr2 &lt;- nc_open(\"~/Documents/data/PLUMBER2/BR-Sa3_2001-2003_FLUXNET2015_Met.nc\")\nlai &lt;- list(Paracou = data.frame(lai = ncvar_get(r1, \"LAI\"),\n             time  = as_datetime(ncatt_get(r1, \"time\")$units) +\n             ncvar_get(r1, \"time\")),\n     Tapajos = data.frame(lai = ncvar_get(r2, \"LAI_alternative\"),\n             time  = as_datetime(ncatt_get(r2, \"time\")$units) +\n             ncvar_get(r2, \"time\"))) %&gt;% \n  bind_rows(.id = \"site\") %&gt;% \n  group_by(site, date = date(time), variable = \"LAI\") %&gt;% \n  summarise(value = mean(lai))\nbind_rows(pad, lad, lai) %&gt;% \n  write_tsv(file = \"outputs/lai.tsv\")\n\n\n\n\nCode\nread_tsv(\"outputs/lai.tsv\") %&gt;% \n  bind_rows(readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\") %&gt;% \n              mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n              mutate(site = \"Tapajos\", variable = \"PhenoCam\", \n                     value = `Camera_LAI (m^2 m^-2)`) %&gt;% \n              select(date, value, site, variable)) %&gt;% \n  mutate(week = week(date)) %&gt;%  \n  ggplot(aes(week, value, col = site, fill = site)) +\n  geom_line(aes(group = year(date))) +\n  geom_smooth(se = FALSE) +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ variable) +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))\n\n\n\n\n\nAnnual cycle of leaf area density variation at Paracou and Tapajos measured every 8-days by satellite (LAI) across ten years, every 15-days by drone in Paracou across three years, or every 15-days at Tapajos from the ground in Tapajos for three years or from PhenoCam in Tapajos for one year (Wu et al. 2016).\n\n\n\n\n\n\nCode\ncols_laid &lt;- c(\"young\" = \"#2bd22c\", \"mature\" = \"#197b14\", \"old\" = \"#ffa006\")\nread_tsv(\"data/fluxes/lai_age.tsv\") %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n            ymin = -Inf, ymax = Inf, alpha = 0.5,\n            data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                              m = -Inf,\n                              end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                              site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_ribbon(aes(ymin = l, ymax = h, fill = age), col = NA, alpha = 0.2) +\n  geom_smooth(aes(col = age), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_grid(type ~ site, scales = \"free_x\") +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) + \n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-~2}~\"]\")) + xlab(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols_laid[c(\"mature\", \"old\", \"young\")])) +\n  scale_fill_manual(\"\", values = as.vector(cols_laid[c(\"mature\", \"old\", \"young\")]))\n\n\n\n\n\nMean annual cycle from fortnightly means of leaf area index for Paracou and Tapajos with leaf cohorts of yound, mature and old leaves from Yang et al. (2023). Bands are the intervals of means across years, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\nlai_age_wu &lt;- readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\", 2) %&gt;% \n  rename(young = `Obs_LAIyoung (m^2 m^-2)`,\n         mature = `Obs_LAImature (m^2 m^-2)`,\n         old = `Obs_LAIold (m^2 m^-2)`) %&gt;% \n  mutate(site = \"Tapajos\", type = \"Wu et al. (2016)\") %&gt;% \n  mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n  mutate(week = week(date)) %&gt;% \n  select(site, week, type, young, mature, old) %&gt;% \n  gather(age, m, -site, -week, -type)\nlai_age_chen &lt;- readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\", 3) %&gt;% \n  mutate(site = recode(Site, \"K67\" = \"Tapajos\")) %&gt;% \n  rename(young = `LAIyoung (m^2 m^-2)`,\n         mature = `LAImature (m^2 m^-2)`,\n         old = `LAIold (m^2 m^-2)`) %&gt;% \n  mutate(type = \"Chen et al. (in prep)\") %&gt;% \n  mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n  mutate(week = week(date)) %&gt;% \n  select(site, week, type, young, mature, old) %&gt;% \n  gather(age, m, -site, -week, -type)\ncols_laid &lt;- c(\"young\" = \"#2bd22c\", \"mature\" = \"#197b14\", \"old\" = \"#ffa006\")\nbind_rows(lai_age_wu, lai_age_chen) %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n            ymin = -Inf, ymax = Inf, alpha = 0.5,\n            data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                              m = -Inf,\n                              end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                              site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_smooth(aes(col = age), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_grid(type ~ site, scales = \"free_x\") +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) + \n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-~2}~\"]\")) + xlab(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols_laid[c(\"mature\", \"old\", \"young\")])) +\n  scale_fill_manual(\"\", values = as.vector(cols_laid[c(\"mature\", \"old\", \"young\")]))\n\n\n\n\n\nMean annual cycle from monthlu means of leaf area index for Paracou and Tapajos with leaf cohorts of yound, mature and old leaves from PhenoCam of Wu et al. (2017) by X. Chen (pers. com.), and reanalaysed by X. Chen et al. (in prep). Rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\ndates &lt;- readxl::read_xlsx(\"~/Documents/data/Tapajos/nph15726-sup-0002-notess4.xlsx\", \n                  \"abs_height\", col_names = FALSE, skip = 0, n_max = 1) %&gt;% \n  select(-`...1`) %&gt;% \n  gather(key, date) %&gt;% \n  mutate(key = as.character(1:n()))\nreadxl::read_xlsx(\"~/Documents/data/Tapajos/nph15726-sup-0002-notess4.xlsx\", \n                  \"abs_height\", col_names = c(\"height\", dates$key), skip = 1) %&gt;% \n  mutate(canopy = ifelse(height &lt; 20, \"lower\", \"upper\")) %&gt;% \n  gather(key, lad, -height, -canopy) %&gt;% \n  left_join(dates) %&gt;% \n  mutate(date = as_date(date)) %&gt;%\n  group_by(date, canopy) %&gt;% \n  summarise(value = sum(lad)) %&gt;% \n  mutate(site = \"Tapajos\", variable = \"LAI\") %&gt;% \n  mutate(week = week(date), year = year(date)) %&gt;% \n  write_tsv(file = \"outputs/lai_tapajos_strat.tsv\")\nread_tsv(\"outputs/lai_tapajos_strat.tsv\") %&gt;% \n  ggplot(aes(week, value)) +\n    geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n            ymin = -Inf, ymax = Inf, alpha = 0.5,\n            data = data.frame(week = week(as_date(c(\"2000-06-15\"))),\n                              value = -Inf,\n                              end = week(as_date(c(\"2000-11-1\"))))) +\n  geom_line(aes(group = paste(year, canopy), col = canopy)) +\n  geom_smooth(aes(col = canopy), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-~2}~\"]\")) + xlab(\"\") +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) \n\n\n\n\n\nMean annual cycle from monthly means of leaf area index per strata at Tapajos. Rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\n\n\nBONAL, DAMIEN, ALEXANDRE BOSC, STÉPHANE PONTON, JEAN-YVES GORET, BENOÎT BURBAN, PATRICK GROSS, JEAN-MARC BONNEFOND, et al. 2008. “Impact of Severe Dry Season on Net Ecosystem Exchange in the Neotropical Rainforest of French Guiana.” Global Change Biology 14 (8): 1917–33. https://doi.org/10.1111/j.1365-2486.2008.01610.x.\n\n\nChen, Xingan, Yuefei Huang, Chong Nie, Shuo Zhang, Guangqian Wang, Shiliu Chen, and Zhichao Chen. 2022. “A Long-Term Reconstructed TROPOMI Solar-Induced Fluorescence Dataset Using Machine Learning Algorithms.” Scientific Data 9 (1). https://doi.org/10.1038/s41597-022-01520-1.\n\n\nPastorello, Gilberto, Trotta, Carlo, Canfora, Eleonora, Chu, Housen, Christianson, Danielle, Cheah, You-Wei, Poindexter, Cristina, et al. 2020. “The FLUXNET2015 Dataset and the ONEFlux Processing Pipeline for Eddy Covariance Data.” Nature Publishing Group. https://doi.org/10.5167/UZH-190509.\n\n\nSmith, Marielle N., Scott C. Stark, Tyeen C. Taylor, Mauricio L. Ferreira, Eronaldo de Oliveira, Natalia Restrepo-Coupe, Shuli Chen, et al. 2019. “Seasonal and Drought-Related Changes in Leaf Area Profiles Depend on Height and Light Environment in an Amazon Forest.” New Phytologist 222 (3): 1284–97. https://doi.org/10.1111/nph.15726.\n\n\nUkkola, Anna M., Gab Abramowitz, and Martin G. De Kauwe. 2022. “A Flux Tower Dataset Tailored for Land Model Evaluation.” Earth System Science Data 14 (2): 449–61. https://doi.org/10.5194/essd-14-449-2022.\n\n\nWu, Jin, Loren P. Albert, Aline P. Lopes, Natalia Restrepo-Coupe, Matthew Hayek, Kenia T. Wiedemann, Kaiyu Guan, et al. 2017. “Data from: Leaf Development and Demography Explain Photosynthetic Seasonality in Amazon Evergreen Forests.” Dryad. https://doi.org/10.5061/DRYAD.8FB47.\n\n\nYang, Xueqin, Xiuzhi Chen, Jiashun Ren, Wenping Yuan, Liyang Liu, Juxiu Liu, Dexiang Chen, et al. 2023. “A Grid Dataset of Leaf Age-Dependent LAI Seasonality Product (Lad-LAI) over Tropical and Subtropical Evergreen Broadleaved Forests.” http://dx.doi.org/10.5194/essd-2022-436."
  },
  {
    "objectID": "20_experiment.html",
    "href": "20_experiment.html",
    "title": "Experiment",
    "section": "",
    "text": "Virtual experiment for TROLL evaluation relies on several methods and tools developed in this part."
  },
  {
    "objectID": "21_methods.html#phenology-calibration",
    "href": "21_methods.html#phenology-calibration",
    "title": "Methods",
    "section": "Phenology calibration",
    "text": "Phenology calibration\nThe new leaf phenology modules lay on a shedding threshold potential:\n\\[\n\\Psi_{T,o}=min(a \\times \\Psi_{TLP}, -0.01\\times h-b)\n\\]\nwith \\(\\Psi_{T,o}\\) the leaf shedding potential in MPa, \\(\\Psi_{TLP}\\) the leaf water potential at turgor loss point in MPa, and \\(h\\) the tree height in metre. This equations thus introduces to new parameters which are \\(a\\) the leaf resistance parameter and \\(b\\) the tree height susceptibility parameter. Once the leaf shedding potential is reached tree losses their leaf quicker following \\(delta\\) the base variation in residence time multiplying factor for drought shedding. While this scheme is process-based uncertainty relied on the values of \\(a\\) , \\(b\\) and \\(delta\\) that we calibrated. We all the combinations of the following values:\n\na0: [0.01, 0.025, 0.05, 0.075, 0.1, 0.2, 0.3, 0.4, 0.5]\nb0: [0.05, 0.01, 0.015, 0.02, 0.04, 0.06, 0.08, 0.10, 0.12, 0.14, 0.16, 0.18, 0.20]\ndelta: [0.1, 0.2, 0.3, 0.4, 0.5]\n\nWe first ran a spin-up simulation from bareground during 600 years to establish a mature forest with \\(a=0.2\\), \\(b=0.02\\) and \\(delta=0.2\\). We then ran 10 years of simulation with each combinations of parameters that we burnt, to allow the forest and leaf dynamics to adjust to new parameters, and we kept a second run of 10 years for calibration. For each simulation and couples of parameters, we built simulated observation of litterfall based on the sampling date of the observed litterfall in Paracou and Tapajos (with corresponding varying time lapse). We further computed for each simulation the same two metrics built with observed litterfall:\n\nDay of the litterfall pike as the day of the maximum annual value\nThe litterfall rate is the ratio between the pike value (average of the annual maximum value and the previous and following values) divided by the base flow (average values between January and April)\n\nWe computed for each simulation the Root Mean Square Error of Prediction (RMSEP) of the euclidean distance between observed and simulated pikes and rates:\n\\[\nRMSEP = \\sqrt{| (ratio_o-ratio_s)^2+(pike_o-pike_s)^2 |}\n\\]\nWe finally selected the set of parameters for each site with the lowest RMSEP to be used in TROLL evaluation."
  },
  {
    "objectID": "21_methods.html#variations-approach",
    "href": "21_methods.html#variations-approach",
    "title": "Methods",
    "section": "Variations approach",
    "text": "Variations approach\nTo assess TROLL simulations variations due to stochasticity we ran ten repeats of 10-years simulations at Paracou and Tapajos with best parameters for a single spin-up of 600-years from bareground for each site. As we were mainly interested in daily fluxes that adjust to change in model parameters over a few years, we used only variations between 10 years to save ressources and computation time. But for a better evaluation of TROLL stochasticity for forest structure and composition we should used repeats of 600 years spin-up simulations from bareground."
  },
  {
    "objectID": "21_methods.html#evaluation-methods",
    "href": "21_methods.html#evaluation-methods",
    "title": "Methods",
    "section": "Evaluation methods",
    "text": "Evaluation methods\nWe run an extra 10-years simulations (run3) with best parameters after calibration for TROLL evaluation. We evaluated fluxes of carbon (growth primary productivity GPP), water (evapotranspiration ET and relative soil water content RSWC) and leaf (Leaf Area Index LAI), forest structure (basal area BA & abundance) and forest composition of species (rank abundance curves) and functional traits (quantiles). For fluxes, we investigated daily variations, 15-days variations, daily variations against known drivers, daily observed versus predicted, and computed several evaluation metrics (R squared of the linear regressions of null intercept R2, Pearson correlation coefficient CC, root mean square error of prediction RMSEP, standard deviation of the error of prediction SD and their relative counterparts RRMSEP and RSD). We evaluated fluxes when available against eddy-flux measures from towers, ground observations (litter traps and terrestrial lidar) or satellite observations."
  },
  {
    "objectID": "22_tools.html#rcontroll-version-4",
    "href": "22_tools.html#rcontroll-version-4",
    "title": "Tools",
    "section": "rcontroll version 4",
    "text": "rcontroll version 4\nA new version of rcontroll (Schmitt et al. 2023) has been developed for TROLL version 4 evaluation available on the corresponding branch on GitHub: https://github.com/sylvainschmitt/rcontroll/tree/TROLLV4 . This version mainly includes the inclusion of the new C++ code, the adaptation of inputs parameters and outputs in rcontroll objects and plots. The download of ERA5-Land data has also been updated. Every improvement since the version published on CRAN are described here: https://github.com/sylvainschmitt/rcontroll/blob/TROLLV4/NEWS.md (starting from rcontroll 0.2.0.9001)."
  },
  {
    "objectID": "22_tools.html#singularity-encapsulation",
    "href": "22_tools.html#singularity-encapsulation",
    "title": "Tools",
    "section": "singularity encapsulation",
    "text": "singularity encapsulation\nTo ease portability, reproducibility and integration into a workflow we encapsulated rcontroll with TROLL version 4 and other useful R packages for the analyses in a singularity image. The singularity recipe is available in singularity/Singularity with the R code in isingularity\\install.R. The code is copied from https://github.com/sylvainschmitt/singularity-troll. Once singularity installed (linux only but WSL can help windows users), you can install the image with the following command:\nsudo singularity build troll.sif Singularity\nThen the snakemake workflow will automatically use the corresponding image. In case you want to test it manually use the following command:\nsingularity shell -e troll.sif"
  },
  {
    "objectID": "22_tools.html#snakemake-workflow",
    "href": "22_tools.html#snakemake-workflow",
    "title": "Tools",
    "section": "snakemake workflow",
    "text": "snakemake workflow\nTo ease portability, reproducibility, and sustainability of the analyses, all virtual experiments have been included in a single snakemake workflow including thus calibration, variation, and evaluation defined in Snakefile. Once snakemake installed you can easily run the workflow locally. However the number of simulations is very high for calibration and spin-up simulations are very long so we recommend that you uses an high performance computing (HPC) platform. Most will include snakemake and singularity, and a submission script is already ready for cluster that uses slurm. In case you want to adjust virtual experiments definitions you can adjust the config/config_calib.yml file. To test the worklfow locally you can use a dry run:\nsnakemake -np -j 1\nOn the HPC you first need to activate the snakemake module, for instance:\nmodule load bioinfo/Snakemake/7.20.0\nThan used (and adapt) the predefined submission script:\nsbatch job.sh\n\n\n\n\nSchmitt, Sylvain, Guillaume Salzet, Fabian Jörg Fischer, Isabelle Maréchaux, and Jerome Chave. 2023. “Rcontroll: An R Interface for the Individual-Based Forest Dynamics Simulator TROLL.” Methods in Ecology and Evolution 14 (11): 2749–57. https://doi.org/10.1111/2041-210x.14215."
  },
  {
    "objectID": "30_calibration.html",
    "href": "30_calibration.html",
    "title": "Calibration",
    "section": "",
    "text": "This section develop the calibration of forest structure parameters (crown radius allometry and mortality) and the new phenology module (leaf shedding)."
  },
  {
    "objectID": "31_str3.html#crown-radius-parameters-variation",
    "href": "31_str3.html#crown-radius-parameters-variation",
    "title": "Structure v3",
    "section": "Crown radius parameters variation",
    "text": "Crown radius parameters variation\nWe gathered all Tallo measurements of crown radius and diameter in a radius of 10-km of Tapajos for trees above 10-cm. We randomly selected 10 trees per class diameter of decimetre a thousand times and computed crown radius intercepts and slopes. We obtained a parameter distribution with a correlation of 0.91, a linear regression of \\(b_{CR} = -0.39+0.57 \\times a_{CR}\\), and a standard variation of 0.08. Dashed lines shows Paracou values, which are lower than the observations.\n\n\nCode\ntapajos &lt;- tibble(\n  site = c(\"Tapajos\"),\n  latitude = c(-2.85667),\n  longitude = c(-54.9588900),\n) %&gt;% \n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) %&gt;% \n  st_buffer(10^4)\nparams &lt;- read_csv(\"data/species/tallo.csv\") %&gt;% \n  filter(longitude &lt;= -39, longitude &gt;= -79, latitude &gt;= -18, latitude &lt;= 10) %&gt;% \n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) %&gt;% \n  st_intersection(tapajos) %&gt;% \n  filter(!is.na(crown_radius_m), !is.na(stem_diameter_cm)) %&gt;% \n  mutate(dbh_m = stem_diameter_cm * 0.01) %&gt;% \n  filter(dbh_m &gt;= 0.1) %&gt;% \n  mutate(class_dbh_dm = floor(dbh_m * 10)) %&gt;% \n  mutate(rep = list(1:10^3)) %&gt;% \n  unnest(rep) %&gt;% \n  group_by(rep) %&gt;% \n  sample_n(10, replace = T) %&gt;% \n  unique() %&gt;%\n  st_drop_geometry() %&gt;% \n  ungroup() %&gt;% \n  nest_by(rep) %&gt;% \n  mutate(coefs = list(coef(lm(log(crown_radius_m) ~ log(dbh_m), data = data)))) %&gt;% \n  mutate(a = coefs[1], b = coefs[2]) %&gt;% \n  select(rep, a, b) %&gt;% \n  filter(a &gt; 0, b &gt; 0)\n\n\n\n\nCode\nggplot(params, aes(a, b)) +\n  geom_vline(xintercept = 2.13, linetype = \"dashed\", col = \"green\") +\n  geom_hline(yintercept = 0.63, linetype = \"dashed\", col = \"green\") +\n  geom_point() +\n  geom_density2d() +\n  theme_bw() +\n  xlab(expression(a[CR])) +\n  ylab(expression(b[CR])) +\n  ggpubr::stat_cor() +\n  geom_smooth(col = \"blue\", method = \"lm\")"
  },
  {
    "objectID": "31_str3.html#parameters-space",
    "href": "31_str3.html#parameters-space",
    "title": "Structure v3",
    "section": "Parameters space",
    "text": "Parameters space\nWe prepared the parameter space for calibration defining low limit, high limit, and step for a, m, and the error of b. b was computed using the linear equation plus the error. We used \\(3 \\sigma\\) for the error. We obtained a calibration grid of 11,193 simulations. Dashed lines shows Paracou values which are thus lower. The last figure shows the corresponding projected allometries of crown radius.\n\n\nCode\npars &lt;- data.frame(parameter = c(\"a\", \"error_b\", \"m\"),\n                   low = c(1.8, -4*0.08, 0.025),\n                   high = c(2.5, 4*0.08, 0.06),\n                   by = c(0.05, 0.05, 0.005))\ngrid &lt;- data.frame(a = seq(pars$low[1], pars$high[1], by = pars$by[1])) %&gt;% \n  mutate(error_b = list(seq(pars$low[2], pars$high[2], by = pars$by[2]))) %&gt;% \n  unnest(error_b) %&gt;% \n  mutate(b = -0.39 + 0.57*a + error_b) %&gt;% \n  mutate(m = list(seq(pars$low[3], pars$high[3], by = pars$by[3]))) %&gt;% \n  unnest(m)\n\n\n\n\nCode\nkable(pars)\n\n\n\n\n\nparameter\nlow\nhigh\nby\n\n\n\n\na\n1.800\n2.50\n0.050\n\n\nerror_b\n-0.320\n0.32\n0.050\n\n\nm\n0.025\n0.06\n0.005\n\n\n\n\n\n\n\nCode\ngrid %&gt;% \n  ggplot(aes(a, b)) +\n  geom_vline(xintercept = 2.13, linetype = \"dashed\") +\n  geom_hline(yintercept = 0.63, linetype = \"dashed\") +\n  geom_point(col = \"lightgrey\") +\n  geom_abline(intercept = -0.37, slope = 0.57, col = \"blue\") +\n  theme_bw() +\n  xlab(expression(a[CR])) +\n  ylab(expression(b[CR]))\n\n\n\n\n\n\n\nCode\ngrid %&gt;% \n  ggplot(aes(a, m)) +\n  geom_vline(xintercept = 2.13, linetype = \"dashed\") +\n  geom_hline(yintercept = 0.025, linetype = \"dashed\") +\n  geom_point(col = \"lightgrey\") +\n  theme_bw() +\n  xlab(expression(a[CR])) +\n  ylab(expression(m))\n\n\n\n\n\n\n\nCode\ngrid %&gt;% \n  mutate(dbh = list(seq(1, 150, 1)/100)) %&gt;% \n  unnest(dbh) %&gt;% \n  mutate(cr = exp(a+b*log(dbh))) %&gt;% \n  ggplot(aes(dbh, cr)) +\n  geom_line(aes(col = a, group = paste(a, b))) +\n  theme_bw() +\n  scale_colour_viridis_c(expression(a[CR])) +\n  xlab(\"Diameter (m)\") + ylab(\"Crown radius (m)\") +\n  geom_line(col = \"black\", linetype = \"dashed\",\n            data = data.frame(dbh = seq(1, 150, 1)/100) %&gt;% \n              mutate(cr = exp(2.13+0.63*log(dbh))))"
  },
  {
    "objectID": "31_str3.html#observations",
    "href": "31_str3.html#observations",
    "title": "Structure v3",
    "section": "Observations",
    "text": "Observations\nFor Tapajos and according to Rice et al. (2004) :\n\n470 live trees per hectare with diameter at breast height (dbh) ≥10\nAboveground live biomass was 143.7 ± 5.4 Mg C/ha\nStem density -0.058 (±0.003) dbh_cm + 2.912 (±0.076) for dbh &lt; 40\nStem density -0.016 (±0.001) dbh_cm + 1.451 (±0.04) for dbh &gt; 40\n\nFor Paracou:\n\n612 ± 37 live trees per hectare with diameter at breast height (dbh) ≥10 (from inventory)\nAboveground live biomass was 197.5-221.5 Mg C/ha in 2007 -&gt; 209.5 ± 17.0 Mg C/ha (Rutishauser et al. 2010)\nStem density is shown below\n\n\n\nCode\nabd_par &lt;- read_tsv(\"outputs/inventories.tsv\", show_col_types = FALSE) %&gt;% \n  filter(site == \"Paracou\", type == \"default\") %&gt;% \n  filter(dbh &gt; 10) %&gt;% \n  group_by(plot) %&gt;% \n  summarise(abundance = n()/unique(plot_size)) %&gt;% \n  ungroup()\n# paste(round(median(abd_par$abundance)), \"±\", round(sd(abd_par$abundance)))\nobs_tap &lt;- data.frame(dbh_class = seq(10, 150, 5)) %&gt;% \n  mutate(abundance = ifelse(dbh_class &lt; 40, \n                            10^(-0.058*dbh_class+2.912), \n                            10^(-0.016*dbh_class+1.451))) %&gt;% \n  mutate(site = \"Tapajos\")\n\nobs_par &lt;- read_tsv(\"outputs/inventories.tsv\", show_col_types = FALSE) %&gt;% \n  filter(site == \"Paracou\", type == \"default\") %&gt;% \n  filter(dbh &gt; 10) %&gt;% \n  mutate(dbh_class = cut(dbh, \n                         breaks = c(seq(10, 155, by = 5)), \n                         labels = c(seq(10, 150, by = 5)))) %&gt;% \n  mutate(dbh_class = as.numeric(as.character(dbh_class))) %&gt;% \n    group_by(plot, dbh_class) %&gt;% \n  summarise(abundance = n()/unique(plot_size)) %&gt;% \n  group_by(dbh_class) %&gt;% \n  summarise(abundance = median(abundance)) %&gt;% \n  mutate(site = \"Paracou\")\n# obs &lt;- bind_rows(obs_tap, obs_par)\nobs &lt;- bind_rows(obs_tap, obs_par)\nggplot(obs, (aes(dbh_class, abundance, col = site))) +\n  geom_line() +\n  theme_bw() +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  ggtitle(paste(\"Total:\", round(sum(obs$abundance))))"
  },
  {
    "objectID": "31_str3.html#parameters-effect",
    "href": "31_str3.html#parameters-effect",
    "title": "Structure v3",
    "section": "Parameters effect",
    "text": "Parameters effect\n\n\nCode\ncalib &lt;- read_tsv(\"results/calib_str3.tsv\") %&gt;% \n  mutate(dbh_class = cut(dbh_cm, \n                         breaks = seq(10, 205, by = 5), \n                         labels = seq(10, 200, by = 5),\n                         include.lowest = TRUE)) %&gt;% \n  mutate(dbh_class = as.numeric(as.character(dbh_class))) %&gt;% \n  group_by(site, a, b, m, dbh_class) %&gt;% \n  summarise(abundance = n()/4, agb = sum(agb)/4)\nwrite_tsv(calib, \"outputs/calib_structure.tsv\")\n\n\n\n\\(a_{CR}\\)\n\n\nCode\ndat &lt;-  read_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(agb = sum(agb)/10^3/2,\n            abundance = sum(abundance)) %&gt;% \n  filter(m == 0.025)\ncowplot::plot_grid(\n dat %&gt;% \n  ggplot(aes(a, b, col = agb)) +\n  geom_point() +\n  facet_wrap(~ site, scales = \"free_y\") +\n  theme_bw() +\n  scale_color_viridis_c(\"AGB\") +\n  xlab(expression(a[CR|m==0.025])) + ylab(expression(b[CR|m==0.025])),\n   dat %&gt;% \n  ggplot(aes(a, b, col = abundance)) +\n  geom_point() +\n  facet_wrap(~ site, scales = \"free_y\") +\n  theme_bw() +\n  scale_color_viridis_c(\"Abundance\") +\n  xlab(expression(a[CR|m==0.025])) + ylab(expression(b[CR|m==0.025])), \n nrow = 2)\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), \n            agb = sum(agb)/10^3/2) %&gt;% \n  ggplot(aes(abundance, agb, col = a)) +\n  geom_point() +\n  theme_bw() +\n  scale_color_viridis_c(expression(a[CR])) +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  filter(m == 0.025) %&gt;% \n  mutate(berr = -0.39 + 0.57*a - b) %&gt;% \n  filter(berr &gt; 0, berr &lt; 0.05) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(col = a, group = paste(a, b, m))) +\n  geom_point(data = filter(obs, dbh_class &lt; 150), col = \"red\") +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  scale_color_viridis_c(expression(a[CR|m==0.025|berr==0.02])) +\n  theme_bw() +\n  facet_wrap(~ site, nrow = 2)\n\n\n\n\n\n\n\n\\(b_{CR}\\)\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), \n            agb = sum(agb)/10^3/2) %&gt;% \n  ggplot(aes(abundance, agb, col = b)) +\n  geom_point() +\n  theme_bw() +\n  scale_color_viridis_c(expression(b[CR])) +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  filter(m == 0.025) %&gt;% \n  mutate(berr = -0.39 + 0.57*a - b) %&gt;% \n  filter(berr &gt; 0, berr &lt; 0.05) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(col = b, group = paste(a, b, m))) +\n  geom_point(data = filter(obs, dbh_class &lt; 150), col = \"red\") +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  scale_color_viridis_c(expression(b[CR])) +\n  scale_color_viridis_c(expression(b[CR|m==0.025|a==2])) +\n  theme_bw() +\n  facet_wrap(~ site, nrow = 2)\n\n\n\n\n\n\n\n\\(m\\)\n\n\nCode\ndat &lt;-  read_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(agb = sum(agb)/10^3/2,\n            abundance = sum(abundance)) %&gt;% \n  mutate(berr = -0.39 + 0.57*a - b) %&gt;% \n  filter(berr &gt; 0, berr &lt; 0.05)\ncowplot::plot_grid(\n dat %&gt;% \n  ggplot(aes(a, m, col = agb)) +\n  geom_point() +\n  facet_wrap(~ site, scales = \"free_y\") +\n  theme_bw() +\n  scale_color_viridis_c(\"AGB\") +\n  xlab(expression(a[CR|berr==0.02])) + ylab(expression(m[berr==0.02])),\n   dat %&gt;% \n  ggplot(aes(a, m, col = abundance)) +\n  geom_point() +\n  facet_wrap(~ site, scales = \"free_y\") +\n  theme_bw() +\n  scale_color_viridis_c(\"Abundance\") +\n  xlab(expression(a[CR|berr==0.02])) + ylab(expression(m[berr==0.02])),\n nrow = 2)\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), \n            agb = sum(agb)/10^3/2) %&gt;% \n  ggplot(aes(abundance, agb, col = m)) +\n  geom_point() +\n  theme_bw() +\n  scale_color_viridis_c(expression(m)) +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  filter(a == 2) %&gt;% \n  mutate(berr = -0.39 + 0.57*a - b) %&gt;% \n  filter(berr &gt; 0, berr &lt; 0.05) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(col = m, group = paste(a, b, m))) +\n  geom_point(data = filter(obs, dbh_class &lt; 150), col = \"red\") +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  scale_color_viridis_c(expression(m)) +\n  scale_color_viridis_c(expression(m[a==2|berr==0.02])) +\n  theme_bw() +\n  facet_wrap(~ site, nrow = 2)"
  },
  {
    "objectID": "31_str3.html#best-parameters",
    "href": "31_str3.html#best-parameters",
    "title": "Structure v3",
    "section": "Best parameters",
    "text": "Best parameters\n\n\nCode\neval &lt;- read_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  select(site, a, b, m) %&gt;% \n  unique() %&gt;% \n  mutate(dbh_class = list(seq(10, 150, by = 5))) %&gt;% \n  unnest(dbh_class) %&gt;% \n  left_join(read_tsv(\"outputs/calib_structure.tsv\")) %&gt;% \n  mutate_at(c(\"abundance\", \"agb\"), ~ifelse(is.na(.), 0, .)) %&gt;% \n  rename(simulated = abundance) %&gt;% \n  left_join(rename(obs, observed = abundance)) %&gt;% \n  mutate(observed = ifelse(is.na(observed), 0, observed)) %&gt;% \n  mutate(agb_obs = ifelse(site == \"Tapajos\", 143.7, 209.5)) %&gt;% \n  mutate(abund_obs = ifelse(site == \"Tapajos\", 470, 612)) %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(rmsep_dist = sqrt(mean((observed - simulated)^2)),\n            rmsep_agb = sqrt((unique(agb_obs) - sum(agb)/10^3/2)^2),\n            rmsep_abund = sqrt((unique(abund_obs) - sum(simulated))^2)\n            ) %&gt;% \n  ungroup() %&gt;% \n  mutate(dist_mean_obs = ifelse(site == \"Tapajos\", 16.2, 30.5)) %&gt;% \n  mutate(agb_obs = ifelse(site == \"Tapajos\", 143.7, 209.5)) %&gt;% \n  mutate(abund_obs = ifelse(site == \"Tapajos\", 470, 612)) %&gt;% \n  mutate(rrmsep_dist =  rmsep_dist/dist_mean_obs,\n         rrmsep_agb = rmsep_agb/agb_obs,\n         rrmsep_abund = rmsep_abund/abund_obs) %&gt;% \n  mutate(all_rmsep_norm = rrmsep_dist + rrmsep_agb + rrmsep_abund) %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m))\nbest &lt;- eval %&gt;% \n  group_by(site) %&gt;% \n  slice_min(all_rmsep_norm, n = 5)\n\n\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(best) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), agb = sum(agb)/10^3/2) %&gt;% \n  gather(variable, value, -site) %&gt;% \n  group_by(site, variable) %&gt;% \n  summarise(median = median(value), minimum = min(value), maximum = max(value)) %&gt;% \n  knitr::kable(caption = \"Best structure parameters according to calibration with inventory data.\")\n\n\n\nBest structure parameters according to calibration with inventory data.\n\n\nsite\nvariable\nmedian\nminimum\nmaximum\n\n\n\n\nParacou\na\n1.8500\n1.8000\n1.9000\n\n\nParacou\nabundance\n608.5000\n599.7500\n622.7500\n\n\nParacou\nagb\n210.6042\n204.8932\n216.6646\n\n\nParacou\nb\n0.4445\n0.4160\n0.4730\n\n\nParacou\nm\n0.0550\n0.0500\n0.0600\n\n\nTapajos\na\n2.5000\n2.4000\n2.5000\n\n\nTapajos\nabundance\n467.2500\n453.7500\n485.5000\n\n\nTapajos\nagb\n152.7362\n137.3486\n167.9250\n\n\nTapajos\nb\n0.8150\n0.7080\n0.8150\n\n\nTapajos\nm\n0.0550\n0.0400\n0.0600\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(best %&gt;% slice_min(all_rmsep_norm)) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(group = sim)) +\n  geom_point(data = obs, col = \"red\") +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  theme_bw() +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\nCode\ng &lt;- read_tsv(\"outputs/calib_structure.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(best %&gt;% slice_min(all_rmsep_norm)) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(group = sim, col = \"TROLL\")) +\n  geom_point(data = obs, aes(col = \"field\")) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  theme_bw() +\n  facet_wrap(~ site) +\n  scale_colour_manual(\"\", values = c(\"#3f3f3f\", \"#0da1f8\")) +\n  theme(legend.position = \"bottom\") +\n  geom_text(aes(col = \"field\", label = lab), \n            data = data.frame(dbh_class = 80, abundance = 200,\n                              lab = c(\"470 tress/ha & 143.7 MgC/ha\",\n                                      \"612 tress/ha & 209.5 MgC/ha\"),\n                              site = c(\"Tapajos\", \"Paracou\"))) +\n  geom_text(aes(col = \"TROLL\", label = lab), \n            data = data.frame(dbh_class = 80, abundance = 180,\n                              lab = c(\"467 tress/ha & 152.7 MgC/ha\",\n                                      \"608 tress/ha & 210.6 MgC/ha\"),\n                              site = c(\"Tapajos\", \"Paracou\")))\nggsave(\"figures/f01.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\n\n\n\n\nRice, Amy H., Elizabeth Hammond Pyle, Scott R. Saleska, Lucy Hutyra, Michael Palace, Michael Keller, Plínio B. de Camargo, Kleber Portilho, Dulcyana F. Marques, and Steven C. Wofsy. 2004. “CARBON BALANCE AND VEGETATION DYNAMICS IN AN OLD-GROWTH AMAZONIAN FOREST.” Ecological Applications 14 (sp4): 55–71. https://doi.org/10.1890/02-6006.\n\n\nRutishauser, Ervan, Fabien Wagner, Bruno Herault, Eric-André Nicolini, and Lilian Blanc. 2010. “Contrasting Above-Ground Biomass Balance in a Neotropical Rain Forest.” Journal of Vegetation Science, March. https://doi.org/10.1111/j.1654-1103.2010.01175.x."
  },
  {
    "objectID": "32_str4.html#parameters-spaces",
    "href": "32_str4.html#parameters-spaces",
    "title": "Structure v4",
    "section": "Parameters spaces",
    "text": "Parameters spaces\nWe prepared the parameter space for calibration defining low limit, high limit, and step for a, m, and the error of b for Paracou and Tapajos independently using calibration of forest crown radius allometry from TROLL 3.1.8 as prior and tests with TROLL 4.0.1 for the mortality prior. We obtained a calibration grid of 810 simulations. Dashed lines shows prior values. The last figure shows the corresponding projected allometries of crown radius.\n\n\nCode\npars_par &lt;- data.frame(site = \"Paracou\",\n                       parameter = c(\"a\", \"error_b\", \"m\"),\n                       low = c(1.6, -6*0.05, 0.03),\n                       high = c(2.0, -2*0.05, 0.05),\n                       by = c(0.05, 0.05, 0.0025))\npars_tap &lt;- data.frame(site = \"Tapajos\",\n                       parameter = c(\"a\", \"error_b\", \"m\"),\n                       low = c(2.3, -6*0.05, 0.03),\n                       high = c(2.7, -2*0.05, 0.05),\n                       by = c(0.05, 0.05, 0.0025))\npars &lt;- bind_rows(pars_par, pars_tap)\ngrid_par &lt;- data.frame(a = seq(pars_par$low[1], pars_par$high[1], by = pars_par$by[1])) %&gt;% \n  mutate(error_b = list(seq(pars_par$low[2], pars_par$high[2], by = pars_par$by[2]))) %&gt;% \n  unnest(error_b) %&gt;% \n  mutate(b = -0.39 + 0.57*a + error_b) %&gt;% \n  mutate(m = list(seq(pars_par$low[3], pars_par$high[3], by = pars_par$by[3]))) %&gt;% \n  unnest(m) %&gt;% \n  mutate(site = \"Paracou\")\ngrid_tap &lt;- data.frame(a = seq(pars_tap$low[1], pars_tap$high[1], by = pars_tap$by[1])) %&gt;% \n  mutate(error_b = list(seq(pars_tap$low[2], pars_tap$high[2], by = pars_tap$by[2]))) %&gt;% \n  unnest(error_b) %&gt;% \n  mutate(b = -0.39 + 0.57*a + error_b) %&gt;% \n  mutate(m = list(seq(pars_tap$low[3], pars_tap$high[3], by = pars_tap$by[3]))) %&gt;% \n  unnest(m) %&gt;% \n  mutate(site = \"Tapajos\")\ngrid &lt;- bind_rows(grid_par, grid_tap)\n\n\n\n\nCode\nkable(pars)\n\n\n\n\n\nsite\nparameter\nlow\nhigh\nby\n\n\n\n\nParacou\na\n1.60\n2.00\n0.0500\n\n\nParacou\nerror_b\n-0.30\n-0.10\n0.0500\n\n\nParacou\nm\n0.03\n0.05\n0.0025\n\n\nTapajos\na\n2.30\n2.70\n0.0500\n\n\nTapajos\nerror_b\n-0.30\n-0.10\n0.0500\n\n\nTapajos\nm\n0.03\n0.05\n0.0025\n\n\n\n\n\n\n\nCode\ngrid %&gt;% \n  ggplot(aes(a, b, col = site)) +\n  geom_point() +\n  geom_vline(aes(xintercept = a, col = site), linetype = \"dashed\", \n             data = data.frame(a = c(1.85, 2.50), site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_hline(aes(yintercept = b, col = site), linetype = \"dashed\", \n             data = data.frame(b = c(0.4445, 0.8150), site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_abline(intercept = -0.37, slope = 0.57, col = \"black\") +\n  theme_bw() +\n  xlab(expression(a[CR])) +\n  ylab(expression(b[CR]))\n\n\n\n\n\n\n\nCode\ngrid %&gt;% \n  ggplot(aes(a, m, col = site)) +\n  geom_point() +\n  geom_vline(aes(xintercept = a, col = site), linetype = \"dashed\", \n             data = data.frame(a = c(1.85, 2.50), site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_hline(yintercept = 0.040, linetype = \"dashed\") +\n  theme_bw() +\n  xlab(expression(a[CR])) +\n  ylab(expression(m))\n\n\n\n\n\n\n\nCode\ngrid %&gt;% \n  mutate(dbh = list(seq(1, 150, 1)/100)) %&gt;% \n  unnest(dbh) %&gt;% \n  mutate(cr = exp(a+b*log(dbh))) %&gt;% \n  ggplot(aes(dbh, cr)) +\n  geom_line(aes(col = a, group = paste(a, b))) +\n  theme_bw() +\n  scale_colour_viridis_c(expression(a[CR])) +\n  xlab(\"Diameter (m)\") + ylab(\"Crown radius (m)\") +\n  geom_line(col = \"black\", linetype = \"dashed\",\n            data = bind_rows(\n              data.frame(site = \"Paracou\", \n                         dbh = seq(1, 150, 1)/100) %&gt;% \n              mutate(cr = exp(1.85+0.4445*log(dbh))),\n              data.frame(site = \"Tapajos\", \n                         dbh = seq(1, 150, 1)/100) %&gt;% \n              mutate(cr = exp(2.50+0.8150*log(dbh)))\n            )\n              \n            ) +\n  facet_wrap(~ site)"
  },
  {
    "objectID": "32_str4.html#observations",
    "href": "32_str4.html#observations",
    "title": "Structure v4",
    "section": "Observations",
    "text": "Observations\nWe used different evaluation metrics per site to rely on a single data source and minimise discrepancies.\nFor Tapajos and according to Rice et al. (2004) :\n\n470 live trees per hectare with diameter at breast height (dbh) ≥10\nAboveground live biomass was 143.7 ± 5.4 Mg C/ha\nStem density -0.058 (±0.003) dbh_cm + 2.912 (±0.076) for dbh &lt; 40\nStem density -0.016 (±0.001) dbh_cm + 1.451 (±0.04) for dbh &gt; 40\nStem density is shown below\n\nFor Paracou according to the inventories:\n\n612 ± 37 live trees per hectare with diameter at breast height (dbh) ≥10 (from inventory)\nBasal area was 30.8 ± 0.836 m2/ha\nStem density is shown below\n\n\n\nCode\nabd_par &lt;- read_tsv(\"outputs/inventories.tsv\", show_col_types = FALSE) %&gt;% \n  filter(site == \"Paracou\", type == \"default\") %&gt;% \n  filter(dbh &gt; 10) %&gt;% \n  group_by(plot) %&gt;% \n  summarise(abundance = n()/unique(plot_size)) %&gt;% \n  ungroup()\n# paste(round(median(abd_par$abundance)), \"±\", round(sd(abd_par$abundance)))\n# read_tsv(\"outputs/inventories.tsv\") %&gt;% \n#   filter(site == \"Paracou\", type == \"default\", dbh &gt;= 10) %&gt;% \n#   group_by(plot) %&gt;% \n#   summarise(ba = sum((dbh/2)^2*pi)/10^4/unique(plot_size)) %&gt;% \n#   summarise(ba_mean = median(ba), ba_sd = sd(ba))\nobs_tap &lt;- data.frame(dbh_class = seq(10, 150, 5)) %&gt;% \n  mutate(abundance = ifelse(dbh_class &lt; 40, \n                            10^(-0.058*dbh_class+2.912), \n                            10^(-0.016*dbh_class+1.451))) %&gt;% \n  mutate(site = \"Tapajos\")\n\nobs_par &lt;- read_tsv(\"outputs/inventories.tsv\", show_col_types = FALSE) %&gt;% \n  filter(site == \"Paracou\", type == \"default\") %&gt;% \n  filter(dbh &gt; 10) %&gt;% \n  mutate(dbh_class = cut(dbh, \n                         breaks = c(seq(10, 155, by = 5)), \n                         labels = c(seq(10, 150, by = 5)))) %&gt;% \n  mutate(dbh_class = as.numeric(as.character(dbh_class))) %&gt;% \n    group_by(plot, dbh_class) %&gt;% \n  summarise(abundance = n()/unique(plot_size)) %&gt;% \n  group_by(dbh_class) %&gt;% \n  summarise(abundance = median(abundance)) %&gt;% \n  mutate(site = \"Paracou\")\n# obs &lt;- bind_rows(obs_tap, obs_par)\nobs &lt;- bind_rows(obs_tap, obs_par)\nggplot(obs, (aes(dbh_class, abundance, col = site))) +\n  geom_line() +\n  theme_bw() +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  ggtitle(paste(\"Total:\", round(sum(obs$abundance))))"
  },
  {
    "objectID": "32_str4.html#parameters-effect",
    "href": "32_str4.html#parameters-effect",
    "title": "Structure v4",
    "section": "Parameters effect",
    "text": "Parameters effect\n\n\nCode\nbind_rows(\n  read_tsv(\"results/calib_str4_Paracou.tsv\"),\n  read_tsv(\"results/calib_str4_Tapajos.tsv\")\n) %&gt;% \n  mutate(dbh_class = cut(dbh_cm, \n                         breaks = seq(10, 205, by = 5), \n                         labels = seq(10, 200, by = 5),\n                         include.lowest = TRUE)) %&gt;% \n  mutate(dbh_class = as.numeric(as.character(dbh_class))) %&gt;% \n  group_by(site, a, b, m, dbh_class) %&gt;% \n  summarise(abundance = n()/4, \n            agb = sum(agb)/4, \n            ba = sum((dbh_cm/2)^2*pi)/10^4/4) %&gt;% \n  write_tsv(\"outputs/calib_str4.tsv\")\n\n\n\n\\(a_{CR}\\)\n\n\nCode\ndat &lt;-  read_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(agb = sum(agb)/10^3/2,\n            ba = sum(ba),\n            abundance = sum(abundance)) %&gt;% \n  filter(m == 0.040)\ncowplot::plot_grid(\n dat %&gt;% \n  ggplot(aes(a, b, col = agb)) +\n  geom_point() +\n  facet_wrap(~ site, scales = \"free\") +\n  theme_bw() +\n  scale_color_viridis_c(\"AGB\") +\n  xlab(expression(a[CR|m==0.04])) + ylab(expression(b[CR|m==0.04])),\n  dat %&gt;% \n  ggplot(aes(a, b, col = ba)) +\n  geom_point() +\n  facet_wrap(~ site, scales = \"free\") +\n  theme_bw() +\n  scale_color_viridis_c(\"BA\") +\n  xlab(expression(a[CR|m==0.04])) + ylab(expression(b[CR|m==0.04])),\n   dat %&gt;% \n  ggplot(aes(a, b, col = abundance)) +\n  geom_point() +\n  facet_wrap(~ site, scales = \"free\") +\n  theme_bw() +\n  scale_color_viridis_c(\"Abundance\") +\n  xlab(expression(a[CR|m==0.04])) + ylab(expression(b[CR|m==0.04])), \n nrow = 3)\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), \n            agb = sum(agb)/10^3/2) %&gt;% \n  ggplot(aes(abundance, agb, col = a)) +\n  geom_point() +\n  theme_bw() +\n  scale_color_viridis_c(expression(a[CR])) +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  filter(m == 0.040) %&gt;% \n  mutate(berr = -0.39 + 0.57*a - b) %&gt;% \n  filter(berr &gt; 0.1, berr &lt; 0.3) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(col = a, group = paste(a, b, m))) +\n  geom_point(data = filter(obs, dbh_class &lt; 150), col = \"red\") +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  scale_color_viridis_c(expression(a[CR|m==0.04|berr==0.02])) +\n  theme_bw() +\n  facet_wrap(~ site, nrow = 2)\n\n\n\n\n\n\n\n\\(b_{CR}\\)\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), \n            agb = sum(agb)/10^3/2) %&gt;% \n  ggplot(aes(abundance, agb, col = b)) +\n  geom_point() +\n  theme_bw() +\n  scale_color_viridis_c(expression(b[CR])) +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\n\\(m\\)\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), \n            agb = sum(agb)/10^3/2) %&gt;% \n  ggplot(aes(abundance, agb, col = m)) +\n  geom_point() +\n  theme_bw() +\n  scale_color_viridis_c(expression(m)) +\n  facet_wrap(~ site)"
  },
  {
    "objectID": "32_str4.html#best-parameters",
    "href": "32_str4.html#best-parameters",
    "title": "Structure v4",
    "section": "Best parameters",
    "text": "Best parameters\n\nParacou\n\n\nCode\neval_par &lt;- read_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  filter(site == \"Paracou\") %&gt;% \n  select(site, a, b, m) %&gt;% \n  unique() %&gt;% \n  mutate(dbh_class = list(seq(10, 150, by = 5))) %&gt;% \n  unnest(dbh_class) %&gt;% \n  left_join(read_tsv(\"outputs/calib_str4.tsv\")) %&gt;% \n  select(-agb) %&gt;% \n  mutate_at(c(\"abundance\", \"ba\"), ~ifelse(is.na(.), 0, .)) %&gt;% \n  rename(simulated = abundance) %&gt;% \n  left_join(rename(obs, observed = abundance)) %&gt;% \n  mutate(observed = ifelse(is.na(observed), 0, observed)) %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(rmsep_dist = sqrt(mean((observed - simulated)^2)),\n            rmsep_ba = sqrt((30.8 - sum(ba))^2),\n            rmsep_abund = sqrt((612 - sum(simulated))^2)\n            ) %&gt;% \n  ungroup() %&gt;% \n  mutate(all_rmsep_norm = rmsep_dist/30.5 + rmsep_ba/30.8 + rmsep_abund/612) %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m))\nbest_par &lt;- eval_par %&gt;% \n  group_by(site) %&gt;% \n  slice_min(all_rmsep_norm, n = 5)\n\n\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(best_par) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), ba = sum(ba)) %&gt;% \n  gather(variable, value, -site) %&gt;% \n  group_by(site, variable) %&gt;% \n  summarise(median = median(value), minimum = min(value), maximum = max(value)) %&gt;% \n  knitr::kable(caption = \"Best structure parameters according to calibration with inventory data.\")\n\n\n\nBest structure parameters according to calibration with inventory data.\n\n\nsite\nvariable\nmedian\nminimum\nmaximum\n\n\n\n\nParacou\na\n1.8000\n1.80000\n1.90000\n\n\nParacou\nabundance\n606.2500\n587.50000\n628.00000\n\n\nParacou\nb\n0.3860\n0.38600\n0.44300\n\n\nParacou\nba\n30.0482\n29.46175\n32.09072\n\n\nParacou\nm\n0.0325\n0.03250\n0.03750\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(best_par %&gt;% slice_min(all_rmsep_norm)) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(group = sim)) +\n  geom_point(data = obs %&gt;% filter(site == \"Paracou\"), col = \"red\") +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  theme_bw() +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\nTapajos\n\n\nCode\neval_tap &lt;- read_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  filter(site == \"Tapajos\") %&gt;% \n  select(site, a, b, m) %&gt;% \n  unique() %&gt;% \n  mutate(dbh_class = list(seq(10, 150, by = 5))) %&gt;% \n  unnest(dbh_class) %&gt;% \n  left_join(read_tsv(\"outputs/calib_str4.tsv\")) %&gt;% \n  select(-ba) %&gt;% \n  mutate_at(c(\"abundance\", \"agb\"), ~ifelse(is.na(.), 0, .)) %&gt;% \n  rename(simulated = abundance) %&gt;% \n  left_join(rename(obs, observed = abundance)) %&gt;% \n  mutate(observed = ifelse(is.na(observed), 0, observed)) %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(rmsep_dist = sqrt(mean((observed - simulated)^2)),\n            rmsep_agb = sqrt((143.7 - sum(agb)/10^3/2)^2),\n            rmsep_abund = sqrt((470 - sum(simulated))^2)\n            ) %&gt;% \n  ungroup() %&gt;% \n  mutate(all_rmsep_norm = rmsep_dist/16.2 + rmsep_agb/143.7 + rmsep_abund/470) %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m))\nbest_tap &lt;- eval_tap %&gt;% \n  group_by(site) %&gt;% \n  slice_min(all_rmsep_norm, n = 5)\n\n\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(best_tap) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  group_by(site, a, b, m) %&gt;% \n  summarise(abundance = sum(abundance), agb = sum(agb)/10^3/2) %&gt;% \n  gather(variable, value, -site) %&gt;% \n  group_by(site, variable) %&gt;% \n  summarise(median = median(value), minimum = min(value), maximum = max(value)) %&gt;% \n  knitr::kable(caption = \"Best structure parameters according to calibration with inventory data.\")\n\n\n\nBest structure parameters according to calibration with inventory data.\n\n\nsite\nvariable\nmedian\nminimum\nmaximum\n\n\n\n\nTapajos\na\n2.4500\n2.3500\n2.5000\n\n\nTapajos\nabundance\n467.0000\n460.2500\n484.2500\n\n\nTapajos\nagb\n144.8843\n139.7424\n148.6621\n\n\nTapajos\nb\n0.7565\n0.6995\n0.7850\n\n\nTapajos\nm\n0.0400\n0.0300\n0.0500\n\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(best_tap %&gt;% slice_min(all_rmsep_norm)) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(group = sim)) +\n  geom_point(data = obs %&gt;% filter(site == \"Tapajos\"), col = \"red\") +\n  scale_y_log10(labels = scales::comma) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  theme_bw() +\n  facet_wrap(~ site)\n\n\n\n\n\n\n\nAll\n\n\nCode\nbind_rows(\n  best_par %&gt;% slice_min(all_rmsep_norm),\n  best_tap %&gt;% slice_min(all_rmsep_norm)\n) %&gt;% \n  select(site, a, b, m) %&gt;% \n  mutate(berr = b + 0.39 - 0.57*a) %&gt;% \n  kable()\n\n\n\n\n\nsite\na\nb\nm\nberr\n\n\n\n\nParacou\n1.80\n0.3860\n0.035\n-0.25\n\n\nTapajos\n2.45\n0.7565\n0.040\n-0.25\n\n\n\n\n\n\n\nCode\ng &lt;- read_tsv(\"outputs/calib_str4.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a, \"_\", b, \"_\", m)) %&gt;% \n  left_join(\n    bind_rows(\n      best_tap %&gt;% slice_min(all_rmsep_norm),\n      best_par %&gt;% slice_min(all_rmsep_norm)\n    )\n  ) %&gt;% \n  filter(!is.na(all_rmsep_norm)) %&gt;% \n  ggplot(aes(dbh_class, abundance)) +\n  geom_line(aes(group = sim, col = \"TROLL\")) +\n  geom_point(data = obs, aes(col = \"field\")) +\n  xlab(\"DBH [ cm ]\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  theme_bw() +\n  facet_wrap(~ site) +\n  scale_colour_manual(\"\", values = c(\"#3f3f3f\", \"#0da1f8\")) +\n  theme(legend.position = \"bottom\") +\n  geom_text(aes(col = \"field\", label = lab), \n            data = data.frame(dbh_class = 80, abundance = 200,\n                              lab = c(\"470 tress/ha & 143.7 MgC/ha\",\n                                      \"612 tress/ha & 30.8 m2/ha\"),\n                              site = c(\"Tapajos\", \"Paracou\"))) +\n  geom_text(aes(col = \"TROLL\", label = lab), \n            data = data.frame(dbh_class = 80, abundance = 180,\n                              lab = c(\"471 tress/ha & 144.9 MgC/ha\",\n                                      \"622 tress/ha & 30.5 m2/ha\"),\n                              site = c(\"Tapajos\", \"Paracou\")))\nggsave(\"figures/f01.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\n\n\n\n\nRice, Amy H., Elizabeth Hammond Pyle, Scott R. Saleska, Lucy Hutyra, Michael Palace, Michael Keller, Plínio B. de Camargo, Kleber Portilho, Dulcyana F. Marques, and Steven C. Wofsy. 2004. “CARBON BALANCE AND VEGETATION DYNAMICS IN AN OLD-GROWTH AMAZONIAN FOREST.” Ecological Applications 14 (sp4): 55–71. https://doi.org/10.1890/02-6006."
  },
  {
    "objectID": "33_phenology.html#parameters-effect",
    "href": "33_phenology.html#parameters-effect",
    "title": "Phenology",
    "section": "Parameters effect",
    "text": "Parameters effect\nThe leaf resistance parameter which is limiting the potential at turgor loss point (TLP, see methods) is manly limiting the height of litterfall peak in dry season with a peak up to 30 MgC/ha/yr with a at 0.01 against no peak with high values above 0.3. An higher leaf resistance above 0.1 also results in a latter peak. Globally, the less resistant are the leaves of the trees the higher is the litterfall in dry conditions.\n\n\nCode\nga1 &lt;- read_tsv(\"outputs/calib.tsv\") %&gt;% \n  filter(b0 == 0.02, delta == 0.2) %&gt;% \n  ggplot(aes(yday(date), simulated, col = a0, fill = a0)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(aes(group = as.factor(a0)), method = \"lm\", se = FALSE, \n              formula = y ~ poly(x, 20, raw = TRUE)) +\n  theme_bw() +\n  facet_wrap(~ site, scales = \"free\", nrow = 1) +\n  scale_color_viridis_c(\"Year\") +\n  xlab(\"\") + ylab(\"Simulated litterfall (MgC/ha/yr)\") +\n  scale_x_continuous(breaks = yday(as_date(paste0(\"2001-\", 1:12, \"-1\"))),\n                   labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  scale_color_viridis_c(\"a0 | b0 = 0.02, delta = 0.2\") +\n  scale_fill_viridis_c(\"a0 | b0 = 0.02, delta = 0.2\") +\n  theme(legend.position = \"bottom\")\nga1\n\n\n\n\n\nEffect of the leaf resistance parameter a on the annual cycle from fortnightly litterfall for Paracou and Tapajos.\n\n\n\n\n\n\nCode\nga2 &lt;- sim_metrics %&gt;% \n  filter(b0 == 0.02, delta == 0.2, type == \"simulated\") %&gt;% \n  ggplot(aes(peak_day, ratio, col = a0)) +\n  geom_point() +\n  theme_bw() +\n  facet_wrap(~ site) +\n  ylab(\"Simulated litterfall ratio\") +\n  xlab(\"Simulated litterfall peak day\") +\n  scale_color_viridis_c() +\n  scale_color_viridis_c(\"a0 | b0 = 0.02, delta = 0.2\") +\n  theme(legend.position = \"bottom\")\nga2\n\n\n\n\n\nEffect of the leaf resistance parameter a on the relation between Litterfall peak date and ratioi across years at Paracou and Tapajos.\n\n\n\n\nThe the tree height susceptibility parameter drives mainly the peak date but also the peak intensity for values above 0.1. Indeed low values close to 0.01 show a peak starting in September, whereas high values have a peak starting in December.\n\n\nCode\ngb1 &lt;- read_tsv(\"outputs/calib.tsv\") %&gt;% \n  filter(a0 == 0.2, delta == 0.2) %&gt;% \n  ggplot(aes(yday(date), simulated, col = b0, fill = b0)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(aes(group = as.factor(b0)), method = \"lm\", se = FALSE, \n              formula = y ~ poly(x, 20, raw = TRUE)) +\n  theme_bw() +\n  facet_wrap(~ site, scales = \"free\", nrow = 1) +\n  scale_color_viridis_c(\"Year\") +\n  xlab(\"\") + ylab(\"Simulated litterfall (MgC/ha/yr)\") +\n  scale_x_continuous(breaks = yday(as_date(paste0(\"2001-\", 1:12, \"-1\"))),\n                   labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  scale_color_viridis_c(\"b0 | a0 = 0.2, delta = 0.2\") +\n  scale_fill_viridis_c(\"b0 | a0 = 0.2, delta = 0.2\") +\n  theme(legend.position = \"bottom\")\ngb1\n\n\n\n\n\nEffect of the tree height susceptibility parameter b on the annual cycle from fortnightly litterfall for Paracou and Tapajos.\n\n\n\n\n\n\nCode\ngb2 &lt;- sim_metrics %&gt;% \n  filter(a0 == 0.2, delta == 0.2, type == \"simulated\") %&gt;% \n  ggplot(aes(peak_day, ratio, col = b0)) +\n  geom_point() +\n  theme_bw() +\n  facet_wrap(~ site) +\n  ylab(\"Simulated litterfall ratio\") +\n  xlab(\"Simulated litterfall peak day\") +\n  scale_color_viridis_c() +\n  scale_color_viridis_c(\"b0 | a0 = 0.2, delta = 0.2\") +\n  theme(legend.position = \"bottom\")\ngb2\n\n\n\n\n\nEffect of the tree height susceptibility parameter b on the relation between Litterfall peak date and ratioi across years at Paracou and Tapajos.\n\n\n\n\nThe base variation in residence time multiplying factor for drought shedding seems to have a lighter influence on litterfall peak intensity and date, at least for default values of the two other parameters.\n\n\nCode\ngd1 &lt;- read_tsv(\"outputs/calib.tsv\") %&gt;% \n  filter(b0 == 0.02, a0 == 0.2) %&gt;% \n  ggplot(aes(yday(date), simulated, col = delta, fill = delta)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(aes(group = as.factor(delta)), method = \"lm\", se = FALSE, \n              formula = y ~ poly(x, 20, raw = TRUE)) +\n  theme_bw() +\n  facet_wrap(~ site, scales = \"free\", nrow = 1) +\n  scale_color_viridis_c(\"Year\") +\n  xlab(\"\") + ylab(\"Simulated litterfall (MgC/ha/yr)\") +\n  scale_x_continuous(breaks = yday(as_date(paste0(\"2001-\", 1:12, \"-1\"))),\n                   labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  scale_color_viridis_c(\"delta | a0 = 0.2, b0 = 0.02\") +\n  scale_fill_viridis_c(\"delta | a0 = 0.2, b0 = 0.02\") +\n  theme(legend.position = \"bottom\")\ngd1\n\n\n\n\n\nEffect of the base variation in residence time multiplying factor for drought shedding delta on the annual cycle from fortnightly litterfall for Paracou and Tapajos.\n\n\n\n\n\n\nCode\ngd2 &lt;- sim_metrics %&gt;% \n  filter(b0 == 0.02, a0 == 0.2, type == \"simulated\") %&gt;% \n  ggplot(aes(peak_day, ratio, col = delta)) +\n  geom_point() +\n  theme_bw() +\n  facet_wrap(~ site) +\n  ylab(\"Simulated litterfall ratio\") +\n  xlab(\"Simulated litterfall peak day\") +\n  scale_color_viridis_c() +\n  scale_color_viridis_c(\"delta | a0 = 0.2, b0 = 0.02\") +\n  theme(legend.position = \"bottom\")\ngd2\n\n\n\n\n\nEffect of the base variation in residence time multiplying factor for drought shedding delta on the relation between Litterfall peak date and ratioi across years at Paracou and Tapajos.\n\n\n\n\n\n\nCode\ng &lt;- cowplot::plot_grid(ga1 + \n                          ggtitle(\"a0 | b0 = 0.02, delta = 0.2\") +\n                          theme(legend.position = \"none\"), \n                        gb1+ \n                          ggtitle(\"b0 | a0 = 0.2, delta = 0.2\") +\n                          theme(legend.position = \"none\"), \n                        gd1+ \n                          ggtitle(\"delta | a0 = 0.2, b0 = 0.02\") +\n                          theme(legend.position = \"none\"), \n                        ga2 +\n                          scale_color_viridis_c(\"\"),\n                        gb2 +\n                          scale_color_viridis_c(\"\"), \n                        gd2 +\n                          scale_color_viridis_c(\"\"),\n                        nrow = 2)\nggsave(\"figures/fs02.png\", g, dpi = 300, width = 16, height = 8, bg = \"white\")"
  },
  {
    "objectID": "33_phenology.html#best-parameters",
    "href": "33_phenology.html#best-parameters",
    "title": "Phenology",
    "section": "Best parameters",
    "text": "Best parameters\nWe found similar \\(a=0.2\\) and \\(b=0.015\\) to be the best in Paracou and Tapajos, but slightly different \\(delta\\) with \\(delta=0.1\\) in Paracou and \\(delta=0.2\\) in Tapajos. Except for delta in Tapajos all values are outside the limit of parameters explorations. The resulting litterfall dynamics of the simulations follows the intrannual pattern of observed litterfall with an early dry season peak (~September Paracou, ~August Tapajos) of around 7 times the basal flux observed in the wet season. However, the model still have issues to simulated the intensity of the basal flux, especially in Tapajos.\n\n\nCode\nbest &lt;- sim_metrics %&gt;% \n  ungroup() %&gt;% \n  mutate(ratio = as.vector(scale(ratio)), \n         peak_day = as.vector(scale(peak_day))) %&gt;% \n  gather(metric, value, -site, -a0, -b0, -delta, -year, -type) %&gt;% \n  filter(metric %in% c(\"ratio\", \"peak_day\")) %&gt;% \n  mutate(metric = paste0(metric, \"_\", type)) %&gt;% \n  select(-type) %&gt;% \n  pivot_wider(names_from = metric, values_from = value) %&gt;% \n  na.omit() %&gt;% \n  mutate(error = sqrt((ratio_observed - ratio_simulated)^2\n                      +(peak_day_observed - peak_day_simulated)^2)) %&gt;% \n  group_by(site, a0, b0, delta) %&gt;% \n  summarise(RMSEP = sqrt(mean(error^2, na.rm = T))) %&gt;% # should be normed\n  group_by(site) %&gt;% \n  slice_min(RMSEP) %&gt;% \n  mutate(sim = paste0(site, \"_\", a0, \"_\", b0, \"_\", delta))\nbest %&gt;% \n  knitr::kable(caption = \"Best phenology parameters values according to calibration with litterfall data.\")\n\n\n\nBest phenology parameters values according to calibration with litterfall data.\n\n\nsite\na0\nb0\ndelta\nRMSEP\nsim\n\n\n\n\nParacou\n0.2\n0.015\n0.1\n1.0616194\nParacou_0.2_0.015_0.1\n\n\nTapajos\n0.2\n0.015\n0.2\n0.3327142\nTapajos_0.2_0.015_0.2\n\n\n\n\n\n\n\nCode\ng &lt;- vroom::vroom(\"outputs/calib.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a0, \"_\", b0, \"_\", delta)) %&gt;% \n  filter(sim %in% best$sim) %&gt;%\n  select(-sim, -a0, -b0, -delta, -dt) %&gt;% \n  gather(type, value, -site, -date) %&gt;%  \n  mutate(day = yday(date)) %&gt;% \n  ggplot(aes(day, value)) +\n  geom_rect(aes(xmin = day, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(day = yday(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             value = -Inf,\n                             end = yday(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_smooth(aes(col = type),\n              method = \"lm\", formula = y ~ poly(x, 20, raw = TRUE), alpha = 0.5, se = FALSE) +\n  geom_line(aes(col = type, group = paste0(year(date), type)), alpha = 0.6) +\n  geom_point(aes(col = type), alpha = 0.7) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  facet_wrap(~ site, nrow = 2) +\n  xlab(\"\") + \n  scale_x_continuous(breaks = yday(as_date(paste0(\"2001-\", 1:12, \"-1\"))),\n                   labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Litter traps\", \"TROLL\")) +\n  ylab(expression(Litterfall~\"[\"~MgC~ha^{-~1}~yr^{-~1}~\"]\")) \nggsave(\"figures/f06.png\", g, dpi = 300, width = 5, height = 5, bg = \"white\")\ng\n\n\n\n\n\nAnnual cycle from fortnightly litterfall for Paracou and Tapajos. Each thin line represents one year, the thick lines mean polynomial smoothing among years, the point field sampling dates, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\nvroom::vroom(\"outputs/calib.tsv\") %&gt;% \n  mutate(sim = paste0(site, \"_\", a0, \"_\", b0, \"_\", delta)) %&gt;% \n  filter(sim %in% best$sim) %&gt;%\n  select(-sim, -a0, -b0, -delta, -dt) %&gt;% \n  gather(type, value, -site, -date) %&gt;% \n  ggplot(aes(date, value, col = type)) +\n  geom_line(alpha = 0.5) +\n  facet_wrap(~ site, scales = \"free_x\") +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_color_discrete(\"\", labels = c(\"field\", \"TROLL\")) +\n  xlab(\"\") + \n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Litter traps\", \"TROLL\")) +\n  ylab(expression(Litterfall~\"[\"~MgC~ha^{-1}~yr^{-1}~\"]\")) \n\n\n\n\n\nFortnightly litterfall for Paracou and Tapajos simulated in TROLL and measured with litter traps."
  },
  {
    "objectID": "40_evaluation.html",
    "href": "40_evaluation.html",
    "title": "Evaluation",
    "section": "",
    "text": "This section develop the evaluation of simulation variations, forest structure and composition, and carbon, water and leaf fluxes."
  },
  {
    "objectID": "41_variation.html",
    "href": "41_variation.html",
    "title": "Variation",
    "section": "",
    "text": "TROLL simulations showed very little variations due to stochasticity in fluxes (however this is 10-years variations starting from a single spin-up). The highest variation is in Leaf Area Index (LAI, m2/m2), partly due to higher possible stochasticity in leaf shedding, but remains negligible. Oppositely, Growth Primary Productivity (GPP, kgC/m2/yr), evapotranspiration (ET, mm/day) and Soil Water Content (SWC, m3/m3) showed almost no-variations across simulations of monthly mean values.\n\n\nCode\nfiles &lt;- list.files(\"results/eval/\", pattern = \"sumstats.txt\", \n                    recursive = T, full.names = T) \nnames(files) &lt;- list.files(\"results/eval/\", pattern = \"sumstats.txt\", \n                    recursive = T, full.names = F) \nperiod &lt;- \"month\"\nfiles %&gt;% \n  lapply(vroom::vroom) %&gt;% \n  bind_rows(.id = \"file\") %&gt;% \n  separate(file, \"sim\", \"/\") %&gt;% \n  separate(sim, c(\"site\", \"repetition\")) %&gt;%\n  mutate(repetition = as.numeric(gsub(\"R\", \"\", repetition))) %&gt;% \n  mutate(gpp = gpp*10^2*365/10^3) %&gt;% \n  select(site, repetition, iter, gpp) %&gt;% \n  mutate(date = as_date(ifelse(site == \"Paracou\", \n                       \"2004/01/01\", \n                       \"2002/01/01\"))) %&gt;% \n  mutate(date = date + iter) %&gt;% \n  group_by(site, repetition, date = floor_date(date, period)) %&gt;% \n  summarise(gpp = mean(gpp)) %&gt;% \n  group_by(site, date = floor_date(date, period)) %&gt;% \n  summarise(l = min(gpp), \n            m = median(gpp), \n            h = max(gpp)) %&gt;% \n  ggplot(aes(date, m)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line(col = \"grey\") +\n  geom_errorbar(aes(ymin = l, ymax = h)) +\n  facet_wrap(~ site, nrow = 2, scales = \"free\") +\n  theme_bw() +\n  xlab(\"\") +\n  ylab(expression(\"Growth Primary Productivity [\"~kgC~m^{-2}~yr^{-1}~\"]\")) \n\n\n\n\n\nVariability of monthly means of growth primary productivity for Paracou and Tapajos across 10 TROLL simulations.\n\n\n\n\n\n\nCode\nfiles &lt;- list.files(\"results/eval/\", pattern = \"LAIdynamics.txt\", \n                    recursive = T, full.names = T) \nnames(files) &lt;- list.files(\"results/eval/\", pattern = \"LAIdynamics.txt\", \n                    recursive = T, full.names = F) \nperiod &lt;- \"month\"\nfiles %&gt;% \n  lapply(vroom::vroom) %&gt;% \n  bind_rows(.id = \"file\") %&gt;% \n  separate(file, \"sim\", \"/\") %&gt;% \n  separate(sim, c(\"site\", \"repetition\")) %&gt;%\n  mutate(repetition = as.numeric(gsub(\"R\", \"\", repetition))) %&gt;% \n  mutate(date = as_date(ifelse(site == \"Paracou\", \n                       \"2004/01/01\", \n                       \"2002/01/01\"))) %&gt;% \n  mutate(date = date + iter) %&gt;% \n  group_by(site, repetition, date = floor_date(date, period)) %&gt;% \n  summarise(LAI = mean(LAI)) %&gt;% \n  group_by(site, date = floor_date(date, period)) %&gt;% \n  summarise(l = min(LAI), \n            m = median(LAI), \n            h = max(LAI)) %&gt;% \n  ggplot(aes(date, m)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line(col = \"grey\") +\n  geom_errorbar(aes(ymin = l, ymax = h)) +\n  facet_wrap(~ site, nrow = 2, scales = \"free\") +\n  theme_bw() +\n  xlab(\"\") + \n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-2}~\"]\")) \n\n\n\n\n\nVariability of monthly means of leaf area index for Paracou and Tapajos across 10 TROLL simulations.\n\n\n\n\n\n\nCode\nfiles &lt;- list.files(\"results/eval/\", pattern = \"water_balance.txt\", \n                    recursive = T, full.names = T) \nnames(files) &lt;- list.files(\"results/eval/\", pattern = \"water_balance.txt\", \n                    recursive = T, full.names = F) \nperiod &lt;- \"month\"\nfiles %&gt;% \n  lapply(vroom::vroom) %&gt;% \n  bind_rows(.id = \"file\") %&gt;% \n  separate(file, \"sim\", \"/\") %&gt;% \n  separate(sim, c(\"site\", \"repetition\")) %&gt;%\n  mutate(repetition = as.numeric(gsub(\"R\", \"\", repetition))) %&gt;% \n  mutate(date = as_date(ifelse(site == \"Paracou\", \n                       \"2004/01/01\", \n                       \"2002/01/01\"))) %&gt;% \n  mutate(date = date + iter) %&gt;% \n  mutate(et = (transpitation_0 + transpitation_1 + transpitation_2 + \n                 transpitation_3 + transpitation_4 + evaporation)*1000) %&gt;% \n  group_by(site, repetition, date = floor_date(date, period)) %&gt;% \n  summarise(et = mean(et)) %&gt;% \n  group_by(site, date = floor_date(date, period)) %&gt;% \n  summarise(l = min(et), \n            m = median(et), \n            h = max(et)) %&gt;% \n  ggplot(aes(date, m)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line(col = \"grey\") +\n  geom_errorbar(aes(ymin = l, ymax = h)) +\n  facet_wrap(~ site, nrow = 2, scales = \"free\") +\n  theme_bw() +\n  xlab(\"\") + \n  ylab(expression(\"Evapotranspiration [\"~mm~day^{-1}~\"]\")) \n\n\n\n\n\nVariability of monthly means of evapotranspiration for Paracou and Tapajos across 10 TROLL simulations.\n\n\n\n\n\n\nCode\nfiles &lt;- list.files(\"results/eval/\", pattern = \"water_balance.txt\", \n                    recursive = T, full.names = T) \nnames(files) &lt;- list.files(\"results/eval/\", pattern = \"water_balance.txt\", \n                    recursive = T, full.names = F) \nperiod &lt;- \"month\"\nfiles %&gt;% \n  lapply(vroom::vroom) %&gt;% \n  bind_rows(.id = \"file\") %&gt;% \n  separate(file, \"sim\", \"/\") %&gt;% \n  separate(sim, c(\"site\", \"repetition\")) %&gt;%\n  mutate(repetition = as.numeric(gsub(\"R\", \"\", repetition))) %&gt;% \n  mutate(date = as_date(ifelse(site == \"Paracou\", \n                       \"2004/01/01\", \n                       \"2002/01/01\"))) %&gt;% \n  mutate(date = date + iter) %&gt;% \n  group_by(site, repetition, date = floor_date(date, period)) %&gt;% \n  summarise(SWC_0 = mean(SWC_0)) %&gt;% \n  group_by(site, date = floor_date(date, period)) %&gt;% \n  summarise(l = min(SWC_0), \n            m = median(SWC_0), \n            h = max(SWC_0)) %&gt;% \n  ggplot(aes(date, m)) +\n  geom_ribbon(aes(ymin = l, ymax = h), col = NA, alpha = 0.2) +\n  geom_line(col = \"grey\") +\n  geom_errorbar(aes(ymin = l, ymax = h)) +\n  facet_wrap(~ site, nrow = 2, scales = \"free\") +\n  theme_bw() +\n  xlab(\"\") + \n  ylab(expression(\"Soil Water Content [\"~m^{3}~m^{-3}~\"]\")) \n\n\n\n\n\nVariability of monthly means of soil water content for Paracou and Tapajos across 10 TROLL simulations."
  },
  {
    "objectID": "42_forest.html#structure",
    "href": "42_forest.html#structure",
    "title": "Forest",
    "section": "Structure",
    "text": "Structure\nThe main development of TROLL version 4 is the inclusion of a new explicit modelling of daily water and carbon fluxes as well as a new leaf phenology. We thus focused TROLL version 4 evaluation on fluxes, as forest structure and composition was extensively assessed in Maréchaux and Chave (2017) . However here, we quickly investigate back forest structure and composition in Paracou and Tapajos.\n\n\nCode\nfiles &lt;- list.files(\"results/eval/\", pattern = \"final_pattern.txt\", \n                    recursive = T, full.names = T) \nnames(files) &lt;- list.files(\"results/eval/\", pattern = \"final_pattern.txt\", \n                    recursive = T, full.names = F) \ntroll_forest &lt;- files %&gt;% \n  lapply(vroom::vroom) %&gt;% \n  bind_rows(.id = \"file\") %&gt;% \n  separate(file, \"sim\", \"/\") %&gt;% \n  separate(sim, c(\"site\", \"repetition\")) %&gt;%\n  mutate(repetition = as.numeric(gsub(\"R\", \"\", repetition))) %&gt;% \n  mutate(species = gsub(\"_\", \" \", s_name)) %&gt;% \n  mutate(dbh = dbh*100)\nwrite_tsv(troll_forest, \"outputs/evaluation_forest.tsv\")\n\nfiles &lt;- list.files(\"results/eval/\", pattern = \"CHM.txt\", \n                    recursive = T, full.names = T) \nnames(files) &lt;- list.files(\"results/eval/\", pattern = \"CHM.txt\", \n                    recursive = T, full.names = F) \ntroll_height &lt;- files %&gt;% \n  lapply(vroom::vroom) %&gt;% \n  bind_rows(.id = \"file\") %&gt;% \n  separate(file, \"sim\", \"/\") %&gt;% \n  separate(sim, c(\"site\", \"repetition\")) %&gt;%\n  mutate(repetition = as.numeric(gsub(\"R\", \"\", repetition))) %&gt;% \n  group_by(site, repetition, height) %&gt;% \n  summarise(n = n()) %&gt;% \n  mutate(pct = n/sum(n)*100)\nwrite_tsv(troll_height, \"outputs/evaluation_height.tsv\")\n\n\n\nForest\nWe characterized global forests structure through their distribution of basal area (m2/ha) and logged abundance per 10-cm classes of diameter at breast height (DBH, cm) for trees above 10 cm DBH. We found simulated back the same distributions in Paracou with a small lack of smaller diameters and slight increase in trees with a diameter around 100 cm. But beware of stochasticity that may have resulted in a few big trees surviving in the 16-ha simulations. We found back in Paracou a total basal area of 29 m2/ha against a mean observed of 30 across plots and a total number of 576 individuals simulated per hectare against a mean observed of 655 across plots. In Tapajos, we found very similar distribution but with increased small diameters in simulation and a lack of big trees (above 100cm). We thus overestimated basal area (30 m2/ha against 24 observed) and abundance (598 against 632 observed). However, Tapajos data are based on only 8 very small plots of 0.25ha, which may have resulted in an over-representation of a few big individuals. The resulting quantiles comparisons are very good with a correlation coefficient above 0.93 for all metrics and sites except Tapajos were basal area correlation coefficient was only 0.72.\n\n\nCode\nstructure &lt;- read_tsv(\"outputs/evaluation_forest.tsv\") %&gt;% \n  filter(dbh &gt;= 10) %&gt;% \n  mutate(plot = repetition) %&gt;% \n  select(site, plot, dbh) %&gt;% \n  mutate(dbh_class = cut(dbh, breaks = seq(10, 200, by = 10), \n                         labels = seq(10, 190, by = 10)+5)) %&gt;% \n  mutate(dbh_class = as.numeric(as.character(dbh_class))) %&gt;% \n  group_by(site, plot, dbh_class) %&gt;% \n  summarise(abundance = n()/4,\n            ba = sum((dbh/2)^2*pi)/10^4/4) %&gt;% \n  mutate(log_abundance = log10(abundance)) %&gt;% \n  gather(variable, simulated, -site, -dbh_class, -plot) %&gt;% \n  full_join(read_tsv(\"outputs/structure.tsv\") %&gt;% \n              filter(type != \"understory\") %&gt;% \n              select(-type)) %&gt;% \n  gather(type, value, -site, -dbh_class, -variable, -plot) %&gt;% \n  group_by(site, dbh_class, variable, type) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = quantile(value, 0.5, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  na.omit() %&gt;% \n  mutate(varlong = recode(variable, \"ba\" = 'Basal~area~\"[\"~m^{2}~ha^{-~1}~\"]\"',\n                          \"log_abundance\" = 'Log[10]~abundance~\"[\"~ha^{-~1}~\"]\"'))\n# read_tsv(\"outputs/structure.tsv\") %&gt;% \n#               filter(type != \"understory\") %&gt;% \n#               select(-type) %&gt;% \n#   group_by(site, variable, plot) %&gt;% \n#   summarise(observed = sum(observed)) %&gt;% \n#   summarise(l = quantile(observed, 0.025, na.rm = TRUE), \n#             m = quantile(observed, 0.5, na.rm = TRUE), \n#             h = quantile(observed, 0.975, na.rm = TRUE))\n\n\n\n\nCode\nlabs &lt;- structure %&gt;% \n  filter(variable %in% c(\"ba\", \"log_abundance\")) %&gt;% \n  mutate(m = ifelse(variable == \"log_abundance\", 10^m, m)) %&gt;% \n  group_by(variable, varlong, type, site) %&gt;% \n  summarise(total = sum(m)) %&gt;% \n  group_by(variable, site) %&gt;% \n  pivot_wider(names_from = type, values_from = total) %&gt;% \n  mutate(label = paste0(\"Field: \", round(observed), \"\\nTROLL: \", round(simulated))) %&gt;% \n  mutate(dbh_class = 120) %&gt;% \n  mutate(m = ifelse(variable == \"log_abundance\", 1.5, 5)) \nfilter(structure, variable %in% c(\"ba\", \"log_abundance\")) %&gt;% \n  ggplot(aes(dbh_class, m)) +\n  geom_linerange(aes(ymin = l, ymax = h, col = type)) +\n  geom_point(aes(col = type)) +\n  geom_line(aes(col = type)) +\n  theme_bw() +\n  facet_grid(varlong ~ site, scales = \"free_y\", labeller = label_parsed) +\n  xlab(\"DBH [ cm ]\") + ylab(\"\") +\n  scale_color_discrete(\"\") +\n  theme(legend.position = \"bottom\") +\n  geom_text(data = labs, aes(label = label)) +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Field\", \"TROLL\"))\n\n\n\n\n\nEvaluation of the size structure estimated by TROLL at the Paracou and Tapajos sites, expressed in terms of abundance and basal area. Confidence intervals on inventory analysis at 95 % are shown with error bars and are based on among plots variations. The confidence on the TROLL values was estimated generating an ensemble of 10 simulations (see methods).\n\n\n\n\n\n\nCode\nfilter(structure, variable %in% c(\"ba\", \"abundance\")) %&gt;% \n  select(site, dbh_class, variable, m, type) %&gt;% \n   pivot_wider(names_from = type, values_from = m) %&gt;% \n  ungroup() %&gt;% \n  mutate(observed = ifelse(is.na(observed), 0, observed)) %&gt;% \n  mutate(simulated = ifelse(is.na(simulated), 0, simulated)) %&gt;% \n  nest_by(site, variable) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation of abundance and basal area distribution at Paracou and Tapajos.\")\n\n\n\nEvaluation of abundance and basal area distribution at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\n\nsite\nvariable\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\nabundance\n0.9994123\n0.9996769\n6.4824615\n0.1170350\n6.5438869\n0.1181440\n\n\nParacou\nba\n0.9787581\n0.9763346\n0.5420094\n0.1924009\n0.5623797\n0.1996319\n\n\nTapajos\nabundance\n0.9951098\n0.9976641\n28.5149463\n1.0240174\n28.1388214\n1.0105102\n\n\nTapajos\nba\n0.8589237\n0.8150433\n0.8600405\n0.4608885\n0.8908545\n0.4774015\n\n\n\n\n\n\n\nUnderstory\nTaking advantage of new inventories of understory in Paracou, we assessed TROLL version 4 ability to simulate understory. We found TROLL to understimate the number of small trees with DBH close to 1cm and overestimate bigger trees with DBH closer to 10. We ewpected this behaviour as TROLL only simulates one tree per square meter. Nonetheless we found back a basal area of 4 m2/ha despite an underestimation of 2,310 individuals per hectare against 3,787, observed.\n\n\nCode\nunderstory &lt;- read_tsv(\"outputs/evaluation_forest.tsv\") %&gt;% \n  filter(dbh &lt;= 10) %&gt;% \n  mutate(plot = repetition) %&gt;% \n  select(site, plot, dbh) %&gt;% \n  mutate(dbh_class = cut(dbh, breaks = seq(1, 10, by = 1), \n                         labels = seq(1, 9, by = 1)+0.5)) %&gt;% \n  mutate(dbh_class = as.numeric(as.character(dbh_class))) %&gt;% \n  group_by(site, plot, dbh_class) %&gt;% \n  summarise(abundance = n()/4,\n            ba = sum((dbh/2)^2*pi)/10^4/4) %&gt;% \n  mutate(log_abundance = log10(abundance)) %&gt;% \n  gather(variable, simulated, -site, -dbh_class, -plot) %&gt;% \n  full_join(read_tsv(\"outputs/structure.tsv\") %&gt;% \n            filter(type == \"understory\") %&gt;% \n              select(-type)) %&gt;% \n  gather(type, value, -site, -dbh_class, -variable, -plot) %&gt;% \n  group_by(site, dbh_class, variable, type) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = quantile(value, 0.5, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  na.omit() %&gt;% \n  mutate(varlong = recode(variable, \"ba\" = 'Basal~area~\"[\"~m^{2}~ha^{-~1}~\"]\"',\n                          \"log_abundance\" = 'Log[10]~abundance~\"[\"~ha^{-~1}~\"]\"'))\n\n\n\n\nCode\nlabs &lt;- understory %&gt;% \n  filter(site == \"Paracou\") %&gt;% \n  filter(variable %in% c(\"ba\", \"log_abundance\")) %&gt;% \n  mutate(m = ifelse(variable == \"log_abundance\", 10^m, m)) %&gt;% \n  group_by(variable, varlong, type, site) %&gt;% \n  summarise(total = sum(m)) %&gt;% \n  group_by(variable, site) %&gt;% \n  pivot_wider(names_from = type, values_from = total) %&gt;% \n  mutate(label = paste0(\"Field: \", round(observed,1), \"\\nTROLL: \", round(simulated,1))) %&gt;% \n  mutate(dbh_class = 5) %&gt;% \n  mutate(m = ifelse(variable == \"log_abundance\", 3, 0.5)) \ng &lt;- filter(understory, variable %in% c(\"ba\", \"log_abundance\")) %&gt;% \n  filter(site == \"Paracou\") %&gt;% \n  ggplot(aes(dbh_class, m)) +\n  geom_linerange(aes(ymin = l, ymax = h, col = type)) +\n  geom_point(aes(col = type)) +\n  geom_line(aes(col = type)) +\n  theme_bw() +\n  facet_wrap(site ~ varlong, scales = \"free_y\", labeller = label_parsed) +\n  xlab(\"DBH [ cm ]\") + ylab(\"\") +\n  scale_color_discrete(\"\") +\n  theme(legend.position = \"bottom\") +\n  geom_text(data = labs, aes(label = label)) +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Field\", \"TROLL\"))\nggsave(\"figures/f03.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nEvaluation of the size structure estimated by TROLL at the Paracou site with understorey trees, expressed in terms of abundance and basal area. Confidence intervals on inventory analysis at 95 % are shown with error bars and are based on among plots variations. The confidence on the TROLL values was estimated generating an ensemble of 10 simulations (see methods).\n\n\n\n\n\n\nCode\nfilter(understory, variable %in% c(\"ba\", \"abundance\")) %&gt;% \n  select(site, dbh_class, variable, m, type) %&gt;% \n   pivot_wider(names_from = type, values_from = m) %&gt;% \n  ungroup() %&gt;% \n  mutate(observed = ifelse(is.na(observed), 0, observed)) %&gt;% \n  mutate(simulated = ifelse(is.na(simulated), 0, simulated)) %&gt;% \n  nest_by(site, variable) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  na.omit() %&gt;% \n  knitr::kable(caption = \"Evaluation of abundance and basal area distribution at Paracou for the understory.\")\n\n\n\nEvaluation of abundance and basal area distribution at Paracou for the understory.\n\n\n\n\n\n\n\n\n\n\n\n\nsite\nvariable\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\nabundance\n0.9874279\n0.9986586\n342.1410299\n0.8131157\n309.8182228\n0.7362989\n\n\nParacou\nba\n0.9390029\n0.9092767\n0.1194674\n0.2901696\n0.0804761\n0.1954653\n\n\n\n\n\n\n\nHeight\n\n\nCode\ng &lt;- read_tsv(\"outputs/evaluation_height.tsv\") %&gt;% \n  group_by(site, height) %&gt;% \n  summarise(l = quantile(pct, 0.025, na.rm = TRUE), \n            m = quantile(pct, 0.5, na.rm = TRUE), \n            h = quantile(pct, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(type = \"TROLL\") %&gt;% \n  bind_rows(\n    read_tsv(\"outputs/hieght_chm.tsv\") %&gt;% \n      rename(m = pct)\n  ) %&gt;% \n  filter(height &gt; 5) %&gt;% \n  ggplot(aes(height, m, col = type)) +\n  geom_ribbon(aes(ymin = l, ymax = h, fill = type), col = NA, alpha = 0.2) +\n  geom_line() +\n  facet_wrap(~ site) +\n  theme_bw() +\n  coord_flip() +\n  ylab(\"[ % ]\") + xlab(\"Height [ m ]\") +\n  scale_color_manual(\"\", values =  as.vector(cols[c(\"obs\", \"sat\", \"sim\")])) +\n  scale_fill_manual(\"\", values =  as.vector(cols[c(\"obs\", \"sat\", \"sim\")])) +\n  theme(legend.position = \"bottom\")\nggsave(\"figures/f02.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nEvaluation of the height structure estimated by TROLL at the Paracou and Tapajos sites. Confidence intervals on inventory analysis at 95% are shown with shaded areas. The confidence on the TROLL values was estimated generating an ensemble of 10 simulations (see methods).\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/evaluation_height.tsv\") %&gt;% \n  group_by(site, height) %&gt;% \n  summarise(l = quantile(pct, 0.025, na.rm = TRUE), \n            m = quantile(pct, 0.5, na.rm = TRUE), \n            h = quantile(pct, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(type = \"TROLL\") %&gt;% \n  bind_rows(\n    read_tsv(\"outputs/hieght_chm.tsv\") %&gt;% \n      rename(m = pct)\n  ) %&gt;% \n  filter(height &gt; 5) %&gt;% \n  select(site, height, m, type) %&gt;% \n  pivot_wider(names_from = type, values_from = m) %&gt;% \n  rename(simulated = TROLL) %&gt;% \n  gather(type, observed, -site, -height, -simulated) %&gt;% \n  mutate(observed = ifelse(is.na(observed), 0, observed)) %&gt;% \n  mutate(simulated = ifelse(is.na(simulated), 0, simulated)) %&gt;% \n  ungroup() %&gt;% \n  nest_by(site, type) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation of height distribution at Paracou and Tapajos.\")\n\n\n\nEvaluation of height distribution at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\n\nsite\ntype\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\nALS\n0.9265437\n0.9469564\n0.7586231\n0.4387551\n0.7641590\n0.4419569\n\n\nParacou\nGEDI\n0.9498053\n0.9572165\n0.5505392\n0.3296207\n0.5456149\n0.3266724\n\n\nTapajos\nALS\n0.9421566\n0.9365866\n0.5601293\n0.3320753\n0.5647863\n0.3348362\n\n\nTapajos\nGEDI\n0.9165519\n0.9123720\n0.6911677\n0.4984149\n0.6199769\n0.4470778"
  },
  {
    "objectID": "42_forest.html#composition",
    "href": "42_forest.html#composition",
    "title": "Forest",
    "section": "Composition",
    "text": "Composition\n\nSpecies\nObserved species rank-abundance curves in Paracou and Tapajos revealed low evenness with a few dominating species even more intense in Tapajos. However, Tapajos data are based on only 8 very small plots of 0.25ha, which may not be representative despite their virtual pooling in two 1-ha plots, and the quality of the species identifications can be lower. Simulated rank-abundance curve in Paracou was similar to the observed one with a correlation coefficient of 0.95 but with higher evenness resulting in underestimation of dominant species abundances and overestimation of rare species abundances. Simulated rank-abundance curve in Tapajos was very similar to the one simulated in Paracou but differed a lot of the one in Tapajos with strong underestimation of dominant species abundances and overestimation of rare species abundances. But once again observation data in Tapajos might be question for species resolution.\n\n\nCode\ncompositon &lt;- read_tsv(\"outputs/evaluation_forest.tsv\") %&gt;% \n  filter(dbh &gt;= 10) %&gt;% \n  mutate(plot = repetition) %&gt;% \n  mutate(species = gsub(\"_\", \" \", s_name)) %&gt;% \n  select(site, plot, species) %&gt;% \n  group_by(site, plot, species) %&gt;% \n  summarise(simulated = n()/4) %&gt;% \n  mutate(variable = \"abundance\") %&gt;% \n  select(site, plot, species, variable, simulated) %&gt;% \n  full_join(read_tsv(\"outputs/composition.tsv\")) %&gt;% \n  gather(type, value, -site, -plot, -variable, -species) %&gt;% \n  group_by(site, plot, variable, type) %&gt;% \n  arrange(desc(value)) %&gt;% \n  mutate(rank = 1:n()) %&gt;% \n  group_by(site, rank, type, variable) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = quantile(value, 0.5, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  filter(rank &lt; 115)\n\n\n\n\nCode\ng &lt;- compositon %&gt;% \n  ggplot(aes(rank, m, col = type)) +\n  geom_line(aes(y = l), linewidth = 0.5, linetype = \"dashed\") +\n  geom_line(aes(y = h), linewidth = 0.5, linetype = \"dashed\") +\n  geom_line() +\n  theme_bw() +\n  facet_wrap(~ site) +\n  xlab(\"Rank\") + ylab(expression(Abundance~\"[\"~ha^{-~1}~\"]\")) +\n  scale_color_discrete(\"\") +\n  theme(legend.position = \"bottom\") +\n  scale_y_log10()  +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Field\", \"TROLL\"))\nggsave(\"figures/f04.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nEvaluation of the species composition estimated by TROLL at the Paracou and Tapajos sites expressed in terms of species rank-abundance curve. Confidence intervals on inventory analysis at 95 % are shown with error bars and are based on among plots variations. The confidence on the TROLL values was estimated generating an ensemble of 10 simulations (see methods).\n\n\n\n\n\n\nCode\ncompositon %&gt;% \n  select(site, rank, m, type) %&gt;% \n   pivot_wider(names_from = type, values_from = m) %&gt;% \n  ungroup() %&gt;% \n  na.omit() %&gt;% \n  nest_by(site) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation of rank-abundance distribution at Paracou and Tapajos.\")\n\n\n\nEvaluation of rank-abundance distribution at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\nsite\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\n0.8460766\n0.9317166\n3.672332\n0.7379424\n3.580988\n0.7195870\n\n\nTapajos\n0.7400282\n0.9395882\n3.627773\n1.0121687\n3.475726\n0.9697468\n\n\n\n\n\n\n\nFunctional\nSimulated functional trait distribution in Paracou and Tapajos matched the ones observed with quantiles correlations above 0.9 for all traits and sites, at th exception of leaf area in Paracou. However due to a poor species resolution in Tapajos we used mean genus values, which may result in an overestimation of assessment in Tapajos. Leaf area differences in Paracou come to the lack of very high leaf area species in the simulations compared to the Paracou plots, however the resulting correlation coefficient might have differed if we would have used log-transformed leaf area). Diving into the observed data, the high leaf area values are due to pioneer species including Cecropia obtusa and sciadophylla, Sterculia speciosa and Perebea guianensis. The three genus are present in the simulations inputs, but seems to lack in the final forest due to either a lack of forest gaps or a lack of survival.\n\n\nCode\ntroll_traits &lt;- list(\n    read_tsv(\"outputs/Paracou_species_troll.tsv\"),\n    read_tsv(\"outputs/Tapajos_species_troll.tsv\")\n) %&gt;% bind_rows() %&gt;% \n  unique() %&gt;% \n  rename_all(~ gsub(\"s_\", \"\", .)) %&gt;% \n  select(-seedmass, -regionalfreq) %&gt;% \n  rename(species = name) %&gt;% \n  mutate(species = gsub(\"_\", \" \", species)) %&gt;% \n  gather(trait, trait_value, -species)\ntroll_traitdist &lt;- read_tsv(\"outputs/evaluation_forest.tsv\") %&gt;% \n  filter(dbh &gt;= 10) %&gt;% \n  mutate(plot = repetition) %&gt;% \n  select(site, plot, species) %&gt;% \n  left_join(troll_traits)\nall_traits_q &lt;- bind_rows(\n  mutate(troll_traitdist, type = \"sim\"),\n  mutate(read_tsv(\"outputs/functional_composition.tsv\"), type = \"obs\") %&gt;% \n    mutate(trait = ifelse(trait == \"leafaera\", \"leafarea\", trait))\n) %&gt;% \n  group_by(site, trait, plot, type) %&gt;% \n  summarise(quantile = list(quantile(trait_value, seq(0, 1, length.out = 100)))) %&gt;% \n  unnest_longer(quantile) %&gt;% \n  group_by(site, trait, type, quantile_id)%&gt;% \n  summarise(l = quantile(quantile, 0.025, na.rm = TRUE), \n            m = quantile(quantile, 0.5, na.rm = TRUE), \n            h = quantile(quantile, 0.975, na.rm = TRUE)) %&gt;% \n  gather(quantile, value, -site, -trait, -type, -quantile_id) %&gt;% \n  mutate(quantile = paste0(quantile, \"_\", type)) %&gt;% \n  ungroup() %&gt;% \n  select(-type) %&gt;% \n  pivot_wider(names_from = quantile, values_from = value)\n\n\n\n\nCode\nread_tsv(\"outputs/functional_composition.tsv\") %&gt;% \n   mutate(trait = ifelse(trait == \"leafaera\", \"leafarea\", trait)) %&gt;% \n  filter(site == \"Paracou\") %&gt;% \n  ggplot(aes(trait_value, group = plot)) +\n  geom_density(aes(col = \"Observed\")) +\n  geom_density(aes(col = \"Simulated\"),\n               data = filter(troll_traitdist, site == \"Paracou\")) +\n  facet_wrap(~ trait, scales = \"free\") +\n  theme_bw() +\n  ggtitle(\"Paracou\", \"546,498 inds represented on 577,761 (94.59%)\") +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  scale_color_discrete(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Field\", \"TROLL\"))\n\n\n\n\n\nEvaluation of the functional composition estimated by TROLL at the Paracou site expressed in terms of density distribution per trait and site. The analyses have been done at the species level in Paracou.\n\n\n\n\n\n\nCode\nread_tsv(\"outputs/functional_composition.tsv\") %&gt;% \n   mutate(trait = ifelse(trait == \"leafaera\", \"leafarea\", trait)) %&gt;% \n  filter(site == \"Tapajos\") %&gt;% \n  ggplot(aes(trait_value, group = plot)) +\n  geom_density(aes(col = \"Observed\")) +\n  geom_density(aes(col = \"Simulated\"),\n               data = filter(troll_traitdist, site == \"Tapajos\")) +\n  facet_wrap(~ trait, scales = \"free\") +\n  theme_bw() +\n  ggtitle(\"Tapajos Genus level\", \"19,188 inds represented on 19,499 (98.65%)\") +\n  theme(axis.title = element_blank(), legend.position = \"bottom\") +\n  scale_color_discrete(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Field\", \"TROLL\"))\n\n\n\n\n\nEvaluation of the functional composition estimated by TROLL at the Tapajos site expressed in terms of density distribution per trait and site. The analyses have been done at the genus level in Tapajos.\n\n\n\n\n\n\nCode\ng &lt;- read_tsv(\"outputs/functional_composition.tsv\") %&gt;%\n mutate(trait = ifelse(trait == \"leafaera\", \"leafarea\", trait)) %&gt;% \n  mutate(trait_long = recode(trait, \"ah\" = \"a[h]\", \"dbhmax\" = \"dbh[max]\", \"hmax\" = \"h[lim]\",\n                             \"leafarea\" = \"LA\", \"Nmass\" = \"N[mass]\", \"Pmass\" = \"P[mass]\",\n                             \"tlp\" = \"psi[tlp]\", \"wsg\" = \"WSG\")) %&gt;% \n  filter(!(trait %in% c(\"ah\", \"hmax\"))) %&gt;% \n  mutate(varlong = paste0('\"', site, ':\"~', trait_long)) %&gt;% \n  ggplot(aes(trait_value, group = plot)) +\n  geom_density(aes(col = \"Observed\")) +\n  geom_density(aes(col = \"Simulated\"), \n               data = troll_traitdist %&gt;% \n                   mutate(trait_long = recode(trait, \"ah\" = \"a[h]\", \"dbhmax\" = \"dbh[max]\",\n                                              \"hmax\" = \"h[lim]\",\n                             \"leafarea\" = \"LA\", \"Nmass\" = \"N[mass]\", \"Pmass\" = \"P[mass]\",\n                             \"tlp\" = \"psi[tlp]\", \"wsg\" = \"WSG\")) %&gt;% \n                 filter(!(trait %in% c(\"ah\", \"hmax\"))) %&gt;% \n  mutate(varlong = paste0('\"', site, ':\"~', trait_long))) +\n  facet_wrap(~ varlong, scales = \"free\", labeller = label_parsed, nrow = 2) +\n  theme_bw() +\n  theme(axis.title = element_blank(), legend.position = \"bottom\",\n        axis.ticks.y = element_blank(), axis.text.y = element_blank(),\n        panel.spacing = unit(0,'lines'), axis.text.x = element_text(angle = 90)) +\n  scale_color_discrete(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Field\", \"TROLL\"))\nggsave(\"figures/f05.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nEvaluation of the functional composition estimated by TROLL at the Paracou and Tapajos sites expressed in terms of density distribution per trait and site. The analyses have been done at the species level in Paracou and the genus level in Tapajos.\n\n\n\n\n\n\nCode\nall_traits_q %&gt;% \n  rename(simulated = m_sim, observed = m_obs) %&gt;% \n  select(site, trait, quantile_id, observed, simulated) %&gt;% \n  nest_by(site, trait) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation of functional trait distribution for 100 quantiles at Paracou and Tapajos.\")\n\n\n\nEvaluation of functional trait distribution for 100 quantiles at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\n\nsite\ntrait\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\nLMA\n0.9886444\n0.9142285\n21.1088650\n0.2099764\n10.6113608\n0.1055545\n\n\nParacou\nNmass\n0.9961246\n0.9723521\n0.0014427\n0.0656081\n0.0014140\n0.0643039\n\n\nParacou\nPmass\n0.9911597\n0.9758053\n0.0001491\n0.2021203\n0.0000782\n0.1060771\n\n\nParacou\nah\n0.9987316\n0.9754937\n0.0109144\n0.0369420\n0.0108263\n0.0366436\n\n\nParacou\ndbhmax\n0.9926502\n0.9827946\n0.0552051\n0.1098648\n0.0516380\n0.1027658\n\n\nParacou\nhmax\n0.9998644\n0.9853367\n0.6295734\n0.0129370\n0.5793113\n0.0119041\n\n\nParacou\nleafarea\n0.7413358\n0.7451218\n84.1215132\n0.9244892\n77.0278242\n0.8465301\n\n\nParacou\ntlp\n0.9994758\n0.9848427\n0.0977138\n-0.0529251\n0.0449855\n-0.0243656\n\n\nParacou\nwsg\n0.9970608\n0.9646730\n0.0439447\n0.0709658\n0.0370580\n0.0598445\n\n\nTapajos\nLMA\n0.9853282\n0.9625564\n16.5355251\n0.1833123\n7.8067965\n0.0865459\n\n\nTapajos\nNmass\n0.9945671\n0.9834351\n0.0032073\n0.1473824\n0.0022693\n0.1042770\n\n\nTapajos\nPmass\n0.9669355\n0.9398453\n0.0003122\n0.4000822\n0.0002439\n0.3125424\n\n\nTapajos\nah\n0.9953434\n0.9617961\n0.0200917\n0.0684823\n0.0201036\n0.0685229\n\n\nTapajos\ndbhmax\n0.9924031\n0.9879605\n0.0493157\n0.1007963\n0.0489489\n0.1000465\n\n\nTapajos\nhmax\n0.9935198\n0.9208839\n3.8905893\n0.0817971\n3.7432559\n0.0786995\n\n\nTapajos\nleafarea\n0.8819081\n0.8720779\n46.6577223\n0.5578830\n40.8018350\n0.4878646\n\n\nTapajos\ntlp\n0.9974960\n0.9740506\n0.1000472\n-0.0520436\n0.0931555\n-0.0484586\n\n\nTapajos\nwsg\n0.9954405\n0.9639906\n0.0464366\n0.0730569\n0.0458058\n0.0720645\n\n\n\n\n\n\n\n\n\nMaréchaux, Isabelle, and Jérôme Chave. 2017. “An Individual-Based Forest Model to Jointly Simulate Carbon and Tree Diversity in Amazonia: Description and Applications.” Ecological Monographs 87 (4): 632–64. https://doi.org/10.1002/ecm.1271."
  },
  {
    "objectID": "43_fluxes.html#growth-primary-productivity",
    "href": "43_fluxes.html#growth-primary-productivity",
    "title": "Fluxes",
    "section": "Growth Primary Productivity",
    "text": "Growth Primary Productivity\nThe new version of TROLL correctly simulated the phenology of Growth Primary Productivity (GPP, kgC/m2/yr) with a lower GPP in wet season and higher values in the dry season. However, TROLL version 4 is globally overestimating GPP with daily values overlapping wet season values but significantly higher values in dry season with a pike around 5 instead of 4 kgC/m2/yr. Remotely-sensed observation from TROPOMI Solar Induced Fluorescence showed under-estimated values of GPP between 2.5 and 3.5 kgC/m2/yr monthly means but with a similar phenology. The new version of TROLL seems to be too deterministic in the relation between available light (incoming PAR mol/m2/day) and GPP with a correlation coefficient of 0.94 against an observed coefficient of 0.58. The overestimation of GPP seems to be linked to over-efficient GPP for high light availability (PAR above 5 mol/m2/day). Globally, simulated GPP showed a very good evaluation with a correlation coefficient of 0.59 in Paracou and 0.46 in Tapajos against daily observations from eddy-flux towers, and corresponding RMSEP of respectively 0.9 and 1.6 kgC/m2/yr.\n\n\nCode\ndaily &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(variable == \"gpp\") %&gt;% \n  left_join(read_tsv(\"outputs/fluxnet_fluxes.tsv\") %&gt;% \n              mutate(observed = value*10^2*365/10^3) %&gt;% \n              select(-value)) %&gt;% \n  left_join(read_tsv(\"outputs/fluxnet_fluxes.tsv\") %&gt;% \n              filter(variable %in% c(\"par\", \"vpd_max\", \"temperature\", \"ws\")) %&gt;% \n              rename(determinant = variable, determinant_value = value)) %&gt;% \n  left_join(read_tsv(\"data/fluxes/rtsif.tsv\") %&gt;% \n              mutate(satellite = rtsif*15.343*365/10^3) %&gt;% \n              select(-rtsif)) %&gt;% \n  gather(type, value, -site, -date, -variable, -determinant, -determinant_value)\nmonthly &lt;- daily %&gt;% \n  group_by(site, date = floor_date(date, \"month\"), variable, type) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            value = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE))\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  ggplot(aes(date, value, col = type)) +\n  geom_line(alpha = 0.5) +\n  geom_line(data = monthly) +\n  facet_wrap(~ site, nrow = 2) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  xlab(\"\") +\n  ylab(expression(\"Growth Primary Productivity [\"~kgC~m^{-2}~yr^{-1}~\"]\")) +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sat\", \"sim\")]), \n                     labels = c(\"Tower\", \"Satellite\", \"TROLL\"))\nggsave(\"figures/fs04.png\", g, dpi = 300, width = 10, height = 5, bg = \"white\")\ng\n\n\n\n\n\nDaily and monthly means of growth primary productivity for Paracou and Tapajos. Dark lines are the monthly means, semi-transparent lines are the daily means variations with the exception of satellite data for which data are available only every 8 days.\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  group_by(site, variable, type, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(date)) %&gt;%  \n  group_by(site, variable, type, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_ribbon(aes(ymin = l, ymax = h, fill = type), col = NA, alpha = 0.2) +\n  geom_smooth(aes(col = type), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ site, scales = \"free_x\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  ylab(expression(\"Growth Primary Productivity [\"~kgC~m^{-~2}~yr^{-~1}~\"]\")) +\n  xlab(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sat\", \"sim\")]), \n                     labels = c(\"Tower\", \"Satellite\", \"TROLL\")) +\n  scale_fill_manual(\"\", values = as.vector(cols[c(\"obs\", \"sat\", \"sim\")]), \n                     labels = c(\"Tower\", \"Satellite\", \"TROLL\"))\nggsave(\"figures/f09.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nMean annual cycle from fortnightly means of growth primary productivity for Paracou and Tapajos. Bands are the intervals of means across years, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  mutate(determinant_value = ifelse(determinant == \"par\", \n                                    determinant_value/10^2, determinant_value)) %&gt;% \n  mutate(det_long = recode(determinant, \n                           \"par\" = 'Incoming~PAR~\"[\"~mol~m^{-~2}~day^{-~1}~\"]\"',\n                           \"temperature\" = 'Temperature~\"[\"~degree~C~\"]\"',\n                            \"vpd_max\" = '\"Vapour Pressure Deficit [\"~kPa~day^{-~1}~\"]\"',\n                           \"ws\" = 'Wind~Speed~\"[\"~m^{2}~s^{-~1}~\"]\"')) %&gt;% \n  ggplot(aes(determinant_value, value, col = type)) +\n  geom_point(alpha = 0.1) +\n  theme_bw() +\n  facet_grid(site ~ det_long, scales = \"free\", labeller = label_parsed) +\n  theme(legend.position = \"bottom\") +\n  geom_smooth(method = \"lm\", formula = \"y ~ 1+log(x+10^-6)\", se = FALSE) +\n  ylab(expression(\"Growth Primary Productivity [\"~kgC~m^{-~2}~yr^{-~1}~\"]\")) +\n  xlab(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sat\", \"sim\")]), \n                     labels = c(\"Tower\", \"Satellite\", \"TROLL\")) +\n  scale_fill_manual(\"\", values = as.vector(cols[c(\"obs\", \"sat\", \"sim\")]), \n                     labels = c(\"Tower\", \"Satellite\", \"TROLL\")) +\n  ylim(0, 7.5) +\n  ggpubr::stat_cor(aes(label = ..rr.label..))\nggsave(\"figures/f11.png\", g, dpi = 300, width = 10, height = 6, bg = \"white\")\ng\n\n\n\n\n\nDaily averages of growth primary productivity as a function of vapour pressure deficit, incoming photosynthetically active radiation, temperature, and wind speed for model-, satellite- and tower-based estimates at Paracou and Tapajos.\n\n\n\n\n\n\nCode\ndaily %&gt;% \n  pivot_wider(names_from = type, values_from = value) %&gt;% \n  gather(type, observed, -site, -date, -variable, -determinant, -determinant_value, -simulated) %&gt;% \n  ggplot(aes(simulated,observed, col = yday(date))) +\n  facet_grid(site ~ type) +\n  theme_bw() +\n  geom_point() +\n  scale_color_viridis_c(\"Day\") +\n  geom_abline(col = \"red\") +\n  xlab(expression(\"Observed GPP [\"~kgC~m^{-~2}~yr^{-~1}~\"]\")) +\n  ylab(expression(\"Simulated GPP [\"~kgC~m^{-~2}~yr^{-~1}~\"]\")) +\n  scale_color_viridis_c(\"Day\") +\n  ggpubr::stat_cor()\n\n\n\n\n\nEvaluation of simulated versus observed daily means of GPP in Paracou and Tapajos.\n\n\n\n\n\n\nCode\ndaily %&gt;% \n  pivot_wider(names_from = type, values_from = value) %&gt;% \n  gather(type, observed, -site, -date, -variable, -determinant, -determinant_value, -simulated) %&gt;% \n  na.omit() %&gt;% \n  nest_by(site, variable, type) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation fo daily means of GPP at Paracou and Tapajos.\")\n\n\n\nEvaluation fo daily means of GPP at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\n\n\nsite\nvariable\ntype\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\ngpp\nobserved\n0.9697788\n0.6035862\n0.7516227\n0.2100186\n0.6664904\n0.1862310\n\n\nParacou\ngpp\nsatellite\n0.9533363\n0.1925081\n1.1842877\n0.3821990\n0.7969428\n0.2571932\n\n\nTapajos\ngpp\nobserved\n0.9674821\n0.4546221\n1.1245310\n0.3486050\n0.6763800\n0.2096780\n\n\nTapajos\ngpp\nsatellite\n0.9615592\n0.2199041\n1.5411157\n0.5816081\n0.7538847\n0.2845117"
  },
  {
    "objectID": "43_fluxes.html#leaf-area-index",
    "href": "43_fluxes.html#leaf-area-index",
    "title": "Fluxes",
    "section": "Leaf Area Index",
    "text": "Leaf Area Index\nWe had multiples data to evaluate canopy dynamics and resulting Leaf Area Index (LAI, m2/m2) that were not in agreement and unfortunately not in the same time period. LAI from MODIS shows a base value around 6 m2/m2 most of the years and a small increase below 0.2 m2/m3 in the dry season that pike in the middle of the dry season at both Paracou and Tapajos. Field measures with drone lidar showed a greater variation in Paracou with lowest values of 5.5 m2/m2 in April to June and highest values of almost 6 m2/m2 in December. Oppositely, field measures with terrestrial lidar in Tapajos showed no variation of LAI stable around 5.75 m2/m2 the whole year. This results thus question the use of MODIS LAI for TROLL evaluation. Indeed simulated LAI followed also the same phenology with an crease of LAI during the dry season but with values matching drone data in Paracou and not MODIS product. In Tapajos, the simulations showed even higher variations of LAI, that did not correspond to both MODIS and terrestrial LAD. Globally, simulated LAI showed a weak evaluation with a correlation coefficient of 0.37 in Paracou and 0.63 in Tapajos against 8-day observations from MODIS satellites, and corresponding RMSEP of respectively 0.3 and 0.1 m2/m2.\n\n\nCode\ndaily &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(variable == \"lai\") %&gt;% \n  select(-variable) %&gt;% \n  mutate(type = \"simulated\") %&gt;% \n  rename(value = simulated) %&gt;% \n  bind_rows(read_tsv(\"outputs/lai.tsv\") %&gt;% \n              rename(type = variable)) %&gt;% \n  bind_rows(readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\") %&gt;% \n              mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n              mutate(site = \"Tapajos\", type = \"PhenoCam\", value = `Camera_LAI (m^2 m^-2)`) %&gt;% \n              select(date, value, site, type)) %&gt;% \n    mutate(type = recode(type, \n                       \"LAD\" = \"LAI (Smith et al., 2019)\",\n                       \"LAI\" = \"LAI Modis\",\n                       \"PAD\" = \"PAI (Barbier, Verley, Vincent, unpublished)\",\n                       \"PhenoCam\" = \"PhenoCam (Wu et al. 2016)\",\n                       \"simulated\" = \"TROLL\"))\nmonthly &lt;- daily %&gt;% \n  group_by(site, date = floor_date(date, \"month\"), type) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            value = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE))\n\n\n\n\nCode\ndaily %&gt;% \n  ggplot(aes(date, value, col = type)) +\n  geom_line(alpha = 0.5) +\n  geom_line(data = monthly) +\n  facet_wrap(~ site, scales = \"free_x\") +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  xlab(\"\") + \n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-2}~\"]\")) +\n  scale_color_discrete(\"\") +\n  guides(col = guide_legend(nrow = 2))\n\n\n\n\n\nDaily and monthly means of leaf area index for Paracou and Tapajos. Dark lines are the monthly means, semi-transparent lines are the daily means variations with the exception of satellite data for which data are available only every 8 days.\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  group_by(site, type, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(date)) %&gt;%  \n  group_by(site, type, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_ribbon(aes(ymin = l, ymax = h, fill = type), col = NA, alpha = 0.2) +\n  geom_smooth(aes(col = type), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_fill_manual(\"\", values = c(\"#ffa006\", \"#fb7754\", \"#197b14\", \"#3f3f3f\",  \"#0da1f8\")) +\n  scale_color_manual(\"\", values = c(\"#ffa006\", \"#fb7754\", \"#197b14\", \"#3f3f3f\",  \"#0da1f8\")) +\n  facet_wrap(~ site, scales = \"free_x\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-~2}~\"]\")) + xlab(\"\") +\n  guides(col = guide_legend(nrow = 2), fill = guide_legend(nrow = 2))\nggsave(\"figures/f07.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nMean annual cycle from fortnightly means of leaf area index for Paracou and Tapajos. Bands are the intervals of means across years, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\ndaily %&gt;% \n  group_by(site, type, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(date)) %&gt;%  \n  group_by(site, type, week) %&gt;% \n  summarise(value = mean(value, na.rm = TRUE)) %&gt;% \n  pivot_wider(names_from = type, values_from = value) %&gt;% \n  rename(simulated = TROLL) %&gt;% \n  gather(type, observed, -site, -week, -simulated) %&gt;% \n  na.omit() %&gt;% \n  ungroup() %&gt;% \n  nest_by(site, type) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation fo monthly means of LAI at Paracou and Tapajos.\")\n\n\n\nEvaluation fo monthly means of LAI at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\n\nsite\ntype\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\nLAI Modis\n0.9993571\n0.6435971\n0.2281536\n0.0379435\n0.1501480\n0.0249706\n\n\nParacou\nPAI (Barbier, Verley, Vincent, unpublished)\n0.9995712\n0.7586187\n0.2164848\n0.0383894\n0.1207502\n0.0214127\n\n\nTapajos\nLAI (Smith et al., 2019)\n0.9990079\n0.2484052\n0.2014810\n0.0353875\n0.1859247\n0.0326553\n\n\nTapajos\nLAI Modis\n0.9992162\n0.5613419\n0.3990495\n0.0649692\n0.1641144\n0.0267195\n\n\nTapajos\nPhenoCam (Wu et al. 2016)\n0.9998312\n0.9169373\n0.1124293\n0.0192047\n0.0790174\n0.0134974"
  },
  {
    "objectID": "43_fluxes.html#leaf-area-index-per-age",
    "href": "43_fluxes.html#leaf-area-index-per-age",
    "title": "Fluxes",
    "section": "Leaf Area Index per Age",
    "text": "Leaf Area Index per Age\nFor comparisons with Yang et al. (2023), we also simulated Leaf Area Index per leaf-age class. In the figure 8 of Yang et al. (2023) Tapajos is represented by the subclass S1, characterised by an always higher values old LAI above 3 m2/m2 and lower values of young and mature LAI around 1.5 m2/m2, while Paracou is represented by the subclass S2, characterised with high values of old LAI and low value of young and mature LAI in wet season but a strong loss of old LAI, a strong increase in mature LAI, a slight increase of young LAI in dry season. Similarly, in our simulations we observed a high LAI of old leaves especially in Tapajos. It seems that old leaf area are overestimated in Tapajos, because a priori there is little interest in accumulating less efficient leaves, and therefore confirms the hypothesis that the basal flux of litter is not high enough for Tapajos. At Paracou, we simulated back the phenology of Yang et al. (2023) with increased young LAI and mature LAI in the dry season while old LAI is decreasing, but a bit later than in Yang et al. (2023) and with values of mature LAI similar to those of old LAI between 2 and 3.5 m2/m2.\n\n\nCode\ndaily &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(variable %in% c(\"lai_mature\", \"lai_old\", \"lai_young\")) %&gt;% \n  separate(variable, c(\"variable\", \"age\")) %&gt;% \n  rename(value = simulated)\nmonthly &lt;- daily %&gt;% \n  group_by(site, date = floor_date(date, \"month\"), variable, age) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            value = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE))\ncols_laid &lt;- c(\"young\" = \"#2bd22c\", \"mature\" = \"#197b14\", \"old\" = \"#ffa006\")\n\n\n\n\nCode\ndaily %&gt;% \n  ggplot(aes(date, value, col = age)) +\n  geom_line(alpha = 0.5) +\n  geom_line(data = monthly) +\n  facet_wrap(~ site, scales = \"free_x\") +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  xlab(\"\") + \n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-2}~\"]\")) +\n  scale_color_manual(\"\", values = as.vector(cols_laid[c(\"mature\", \"old\", \"young\")]))\n\n\n\n\n\nDaily and monthly means of leaf area index for Paracou and Tapajos with leaf cohorts of yound, mature and old leaves. Dark lines are the monthly means, semi-transparent lines are the daily means variations.\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  group_by(site, variable, age, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(date)) %&gt;%  \n  group_by(site, variable, age, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(type = \"TROLL\") %&gt;% \n  bind_rows(read_tsv(\"data/fluxes/lai_age.tsv\") %&gt;% \n              filter(type == \"time series\") %&gt;% \n              mutate(type = \"Yang et al. (2023)\\nReanalysis\")) %&gt;% \n  bind_rows(readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\", 2) %&gt;% \n              rename(young = `Obs_LAIyoung (m^2 m^-2)`,\n                     mature = `Obs_LAImature (m^2 m^-2)`,\n                     old = `Obs_LAIold (m^2 m^-2)`) %&gt;% \n              mutate(site = \"Tapajos\", type = \"Wu et al. (2016)\\nPhenoCam\") %&gt;% \n              mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n              mutate(week = week(date)) %&gt;% \n              select(site, week, type, young, mature, old) %&gt;% \n              gather(age, m, -site, -week, -type)) %&gt;% \n  # bind_rows(readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\", 3) %&gt;% \n  #             mutate(site = recode(Site, \"K67\" = \"Tapajos\")) %&gt;% \n  #             rename(young = `LAIyoung (m^2 m^-2)`,\n  #                    mature = `LAImature (m^2 m^-2)`,\n  #                    old = `LAIold (m^2 m^-2)`) %&gt;% \n  #             mutate(type = \"Chen et al. (in prep)\") %&gt;% \n  #             mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n  #             mutate(week = week(date)) %&gt;% \n  #             select(site, week, type, young, mature, old) %&gt;% \n  #             gather(age, m, -site, -week, -type)) %&gt;% \n  mutate(type = factor(type, levels = c(\"TROLL\", \"Wu et al. (2016)\\nPhenoCam\",\n                                        \"Yang et al. (2023)\\nReanalysis\"))) %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_ribbon(aes(ymin = l, ymax = h, fill = age), col = NA, alpha = 0.2) +\n  geom_smooth(aes(col = age), se = FALSE) +\n  theme_bw() +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_grid(site~ type) +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) + \n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-~2}~\"]\")) + xlab(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols_laid[c(\"mature\", \"old\", \"young\")])) +\n  scale_fill_manual(\"\", values = as.vector(cols_laid[c(\"mature\", \"old\", \"young\")])) +\n  theme(legend.position = \"bottom\")\nggsave(\"figures/fs03.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nMean annual cycle from fortnightly means of leaf area index for Paracou and Tapajos with leaf cohorts of yound, mature and old leaves. Bands are the intervals of means across years, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  group_by(site, variable, age, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(date)) %&gt;%  \n  group_by(site, variable, age, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(type = \"TROLL\") %&gt;% \n  bind_rows(read_tsv(\"data/fluxes/lai_age.tsv\") %&gt;% \n              filter(type == \"time series\") %&gt;% \n              mutate(type = \"Yang et al. (2023) Reanalysis\")) %&gt;% \n  bind_rows(readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\", 2) %&gt;% \n              rename(young = `Obs_LAIyoung (m^2 m^-2)`,\n                     mature = `Obs_LAImature (m^2 m^-2)`,\n                     old = `Obs_LAIold (m^2 m^-2)`) %&gt;% \n              mutate(site = \"Tapajos\", type = \"Wu et al. (2016) PhenoCam\") %&gt;% \n              mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n              mutate(week = week(date)) %&gt;% \n              select(site, week, type, young, mature, old) %&gt;% \n              gather(age, m, -site, -week, -type)) %&gt;% \n  # bind_rows(readxl::read_xlsx(\"data/fluxes/Data_LAI_new.xlsx\", 3) %&gt;% \n  #             mutate(site = recode(Site, \"K67\" = \"Tapajos\")) %&gt;% \n  #             rename(young = `LAIyoung (m^2 m^-2)`,\n  #                    mature = `LAImature (m^2 m^-2)`,\n  #                    old = `LAIold (m^2 m^-2)`) %&gt;% \n  #             mutate(type = \"Chen et al. (in prep)\") %&gt;% \n  #             mutate(date = as_date(paste0(\"2010-\", month, \"-15\"))) %&gt;% \n  #             mutate(week = week(date)) %&gt;% \n  #             select(site, week, type, young, mature, old) %&gt;% \n  #             gather(age, m, -site, -week, -type)) %&gt;% \n  mutate(type = factor(type, levels = c(\"TROLL\", \"Wu et al. (2016) PhenoCam\",\n                                        \"Yang et al. (2023) Reanalysis\"))) %&gt;% \n  group_by(site, variable, age, type) %&gt;% \n  # mutate(m = m / mean(m)) %&gt;% \n  mutate(m = as.vector(scale(m))) %&gt;% \n  mutate(age = factor(age, levels = c(\"old\", \"mature\", \"young\"))) %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_smooth(aes(col = type), se = FALSE) +\n  theme_bw() +\n  scale_color_manual(\"\", values = c(\"#0da1f8\",  \"#3f3f3f\", \"#fb7754\")) +\n  facet_grid(age ~ site) +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) + \n  ylab(expression(\"Normalised Leaf Area Index\")) + xlab(\"\") +\n  theme(legend.position = \"bottom\")\nggsave(\"figures/f08.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nMean annual cycle from fortnightly means of leaf area index for Paracou and Tapajos with leaf cohorts of yound, mature and old leaves. Bands are the intervals of means across years, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\ntroll &lt;- list(\n    lai_young = read_tsv(\"results/eval/Tapajos_R1/Tapajos_R1_0_LAIyoung.txt\"),\n    lai_mature = read_tsv(\"results/eval/Tapajos_R1/Tapajos_R1_0_LAImature.txt\") %&gt;% \n      mutate(iter = as.numeric(iter)) %&gt;% na.omit(),\n    lai_old = read_tsv(\"results/eval/Tapajos_R1/Tapajos_R1_0_LAIold.txt\") %&gt;% \n      mutate(iter = as.numeric(iter)) %&gt;% na.omit()\n  ) %&gt;% bind_rows(.id = \"variable\") %&gt;% \n  mutate(date = as_date(\"2004/01/01\")+iter) %&gt;% \n  select(-iter) %&gt;% \n  gather(height, value, -date, -variable) %&gt;% \n  separate(height, c(\"h\", \"height\"), convert = T) %&gt;% \n  mutate(canopy = ifelse(height &lt; 20, \"lower\", \"upper\")) %&gt;% \n  group_by(canopy, date) %&gt;% \n  summarise(value = sum(value)) %&gt;% \n  mutate(site = \"Tapajos\", variable = \"LAI\") %&gt;% \n  mutate(week = week(date), year = year(date)) %&gt;% \n  mutate(type = \"TROLL\")\nobs &lt;- read_tsv(\"outputs/lai_tapajos_strat.tsv\") %&gt;% \n  mutate(type = \"LAI (Smith et al., 2019)\")\nbind_rows(troll, obs) %&gt;% \nggplot(aes(week, value)) +\n    geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n            ymin = -Inf, ymax = Inf, alpha = 0.5,\n            data = data.frame(week = week(as_date(c(\"2000-06-15\"))),\n                              value = -Inf,\n                              end = week(as_date(c(\"2000-11-1\"))))) +\n  geom_line(aes(group = paste(year, canopy), col = canopy), alpha = 0.5) +\n  geom_smooth(aes(col = canopy), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  ylab(expression(\"Leaf Area Index [\"~m^2~m^{-~2}~\"]\")) + xlab(\"\") +\n  scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  facet_wrap(~ type)"
  },
  {
    "objectID": "43_fluxes.html#evapotranspiration",
    "href": "43_fluxes.html#evapotranspiration",
    "title": "Fluxes",
    "section": "Evapotranspiration",
    "text": "Evapotranspiration\nThe new version of TROLL correctly simulated the phenology of evapotranspiration (ET, mm/day), with a lower ET in wet season and an higher evaporative demand in the dry season. Simulations are slightly underestimating the ET but globally daily values overlaps in most of the 15-days windows with a wet season flux simulated around 2 mm/day against 3 mm/day observed in Paracou and both around 3.5 mm/day in the dry season. Similarly in Tapajos, the wet season flux simulated drop to almost 1 mm/day despite being above 2 mm/day in observations and they both reach 3 mm/day in the dry season. Both simulations and observations are driven by daily maximum vapour pressure deficit with a correlation coefficient between 0.58 and 0.67 for observation, and more deterministic for simulations between 0.89 and 0.93. Globally, simulated ET showed a very good evaluation with a correlation coefficient of 0.73 in Paracou and 0.72 in Tapajos against daily observations from eddy-flux towers, and corresponding RMSEP of respectively 0.9 and 0.8 mm/day.\n\n\nCode\ndaily &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(variable == \"et\") %&gt;% \n  left_join(read_tsv(\"outputs/fluxnet_fluxes.tsv\") %&gt;% \n              mutate(observed = value*20) %&gt;% \n              select(-value)) %&gt;% \n  left_join(read_tsv(\"outputs/fluxnet_fluxes.tsv\") %&gt;% \n              filter(variable %in% c(\"par\", \"vpd_max\", \"temperature\", \"ws\")) %&gt;% \n              rename(determinant = variable, determinant_value = value)) %&gt;% \n  gather(type, value, -site, -date, -variable, -determinant, -determinant_value)\nmonthly &lt;- daily %&gt;% \n  group_by(site, date = floor_date(date, \"month\"), variable, type) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            value = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE))\ndaily_etp &lt;- read_tsv(\"outputs/fluxnet_climate.tsv\") %&gt;% \n  mutate(ws = ws) %&gt;% # u10\n  mutate(rgnet = snet) %&gt;% # already rgnet\n  mutate(es = 0.6108*exp((17.27*temperature)/(237.3+temperature))) %&gt;% \n  mutate(ea = es - vpd) %&gt;% \n  mutate(delta = 4098*es/(237.3+temperature)) %&gt;% \n  mutate(z = 30) %&gt;% # with 30-m canopy\n  mutate(p = 101.3*((293-0.0065*z)/293)^5.26) %&gt;% \n  mutate(gamma = 0.655*10^(-3)*p) %&gt;% \n  mutate(etp = (0.408*delta*rgnet+gamma*(900/(temperature+273))*ws*vpd)/\n           (delta+gamma*(1+0.34*ws))) %&gt;% \n  mutate(etp = etp/1000) %&gt;% \n  group_by(site, date = date(time)) %&gt;% \n  summarise(value = sum(etp)) %&gt;% \n  mutate(type = \"etp\") %&gt;% \n  select(site, date, type, value)\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  ggplot(aes(date, value, col = type)) +\n  geom_line(alpha = 0.5) +\n  geom_line(data = monthly) +\n  facet_wrap(~ site, nrow = 2) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  xlab(\"\") + \n  ylab(expression(\"Evapotranspiration [\"~mm~day^{-~1}~\"]\")) +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Tower\", \"TROLL\"))\nggsave(\"figures/fs05.png\", g, dpi = 300, width = 10, height = 5, bg = \"white\")\ng\n\n\n\n\n\nDaily and monthly means of evapotranpsiration for Paracou and Tapajos. Dark lines are the monthly means, semi-transparent lines are the daily means variations\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  bind_rows(daily_etp) %&gt;% \n  group_by(site, variable, type, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(date)) %&gt;%  \n  group_by(site, variable, type, week) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_ribbon(aes(ymin = l, ymax = h, fill = type), col = NA, alpha = 0.2) +\n  geom_smooth(aes(col = type), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ site, scales = \"free_x\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) + \n  ylab(expression(\"Evapotranspiration [\"~mm~day^{-~1}~\"]\")) + xlab(\"\") +\n    scale_color_manual(\"\", values = as.vector(cols[c(\"sat\", \"obs\", \"sim\")]), \n                     labels = c(\"Potential\", \"Tower\", \"TROLL\")) +\n  scale_fill_manual(\"\", values = as.vector(cols[c(\"sat\", \"obs\", \"sim\")]), \n                     labels = c(\"Potential\", \"Tower\", \"TROLL\"))\nggsave(\"figures/f10.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nMean annual cycle from fortnightly means of evapotranspiration for Paracou and Tapajos. Bands are the intervals of means across years, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  mutate(determinant_value = ifelse(determinant == \"par\", \n                                    determinant_value/10^2, determinant_value)) %&gt;% \n  mutate(det_long = recode(determinant, \n                           \"par\" = 'Incoming~PAR~\"[\"~mol~m^{-~2}~day^{-~1}~\"]\"',\n                           \"temperature\" = 'Temperature~\"[\"~degree~C~\"]\"',\n                            \"vpd_max\" = '\"Vapour Pressure Deficit [\"~kPa~day^{-~1}~\"]\"',\n                           \"ws\" = 'Wind~Speed~\"[\"~m^{2}~s^{-~1}~\"]\"')) %&gt;% \n  ggplot(aes(determinant_value, value, col = type)) +\n  geom_point(alpha = 0.1) +\n  theme_bw() +\n  facet_grid(site ~ det_long, scales = \"free\", labeller = label_parsed) +\n  theme(legend.position = \"bottom\") +\n  geom_smooth(method = \"lm\", formula = \"y ~ 1+log(x+10^-6)\", se = FALSE) +\n  ylab(expression(\"Evapotranspiration [\"~mm~day^{-~1}~\"]\")) + \n  xlab(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Tower\", \"TROLL\")) +\n  scale_fill_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Tower\", \"TROLL\")) +\n  ylim(0, 5.5) +\n  ggpubr::stat_cor(aes(label = ..rr.label..))\nggsave(\"figures/f12.png\", g, dpi = 300, width = 10, height = 6, bg = \"white\")\ng\n\n\n\n\n\nDaily averages of evapotranspiration as a function of vapour pressure deficit, incoming photosynthetically active radiation, temperature, and wind speed for model-, satellite- and tower-based estimates at Paracou and Tapajos.\n\n\n\n\n\n\nCode\ndaily %&gt;% \n  pivot_wider(names_from = type, values_from = value) %&gt;% \n  ggplot(aes(simulated ,observed, col = yday(date))) +\n  facet_wrap(~ site) +\n  theme_bw() +\n  geom_point() +\n  scale_color_viridis_c(\"Day\") +\n  geom_abline(col = \"red\") +\n  ylab(expression(\"Observed ET [\"~mm~day^{-~1}~\"]\")) + \n  xlab(expression(\"Simulated ET [\"~mm~day^{-~1}~\"]\")) + \n  scale_color_viridis_c(\"Day\") +\n  ggpubr::stat_cor()\n\n\n\n\n\nEvaluation of simulated versus observed daily means of ET in Paracou and Tapajos.\n\n\n\n\n\n\nCode\ndaily %&gt;% \n  pivot_wider(names_from = type, values_from = value) %&gt;% \n  na.omit() %&gt;% \n  nest_by(site, variable) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation fo daily means of ET at Paracou and Tapajos.\")\n\n\n\nEvaluation fo daily means of ET at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\n\nsite\nvariable\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\net\n0.964289\n0.6924622\n0.5989156\n0.1952362\n0.5959970\n0.1942847\n\n\nTapajos\net\n0.953637\n0.6545958\n0.7509561\n0.2965747\n0.6295722\n0.2486367"
  },
  {
    "objectID": "43_fluxes.html#relative-soil-water-content",
    "href": "43_fluxes.html#relative-soil-water-content",
    "title": "Fluxes",
    "section": "Relative Soil Water Content",
    "text": "Relative Soil Water Content\nWe only had soil water content measurement for Paracou. Moreover, soil water content measurement are measured with electric measurement of conductance and rely a lot on calibration. We thus decided to use Relative Soil water Content (RSWC, %) to avoid bias of tool calibration and focus on within-year variations. The new version of TROLL correctly simulated the phenology of RSWC, with a higher RSWC in wet season around 100% with fully saturated soils and a strong drop in RSWC in the dry season. Focusing on the drop in dry seasons, the mean value simulated across year in Paracou dropped to 80% but exceptionally dry years drop up to 50%. The observed conditions are harsher with a mean observed drop around 50% across years that is below 50 most years and drop to 40% the driest years. Globally, simulated RSWC showed a good evaluation at Paracou with a correlation coefficient of 0.77 against daily observations from eddy-flux towers, and corresponding RMSEP of 23 %.\n\n\nCode\ndaily &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(variable == \"rswc10\") %&gt;% \n  left_join(read_tsv(\"outputs/guyaflux_swc.tsv\") %&gt;% \n              filter(variable == \"swc10\") %&gt;% \n              group_by(site, year = year(date)) %&gt;% \n              mutate(observed = value / quantile(value, 0.95, na.rm = T)) %&gt;% \n              mutate(observed = ifelse(observed &gt; 1, 1, observed)) %&gt;% \n              ungroup() %&gt;% \n              mutate(variable = \"rswc10\") %&gt;% \n              select(-year, -value)) %&gt;% \n  gather(type, value, -site, -date, -variable) %&gt;% \n  na.omit()\nmonthly &lt;- daily %&gt;% \n  group_by(site, date = floor_date(date, \"month\"), variable, type) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            value = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE))\n\n\n\n\nCode\ndaily %&gt;% \n  ggplot(aes(date, value, col = type)) +\n  geom_line(alpha = 0.5) +\n  geom_line(data = monthly) +\n  facet_wrap(~ site, scales = \"free_x\") +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  xlab(\"\") + \n  ylab(expression(\"Relative Soil Water Content [\"~\"%\"~\"]\")) +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Tower\", \"TROLL\"))\n\n\n\n\n\nDaily and monthly means of relative soil water content for Paracou and Tapajos. Dark lines are the monthly means, semi-transparent lines are the daily means variations.\n\n\n\n\n\n\nCode\ng &lt;- daily %&gt;% \n  group_by(site, variable, type, date = floor_date(date, \"15 days\")) %&gt;% \n  summarise_all(mean, na.rm = T) %&gt;%\n  mutate(week = week(date), year = year(date), m = value) %&gt;% \n  na.omit() %&gt;% \n  ggplot(aes(week, m)) +\n  geom_rect(aes(xmin = week, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(week = week(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = week(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_line(aes(group = paste(year, type), col = type), alpha = 0.5) +\n  geom_smooth(aes(col = type), se = FALSE) +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  scale_fill_discrete(\"\") +\n  scale_color_discrete(\"\") +\n  facet_wrap(~ site, scales = \"free_x\") +\n    scale_x_continuous(breaks = week(as_date(paste(\"2000-\", 1:12, \"-01\"))),\n                     labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) + \n  ylab(expression(\"Relative Soil Water Content [\"~\"%\"~\"]\")) + xlab(\"\") +\n  scale_color_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Tower\", \"TROLL\")) +\n  scale_fill_manual(\"\", values = as.vector(cols[c(\"obs\", \"sim\")]), \n                     labels = c(\"Tower\", \"TROLL\"))\nggsave(\"figures/fs06.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nMean annual cycle from fortnightly means of relative soil water content for Paracou and Tapajos. Bands are the intervals of means across years, and rectangles in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\nCode\ndaily %&gt;% \n  pivot_wider(names_from = type, values_from = value) %&gt;% \n  na.omit() %&gt;% \n  nest_by(site, variable) %&gt;% \n  mutate(R2 = summary(lm(observed ~ 0 + simulated, data = data))$r.squared,\n         CC = cor(data$simulated, data$observed),\n         RMSEP = sqrt(mean((data$simulated-data$observed)^2)),\n         RRMSEP = sqrt(mean((data$simulated-data$observed)^2))/mean(data$observed),\n         SD =sd(data$simulated-data$observed),\n         RSD =sd(data$simulated-data$observed)/mean(data$observed)) %&gt;% \n  select(-data) %&gt;% \n  knitr::kable(caption = \"Evaluation fo daily means of RSWC at Paracou and Tapajos.\")\n\n\n\nEvaluation fo daily means of RSWC at Paracou and Tapajos.\n\n\n\n\n\n\n\n\n\n\n\n\nsite\nvariable\nR2\nCC\nRMSEP\nRRMSEP\nSD\nRSD\n\n\n\n\nParacou\nrswc10\n0.9670209\n0.7714005\n0.2358212\n0.3244888\n0.128365\n0.1766295\n\n\n\n\n\n\n\nCode\ndaily &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(grepl(\"^swc\", variable)) %&gt;% \n  mutate(depth = as.numeric(gsub(\"swc\", \"\", variable))) %&gt;% \n  mutate(depth = recode(paste(site, depth), \n                        \"Paracou 0\" = 0.1,\n                        \"Tapajos 0\" = 0.1,\n                        \"Paracou 1\" = 0.33,\n                        \"Tapajos 1\" = 0.5,\n                        \"Paracou 2\" = 0.73,\n                        \"Tapajos 2\" = 1.5,\n                        \"Paracou 3\" = 1.53,\n                        \"Tapajos 3\" = 4,\n                        \"Paracou 4\" = 2.5,\n                        \"Tapajos 4\" = 16.1)) %&gt;% \n  mutate(day = yday(date), type = 'simulated', value = simulated) %&gt;% \n  select(site, date, day, type, depth, value) %&gt;% \n  bind_rows(read_tsv(\"outputs/guyaflux_swc.tsv\") %&gt;% \n              mutate(depth = as.numeric(gsub(\"swc\", \"\", variable))/100) %&gt;%\n              mutate(day = yday(date), type = 'observed') %&gt;% \n              select(site, date, day, type, depth, value))\ng &lt;- daily %&gt;% \n  group_by(site, depth, type, day = yday(date)) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = mean(value, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(depth = as.factor(depth)) %&gt;% \n  ggplot(aes(day, m)) +\n  geom_rect(aes(xmin = day, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(day = yday(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = yday(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_ribbon(aes(ymin = l, ymax = h, col = depth, fill = depth, group = depth),\n              col = NA, alpha = 0.2) +\n  geom_line(aes(col = depth, fill = depth, group = depth)) +\n  theme_bw() +\n  scale_color_viridis_d(\"Depth (m)\", direction = -1) +\n  scale_fill_viridis_d(\"Depth (m)\", direction = -1) +\n  theme(axis.title.x = element_blank()) +\n  ylab(expression(Soil~Water~Content~\"[\"~m^{3}~m^{-~3}~\"]\")) +\n  scale_x_continuous(breaks = c(1, 32, 61, 92, 122, 153, 183, 214, 245, 275, 306, 336),\n                    labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\")) +\n  facet_wrap(~ type ~ site, nrow = 2, scales = \"free_y\")\nggsave(\"figures/fs07.png\", g, dpi = 300, width = 8, height = 5, bg = \"white\")\ng\n\n\n\n\n\nMean annual cycle from daily means of soil water content for Paracou and Tapajos at different depths. The depth value indicates the maximum depth of the layer. Dark lines are the daily means across years, and bands are the intervals of means across ten years The vertical yellow bands in the background correspond to the site’s climatological dry season.\n\n\n\n\n\n\n\n\nYang, Xueqin, Xiuzhi Chen, Jiashun Ren, Wenping Yuan, Liyang Liu, Juxiu Liu, Dexiang Chen, et al. 2023. “A Grid Dataset of Leaf Age-Dependent LAI Seasonality Product (Lad-LAI) over Tropical and Subtropical Evergreen Broadleaved Forests.” http://dx.doi.org/10.5194/essd-2022-436."
  },
  {
    "objectID": "98_companion_figures.html#interannual-variation",
    "href": "98_companion_figures.html#interannual-variation",
    "title": "Companion figures",
    "section": "Interannual variation",
    "text": "Interannual variation\n\n\nCode\ndaily &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(variable %in% c(\"gpp\", \"et\")) %&gt;% \n  filter(year(date) %in% 2005:2010) %&gt;% \n  filter(site == \"Paracou\")\nmonthly &lt;- daily %&gt;% \n  group_by(site, date = floor_date(date, \"month\"), variable) %&gt;% \n  summarise(l = quantile(simulated, 0.025, na.rm = TRUE), \n            simulated = mean(simulated, na.rm = TRUE), \n            h = quantile(simulated, 0.975, na.rm = TRUE))\ncols &lt;- c(\"etp\" = \"#0da1f8\", \"gpp\" = \"#fb7754\")\nga &lt;- daily %&gt;% \n  ggplot(aes(date, simulated, col = variable)) +\n  geom_line(alpha = 0.5) +\n  geom_line(data = monthly) +\n  theme_bw() +\n  theme(legend.position = \"None\") +\n  xlab(\"\") +\n  scale_y_continuous(\n    name = expression(\"Growth Primary Productivity [\"~kgC~m^{-~2}~yr^{-~1}~\"]\"),\n    sec.axis = sec_axis(trans = ~.*1,\n                        name = expression(\"Evapotranspiration [\"~mm~day^{-~1}~\"]\"))\n  ) +\n    theme(\n    axis.title.y = element_text(color = cols[2]),\n    axis.title.y.right = element_text(color = cols[1])\n  ) +\n  scale_color_manual(values = as.vector(cols)) +\n  ggtitle(\"(a)\")\nga\n\n\n\n\n\nDaily and monthly means of growth primary productivity and evapotranspitation for Paracou. Dark lines are the monthly means, semi-transparent lines are the daily means variations."
  },
  {
    "objectID": "98_companion_figures.html#leaf-area-index-litterfall",
    "href": "98_companion_figures.html#leaf-area-index-litterfall",
    "title": "Companion figures",
    "section": "Leaf area index & litterfall",
    "text": "Leaf area index & litterfall\n\n\nCode\ncols &lt;- c(\"total\" = \"#fb7754\", \"young\" = \"#2bd22c\", \"mature\" = \"#197b14\", \"old\" = \"#ffa006\")\nlai &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(grepl(\"lai\", variable)) %&gt;% \n  filter(year(date) %in% 2005:2010) %&gt;% \n  filter(site == \"Paracou\")\nlitter &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n  filter(variable == \"litter\") %&gt;% \n  filter(year(date) %in% 2005:2010) %&gt;% \n  mutate(simulated = simulated/2) %&gt;% \n  filter(site == \"Paracou\")\ngb &lt;- lai %&gt;% \n  ggplot(aes(date, simulated, col = variable)) +\n  geom_col(col = \"lightgrey\", data = litter) +\n  geom_line() +\n  theme_bw() +\n  theme(legend.position = \"bottom\") +\n  xlab(\"\") +\n  scale_color_manual(name = \"\", \n                     values = as.vector(cols), \n                     labels = c(\"total\", \"mature\", \"old\", \"young\")) +\n  scale_y_continuous(\n    name = expression(\"Leaf Area Index [\"~m^2~m^{-~2}~\"]\"),\n    sec.axis = sec_axis(trans = ~.*2,\n                        name = expression(Litterfall~\"[\"~MgC~ha^{-~1}~yr^{-~1}~\"]\"))\n  ) +\n  guides(colour = guide_legend(nrow = 1)) +\n    theme(\n    axis.title.y = element_text(color = \"black\"),\n    axis.title.y.right = element_text(color = \"grey\"),\n    legend.position = c(0.3, 0.8),\n    legend.background = element_rect(colour = NA, fill = NA)\n  ) +\n  ggtitle(\"(b)\")\ngb\n\n\n\n\n\nDaily means of leaf area index and litterfall for Paracou with leaf cohorts of total, yound, mature and old leaves indicated with coloured lines and litterfall with grey bars."
  },
  {
    "objectID": "98_companion_figures.html#soil-water-content",
    "href": "98_companion_figures.html#soil-water-content",
    "title": "Companion figures",
    "section": "Soil water content",
    "text": "Soil water content\n\n\nCode\ngc &lt;- read_tsv(\"outputs/evaluation_fluxes.tsv\") %&gt;% \n   filter(grepl(\"^swc\", variable)) %&gt;% \n  mutate(depth = as.numeric(gsub(\"swc\", \"\", variable))) %&gt;% \n  mutate(depth = recode(paste(site, depth), \n                        \"Paracou 0\" = 0.1,\n                        \"Tapajos 0\" = 0.1,\n                        \"Paracou 1\" = 0.33,\n                        \"Tapajos 1\" = 0.5,\n                        \"Paracou 2\" = 0.73,\n                        \"Tapajos 2\" = 1.5,\n                        \"Paracou 3\" = 1.53,\n                        \"Tapajos 3\" = 4,\n                        \"Paracou 4\" = 2.5,\n                        \"Tapajos 4\" = 16.1)) %&gt;% \n  group_by(site, depth, day = yday(date)) %&gt;% \n  summarise(l = quantile(simulated, 0.025, na.rm = TRUE), \n            m = mean(simulated, na.rm = TRUE), \n            h = quantile(simulated, 0.975, na.rm = TRUE)) %&gt;% \n  mutate(depth = as.factor(depth)) %&gt;% \n  filter(site == \"Paracou\") %&gt;% \n  ggplot(aes(day, m)) +\n  geom_rect(aes(xmin = day, xmax = end), fill  = \"#fff4e0\",\n           ymin = -Inf, ymax = Inf, alpha = 0.5,\n           data = data.frame(day = yday(as_date(c(\"2000-8-1\", \"2000-06-15\"))),\n                             m = -Inf,\n                             end = yday(as_date(c(\"2000-12-1\", \"2000-11-1\"))),\n                             site = c(\"Paracou\", \"Tapajos\"))) +\n  geom_ribbon(aes(ymin = l, ymax = h, col = depth, fill = depth, group = depth),\n              col = NA, alpha = 0.2) +\n  geom_line(aes(col = depth, fill = depth, group = depth)) +\n  theme_bw() +\n  scale_color_viridis_d(\"Depth (m)\", direction = -1) +\n  scale_fill_viridis_d(\"Depth (m)\", direction = -1) +\n  theme(axis.title.x = element_blank()) +\n  ylab(expression(Soil~Water~Content~\"[\"~m^{3}~m^{-~3}~\"]\")) +\n  scale_x_continuous(breaks = c(1, 32, 61, 92, 122, 153, 183, 214, 245, 275, 306, 336),\n                    labels = c(\"J\", \"F\", \"M\", \"A\", \"M\", \"J\", \"J\", \"A\", \"S\", \"O\", \"N\", \"D\"))+\n  ggtitle(\"(c)\")\ngc\n\n\n\n\n\nMean annual cycle of daily means of soil water content at Paracou and Tapajos across ten years and for 5 differents depths."
  },
  {
    "objectID": "98_companion_figures.html#forest-structure",
    "href": "98_companion_figures.html#forest-structure",
    "title": "Companion figures",
    "section": "Forest structure",
    "text": "Forest structure\n\n\nCode\nge &lt;- read_tsv(\"outputs/evaluation_forest.tsv\") %&gt;% \n  mutate(plot = repetition) %&gt;% \n  select(site, plot, dbh) %&gt;% \n  mutate(dbh_class = cut(dbh, breaks = seq(10, 200, by = 10), \n                         labels = seq(10, 190, by = 10)+5)) %&gt;% \n  mutate(dbh_class = as.numeric(as.character(dbh_class))) %&gt;% \n  group_by(site, plot, dbh_class) %&gt;% \n  summarise(abundance = n()/4,\n            ba = sum((dbh/2)^2*pi)/10^4/4) %&gt;% \n  mutate(log_abundance = log10(abundance)) %&gt;% \n  gather(variable, simulated, -site, -dbh_class, -plot) %&gt;% \n  gather(type, value, -site, -dbh_class, -variable, -plot) %&gt;% \n  group_by(site, dbh_class, variable, type) %&gt;% \n  summarise(l = quantile(value, 0.025, na.rm = TRUE), \n            m = quantile(value, 0.5, na.rm = TRUE), \n            h = quantile(value, 0.975, na.rm = TRUE)) %&gt;% \n  na.omit() %&gt;% \n  filter(variable == \"ba\") %&gt;% \n  ggplot(aes(dbh_class, m, col = site, group = site)) +\n  geom_linerange(aes(ymin = l, ymax = h)) +\n  geom_point() +\n  geom_line() +\n  theme_bw() +\n  xlab(\"DBH [ cm ]\") + \n  ylab(expression(Basal~area~\"[\"~m^{2}~m^{-~2}~\"]\")) +\n  theme(legend.position = \"bottom\") +\n  scale_color_discrete(\"\", guide = \"none\") +\n  ggtitle(\"(e)\")\nge\n\n\n\n\n\nEvaluation of the size structure estimated by TROLL at the Paracou and Tapajos sites, expressed in terms of basal area. The confidence on the TROLL values was estimated generating an ensemble of 10 simulations (see methods)."
  },
  {
    "objectID": "98_companion_figures.html#functional-traits",
    "href": "98_companion_figures.html#functional-traits",
    "title": "Companion figures",
    "section": "Functional traits",
    "text": "Functional traits\n\n\nCode\ntroll_traits &lt;- list(\n    read_tsv(\"outputs/Paracou_species_troll.tsv\"),\n    read_tsv(\"outputs/Tapajos_species_troll.tsv\")\n) %&gt;% bind_rows() %&gt;% \n  unique() %&gt;% \n  rename_all(~ gsub(\"s_\", \"\", .)) %&gt;% \n  select(-seedmass, -regionalfreq) %&gt;% \n  rename(species = name) %&gt;% \n  mutate(species = gsub(\"_\", \" \", species)) %&gt;% \n  gather(trait, trait_value, -species)\ntroll_traitdist &lt;- read_tsv(\"outputs/evaluation_forest.tsv\") %&gt;% \n  mutate(plot = repetition) %&gt;% \n  select(site, plot, species) %&gt;% \n  left_join(troll_traits) %&gt;% \n  filter(trait %in% c(\"LMA\", \"Nmass\", \"tlp\", \"wsg\")) %&gt;% \n  mutate(traitlong = recode(trait, \n                            \"ah\" = 'a[h]~\"[\"~m~\"]\"',\n                            \"dbhmax\" = 'dbh[max]~\"[\"~m~\"]\"',\n                            \"hmax\" = 'h[max]~\"[\"~m~\"]\"',\n                            \"leafaera\" = 'LA~\"[\"~cm^{2}~\"]\"',\n                            \"LMA\" = 'LMA~\"[\"~g~m^{-~2}~\"]\"',\n                            \"Nmass\" = 'N[mass]~\"[\"~mg~g^{-~1}~\"]\"',\n                            \"Pmass\" = 'P[mass]~\"[\"~mg~g^{-~1}~\"]\"',\n                            \"tlp\" = 'Psi[TLP]~\"[\"~MPa~\"]\"',\n                            \"wsg\" = 'WSG~\"[\"~g~cm^{-~3}~\"]\"'))\ngd &lt;- troll_traitdist %&gt;% \n  ggplot(aes(site, trait_value, fill = site)) +\n  geom_violin(col = NA) +\n  geom_boxplot(width=0.1) +\n  facet_wrap(~ traitlong, scales = \"free\", labeller = label_parsed) +\n  theme_bw() +\n  scale_fill_discrete(\"\", guide = \"none\") +\n  theme(axis.title = element_blank(), axis.text.x = element_blank(),\n        axis.ticks.x = element_blank(), legend.position = \"bottom\") +\n  ggtitle(\"(d)\")\ngd\n\n\n\n\n\nFunctional composition estimated by TROLL at the Paracou and Tapajos site expressed in terms of distribution per trait and site."
  },
  {
    "objectID": "98_companion_figures.html#assembly",
    "href": "98_companion_figures.html#assembly",
    "title": "Companion figures",
    "section": "Assembly",
    "text": "Assembly\n\n\nCode\ng &lt;- gridExtra::grid.arrange(ga, gb, gc, gd, ge,\n                        layout_matrix = rbind(c(1, 1, 4),\n                                              c(2, 2, 4),\n                                              c(3, 3, 5)))\n\n\n\n\n\nCode\nggsave(\"figures/companion_f01.png\", g, dpi = 300, width = 16, height = 10, bg = \"white\")"
  },
  {
    "objectID": "99_references.html",
    "href": "99_references.html",
    "title": "References",
    "section": "",
    "text": "Baraloto, Christopher, C. E. Timothy Paine, Sandra Patiño, Damien Bonal,\nBruno Hérault, and Jerome Chave. 2010. “Functional Trait Variation\nand Sampling Strategies in Species-Rich Plant\nCommunities.” Functional Ecology 24 (1): 208–16. https://doi.org/10.1111/j.1365-2435.2009.01600.x.\n\n\nBONAL, DAMIEN, ALEXANDRE BOSC, STÉPHANE PONTON, JEAN-YVES GORET, BENOÎT\nBURBAN, PATRICK GROSS, JEAN-MARC BONNEFOND, et al. 2008. “Impact\nof Severe Dry Season on Net Ecosystem Exchange in the Neotropical\nRainforest of French Guiana.” Global Change Biology 14\n(8): 1917–33. https://doi.org/10.1111/j.1365-2486.2008.01610.x.\n\n\nChen, Xingan, Yuefei Huang, Chong Nie, Shuo Zhang, Guangqian Wang,\nShiliu Chen, and Zhichao Chen. 2022. “A Long-Term Reconstructed\nTROPOMI Solar-Induced Fluorescence Dataset Using Machine Learning\nAlgorithms.” Scientific Data 9 (1). https://doi.org/10.1038/s41597-022-01520-1.\n\n\nFu, Rong, Lei Yin, Wenhong Li, Paola A. Arias, Robert E. Dickinson, Lei\nHuang, Sudip Chakraborty, et al. 2013. “Increased Dry-Season\nLength over Southern Amazonia in Recent Decades and Its Implication for\nFuture Climate Projection.” Proceedings of the National\nAcademy of Sciences 110 (45): 18110–15. https://doi.org/10.1073/pnas.1302584110.\n\n\nGuillemot, Joannès, Nicolas K. Martin-StPaul, Leticia Bulascoschi,\nLourens Poorter, Xavier Morin, Bruno X. Pinho, Guerric le Maire, et al.\n2022. “Small and Slow Is Safe: On the Drought Tolerance of\nTropical Tree Species.” Global Change Biology 28 (8):\n2622–38. https://doi.org/10.1111/gcb.16082.\n\n\nJucker, Tommaso, Fabian Jörg Fischer, Jérôme Chave, David A. Coomes,\nJohn Caspersen, Arshad Ali, Grace Jopaul Loubota Panzou, et al. 2022.\n“Tallo: A Global Tree Allometry and Crown Architecture\nDatabase.” Global Change Biology 28 (17): 5254–68. https://doi.org/10.1111/gcb.16302.\n\n\nKattge, Jens, Gerhard Bönisch, and et al. 2020. “TRY Plant Trait\nDatabase – Enhanced Coverage and Open Access.” Global Change\nBiology 26: 119–88. https://doi.org/10.1111/gcb.14904.\n\n\nMaréchaux, Isabelle, Megan K. Bartlett, Lawren Sack, Christopher\nBaraloto, Julien Engel, Emilie Joetzjer, and Jérôme Chave. 2015.\n“Drought Tolerance as Predicted by Leaf Water Potential at Turgor\nLoss Point Varies Strongly Across Species Within an Amazonian\nForest.” Edited by Kaoru Kitajima. Functional Ecology 29\n(10): 1268–77. https://doi.org/10.1111/1365-2435.12452.\n\n\nMaréchaux, Isabelle, and Jérôme Chave. 2017. “An\nIndividual-Based Forest Model to Jointly Simulate Carbon\nand Tree Diversity in Amazonia: Description and Applications.”\nEcological Monographs 87 (4): 632–64. https://doi.org/10.1002/ecm.1271.\n\n\nMaréchaux, Isabelle, Laurent Saint-André, Megan K. Bartlett, Lawren\nSack, and Jérôme Chave. 2019. “Leaf Drought Tolerance Cannot Be\nInferred from Classic Leaf Traits in a Tropical Rainforest.”\nEdited by Pierre Mariotte. Journal of Ecology 108 (3): 1030–45.\nhttps://doi.org/10.1111/1365-2745.13321.\n\n\nMuñoz-Sabater, Joaquín, Emanuel Dutra, Anna Agustí-Panareda, Clément\nAlbergel, Gabriele Arduini, Gianpaolo Balsamo, Souhail Boussetta, et al.\n2021. “ERA5-Land: A State-of-the-Art Global Reanalysis Dataset for\nLand Applications.” Earth System Science Data 13 (9):\n4349–83. https://doi.org/10.5194/essd-13-4349-2021.\n\n\nNemetschek, Daniela, Géraldine Derroire, Eric Marcon, Mélaine\nAubry-Kientz, Johanna Auer, Vincyane Badouard, Christopher Baraloto, et\nal. 2024. “Climate Anomalies and Neighbourhood Crowding Interact\nin Shaping Tree Growth in Old-Growth and Selectively Logged\nTropical Forests.” Journal of Ecology, January. https://doi.org/10.1111/1365-2745.14256.\n\n\nNepstad, D. C., P. Moutinho, M. B. Dias-Filho, E. Davidson, G. Cardinot,\nD. Markewitz, R. Figueiredo, et al. 2002. “The Effects of Partial\nThroughfall Exclusion on Canopy Processes, Aboveground Production, and\nBiogeochemistry of an Amazon Forest.” Journal of Geophysical\nResearch: Atmospheres 107 (D20). https://doi.org/10.1029/2001jd000360.\n\n\nPastorello, Gilberto, Trotta, Carlo, Canfora, Eleonora, Chu, Housen,\nChristianson, Danielle, Cheah, You-Wei, Poindexter, Cristina, et al.\n2020. “The FLUXNET2015 Dataset and the ONEFlux Processing Pipeline\nfor Eddy Covariance Data.” Nature Publishing Group. https://doi.org/10.5167/UZH-190509.\n\n\nQuesada, C. A., J. Lloyd, M. Schwarz, S. Patiño, T. R. Baker, C.\nCzimczik, N. M. Fyllas, et al. 2010. “Variations in Chemical and\nPhysical Properties of Amazon Forest Soils in Relation to Their\nGenesis.” Biogeosciences 7 (5): 1515–41. https://doi.org/10.5194/bg-7-1515-2010.\n\n\nRice, Amy H., Elizabeth Hammond Pyle, Scott R. Saleska, Lucy Hutyra,\nMichael Palace, Michael Keller, Plínio B. de Camargo, Kleber Portilho,\nDulcyana F. Marques, and Steven C. Wofsy. 2004. “CARBON BALANCE\nAND VEGETATION DYNAMICS IN AN OLD-GROWTH AMAZONIAN\nFOREST.” Ecological Applications 14 (sp4): 55–71. https://doi.org/10.1890/02-6006.\n\n\nRutishauser, Ervan, Fabien Wagner, Bruno Herault, Eric-André Nicolini,\nand Lilian Blanc. 2010. “Contrasting Above-Ground Biomass Balance\nin a Neotropical Rain Forest.” Journal of Vegetation\nScience, March. https://doi.org/10.1111/j.1654-1103.2010.01175.x.\n\n\nSabatier, Daniel, Michel Grimaldi, Marie-Françoise Prévost, Julie\nGuillaume, Michel Godron, Mireille Dosso, and Daniel Sabatier. 1997.\n“The Influence of Soil Cover Organization on the Floristic and\nStructural Heterogeneity of a Guianan Rain Forest.” Plant\nEcology Formerly “Vegetatio” 131 (1): 81–108. https://doi.org/10.1023/a:1009775025850.\n\n\nSchmitt, Sylvain, and Marion Boisseaux. 2023. “Higher Local Intra-\nThan Interspecific Variability in Water- and Carbon-Related Leaf Traits\nAmong Neotropical Tree Species.” Annals of Botany 131\n(5): 801–11. https://doi.org/10.1093/aob/mcad042.\n\n\nSchmitt, Sylvain, Guillaume Salzet, Fabian Jörg Fischer, Isabelle\nMaréchaux, and Jerome Chave. 2023.\n“Rcontroll: An R Interface for the\nIndividual-Based Forest Dynamics Simulator\nTROLL.” Methods in Ecology and\nEvolution 14 (11): 2749–57. https://doi.org/10.1111/2041-210x.14215.\n\n\nSilver, Whendee L., Jason Neff, Megan McGroddy, Ed Veldkamp, Michael\nKeller, and Raimundo Cosme. 2000. “Effects of Soil Texture on\nBelowground Carbon and Nutrient Storage in a Lowland Amazonian Forest\nEcosystem.” Ecosystems 3 (2): 193–209. https://doi.org/10.1007/s100210000019.\n\n\nSmith, Marielle N., Scott C. Stark, Tyeen C. Taylor, Mauricio L.\nFerreira, Eronaldo de Oliveira, Natalia Restrepo-Coupe, Shuli Chen, et\nal. 2019. “Seasonal and Drought-Related Changes in\nLeaf Area Profiles Depend on Height and Light Environment in an Amazon\nForest.” New Phytologist 222 (3): 1284–97. https://doi.org/10.1111/nph.15726.\n\n\nUkkola, Anna M., Gab Abramowitz, and Martin G. De Kauwe. 2022. “A\nFlux Tower Dataset Tailored for Land Model Evaluation.” Earth\nSystem Science Data 14 (2): 449–61. https://doi.org/10.5194/essd-14-449-2022.\n\n\nVan Langenhove, Leandro, Thomas Depaepe, Lore T. Verryckt, Helena\nVallicrosa, Lucia Fuchslueger, Laynara F. Lugli, Laëtitia Bréchet, et\nal. 2021. “Impact of Nutrient Additions on\nFree-Living Nitrogen Fixation in Litter and Soil of Two\nFrench-Guianese Lowland Tropical Forests.”\nJournal of Geophysical Research: Biogeosciences 126 (7). https://doi.org/10.1029/2020jg006023.\n\n\nVleminckx, Jason, Claire Fortunel, Oscar Valverde-Barrantes, C. E.\nTimothy Paine, Julien Engel, Pascal Petronelli, Aurélie K. Dourdain,\nJuan Guevara, Solène Béroujon, and Christopher Baraloto. 2021.\n“Resolving Whole-Plant Economics from Leaf, Stem and\nRoot Traits of 1467 Amazonian Tree Species.” Oikos 130\n(7): 1193–1208. https://doi.org/10.1111/oik.08284.\n\n\nWu, Jin, Loren P. Albert, Aline P. Lopes, Natalia Restrepo-Coupe,\nMatthew Hayek, Kenia T. Wiedemann, Kaiyu Guan, et al. 2017. “Data\nfrom: Leaf Development and Demography Explain Photosynthetic Seasonality\nin Amazon Evergreen Forests.” Dryad. https://doi.org/10.5061/DRYAD.8FB47.\n\n\nYang, Xueqin, Xiuzhi Chen, Jiashun Ren, Wenping Yuan, Liyang Liu, Juxiu\nLiu, Dexiang Chen, et al. 2023. “A Grid Dataset of Leaf\nAge-Dependent LAI Seasonality Product (Lad-LAI) over Tropical and\nSubtropical Evergreen Broadleaved Forests.” http://dx.doi.org/10.5194/essd-2022-436.\n\n\nZiegler, Camille, Sabrina Coste, Clément Stahl, Sylvain Delzon,\nSébastien Levionnois, Jocelyn Cazal, Hervé Cochard, et al. 2019.\n“Large Hydraulic Safety Margins Protect Neotropical Canopy\nRainforest Tree Species Against Hydraulic Failure During\nDrought.” Annals of Forest Science 76 (4). https://doi.org/10.1007/s13595-019-0905-0."
  }
]